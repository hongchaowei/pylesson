<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬1è¯¾: æŠ•èµ„ç»„åˆç†è®ºåŸºç¡€ - Pythoné‡‘èç¼–ç¨‹è¯¾ç¨‹</title>
    <link rel="stylesheet" href="../../css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjs@11.11.0/lib/browser/math.min.js"></script>

    <style>
    /* ç¡®ä¿ä»£ç å—å·¦å¯¹é½ */
    .lesson-content pre {
        text-align: left !important;
        font-family: 'Courier New', Courier, monospace;
        background-color: #f5f7fa;
        padding: 15px;
        border-radius: 8px;
        overflow-x: auto;
        margin: 20px 0;
        border-left: 4px solid #4299e1;
    }
    
    .lesson-content code {
        text-align: left !important;
        font-family: 'Courier New', Courier, monospace;
        background-color: #f5f7fa;
        padding: 2px 5px;
        border-radius: 3px;
    }
    
    /* ç¡®ä¿preæ ‡ç­¾å†…çš„å†…å®¹å·¦å¯¹é½ */
    pre * {
        text-align: left !important;
    }
    
    /* ç¡®ä¿æ‰€æœ‰ä»£ç ç›¸å…³å…ƒç´ éƒ½å·¦å¯¹é½ */
    pre, code, .hljs {
        text-align: left !important;
    }
    
    /* æŠ•èµ„ç»„åˆç†è®ºäº¤äº’æ¼”ç¤ºæ ·å¼ */
    .portfolio-demo {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 15px;
        margin: 30px 0;
        box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
    }
    
    .demo-controls {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 20px 0;
    }
    
    .control-group {
        background: rgba(255,255,255,0.1);
        padding: 15px;
        border-radius: 10px;
        border: 1px solid rgba(255,255,255,0.2);
    }
    
    .control-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        font-size: 14px;
    }
    
    .control-group input[type="range"] {
        width: 100%;
        margin: 5px 0;
    }
    
    .control-group input[type="number"] {
        width: 80px;
        padding: 5px 8px;
        border: 1px solid rgba(255,255,255,0.3);
        border-radius: 5px;
        background: rgba(255,255,255,0.2);
        color: white;
        font-size: 14px;
    }
    
    .portfolio-chart {
        background: white;
        border-radius: 12px;
        padding: 25px;
        margin: 20px 0;
        box-shadow: 0 6px 25px rgba(0,0,0,0.1);
        min-height: 450px;
    }
    
    .metrics-display {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
    }
    
    .metric-card {
        background: rgba(255,255,255,0.15);
        padding: 15px;
        border-radius: 10px;
        text-align: center;
        border: 1px solid rgba(255,255,255,0.2);
    }
    
    .metric-value {
        font-size: 24px;
        font-weight: bold;
        margin: 5px 0;
    }
    
    .metric-label {
        font-size: 12px;
        opacity: 0.9;
    }
    
    .asset-inputs {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin: 15px 0;
    }
    
    .asset-input {
        background: rgba(255,255,255,0.1);
        padding: 10px;
        border-radius: 8px;
        border: 1px solid rgba(255,255,255,0.2);
    }
    
    .asset-input label {
        display: block;
        font-size: 12px;
        margin-bottom: 5px;
        opacity: 0.9;
    }
    
    .asset-input input {
        width: 100%;
        padding: 5px;
        border: none;
        border-radius: 4px;
        background: rgba(255,255,255,0.2);
        color: white;
        font-size: 14px;
    }
    
    .demo-button {
        background: rgba(255,255,255,0.2);
        color: white;
        border: 2px solid rgba(255,255,255,0.3);
        padding: 12px 25px;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
        margin: 5px;
    }
    
    .demo-button:hover {
        background: rgba(255,255,255,0.3);
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(0,0,0,0.2);
    }
    
    .demo-button.active {
        background: rgba(255,255,255,0.4);
        border-color: rgba(255,255,255,0.6);
    }
    
    .formula-display {
        background: rgba(255,255,255,0.1);
        padding: 20px;
        border-radius: 10px;
        margin: 15px 0;
        border-left: 4px solid rgba(255,255,255,0.5);
        font-family: 'Courier New', monospace;
    }
    
    .tooltip {
        position: absolute;
        background: rgba(0,0,0,0.9);
        color: white;
        padding: 10px 15px;
        border-radius: 8px;
        font-size: 13px;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s;
        z-index: 1000;
        max-width: 200px;
    }
    </style>
    
</head>
<body>
<div id="navigation-container"></div>
<script>
// åŠ¨æ€åŠ è½½å¯¼èˆªæ¡
function loadNavigation() {
    fetch('../../nav.html')
        .then(response => response.text())
        .then(html => {
            // æ›´æ–°å¯¼èˆªä¸­çš„é“¾æ¥è·¯å¾„
            let updatedHtml = html;
            
            // å¤„ç†æ ¹ç›®å½•æ–‡ä»¶é“¾æ¥ï¼ˆindex.html, syllabus.htmlç­‰ï¼‰
            updatedHtml = updatedHtml.replace(/href="index\.html"/g, 'href="../../index.html"');
            updatedHtml = updatedHtml.replace(/href="\.\/([^/]*\.html)"/g, 'href="../../$1"');
            
            // å¤„ç†æ¨¡å—è·¯å¾„é“¾æ¥ï¼ˆå·²ç»æ˜¯å®Œæ•´ç›¸å¯¹è·¯å¾„ï¼Œåªéœ€è¦æ·»åŠ æ ¹è·¯å¾„å‰ç¼€ï¼‰
            updatedHtml = updatedHtml.replace(/href="\.\/part([^"]*)"/g, 'href="../../part$1"');
            
            document.getElementById('navigation-container').innerHTML = updatedHtml;
            
            // æ·»åŠ ç§»åŠ¨ç«¯èœå•åˆ‡æ¢åŠŸèƒ½
            const menuToggle = document.getElementById('menuToggle');
            const navMenu = document.querySelector('.nav-menu');
            if (menuToggle && navMenu) {
                menuToggle.addEventListener('click', function() {
                    navMenu.classList.toggle('active');
                });
            }
        })
        .catch(error => console.error('å¯¼èˆªåŠ è½½å¤±è´¥:', error));
}

// é¡µé¢åŠ è½½å®ŒæˆååŠ è½½å¯¼èˆª
document.addEventListener('DOMContentLoaded', loadNavigation);
</script>



<main class="container">
        <section class="theory-section">
            <h2>ğŸ“š æ•°å­¦ç†è®ºåŸºç¡€</h2>
            <div class="theory-content">
                <h3>1. ç°ä»£æŠ•èµ„ç»„åˆç†è®ºçš„æ•°å­¦æ¡†æ¶</h3>
                <p><strong>åŸºæœ¬å‡è®¾ï¼š</strong>æŠ•èµ„è€…æ˜¯é£é™©åŒæ¶çš„ï¼Œè¿½æ±‚æœŸæœ›æ•ˆç”¨æœ€å¤§åŒ–ã€‚</p>
                <h3>2. æŠ•èµ„ç»„åˆæ”¶ç›Šç‡</h3>
                <div class="concept-explanation">
                    <h4>ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦æŠ•èµ„ç»„åˆæ”¶ç›Šç‡å…¬å¼ï¼Ÿ</h4>
                    <p><strong>ç°å®æ„ä¹‰ï¼š</strong>å°±åƒåšèœæ—¶éœ€è¦çŸ¥é“å„ç§è°ƒæ–™çš„æ¯”ä¾‹æ¥é¢„æµ‹æœ€ç»ˆå£å‘³ï¼ŒæŠ•èµ„æ—¶ä¹Ÿéœ€è¦çŸ¥é“å„èµ„äº§çš„æƒé‡æ¥é¢„æµ‹æ•´ä½“æ”¶ç›Šã€‚</p>
                    <p><strong>é‡‘èåº”ç”¨ï¼š</strong>åŸºé‡‘ç»ç†ç®¡ç†100äº¿èµ„é‡‘ï¼Œ60%æŠ•èµ„è‚¡ç¥¨(é¢„æœŸæ”¶ç›Š8%)ï¼Œ40%æŠ•èµ„å€ºåˆ¸(é¢„æœŸæ”¶ç›Š3%)ï¼Œå¦‚ä½•è®¡ç®—æ•´ä½“é¢„æœŸæ”¶ç›Šï¼Ÿ</p>
                    <p><strong>æ•°å­¦æœ¬è´¨ï¼š</strong>è¿™æ˜¯åŠ æƒå¹³å‡çš„æ¦‚å¿µï¼Œæƒé‡åæ˜ äº†å„èµ„äº§åœ¨æŠ•èµ„ç»„åˆä¸­çš„é‡è¦æ€§ã€‚</p>
                </div>
                <div class="math-formula">
                    <p><strong>æŠ•èµ„ç»„åˆæœŸæœ›æ”¶ç›Šç‡ï¼š</strong></p>
                    <p>\[ E(R_p) = \sum_{i=1}^{n} w_i E(R_i) \]</p>
                    <p>å…¶ä¸­ \(w_i\) æ˜¯èµ„äº§ \(i\) çš„æƒé‡ï¼Œ\(E(R_i)\) æ˜¯èµ„äº§ \(i\) çš„æœŸæœ›æ”¶ç›Šç‡ï¼Œä¸” \(\sum_{i=1}^{n} w_i = 1\)ã€‚</p>
                </div>
                <div class="formula-explanation">å…¬å¼å«ä¹‰ï¼šæŠ•èµ„ç»„åˆçš„æœŸæœ›æ”¶ç›Šç­‰äºå„èµ„äº§æœŸæœ›æ”¶ç›Šçš„åŠ æƒå¹³å‡</div>
                
                <div class="calculation-example">
                    <h4>ğŸ“Š æ¨å¯¼è¿‡ç¨‹ä¸è®¡ç®—ç¤ºä¾‹</h4>
                    <p><strong>æ¨å¯¼è¿‡ç¨‹ï¼š</strong></p>
                    <p>è®¾æŠ•èµ„ç»„åˆåŒ…å«nç§èµ„äº§ï¼ŒæŠ•èµ„é‡‘é¢åˆ†åˆ«ä¸º \(V_1, V_2, ..., V_n\)ï¼Œæ€»æŠ•èµ„é‡‘é¢ä¸º \(V = \sum_{i=1}^{n} V_i\)</p>
                    <p>æƒé‡å®šä¹‰ï¼š\(w_i = \frac{V_i}{V}\)ï¼Œæ˜¾ç„¶ \(\sum_{i=1}^{n} w_i = 1\)</p>
                    <p>æŠ•èµ„ç»„åˆæ”¶ç›Šç‡ï¼š\(R_p = \frac{\sum_{i=1}^{n} V_i R_i}{V} = \sum_{i=1}^{n} \frac{V_i}{V} R_i = \sum_{i=1}^{n} w_i R_i\)</p>
                    <p>å–æœŸæœ›ï¼š\(E(R_p) = E[\sum_{i=1}^{n} w_i R_i] = \sum_{i=1}^{n} w_i E(R_i)\)</p>
                    
                    <p><strong>å®é™…è®¡ç®—ç¤ºä¾‹ï¼š</strong></p>
                    <p>å‡è®¾æŸæŠ•èµ„ç»„åˆåŒ…å«ä¸‰åªè‚¡ç¥¨ï¼š</p>
                    <ul>
                        <li>è‚¡ç¥¨Aï¼šæƒé‡30%ï¼Œé¢„æœŸæ”¶ç›Šç‡12%</li>
                        <li>è‚¡ç¥¨Bï¼šæƒé‡50%ï¼Œé¢„æœŸæ”¶ç›Šç‡8%</li>
                        <li>è‚¡ç¥¨Cï¼šæƒé‡20%ï¼Œé¢„æœŸæ”¶ç›Šç‡15%</li>
                    </ul>
                    <p>è®¡ç®—è¿‡ç¨‹ï¼š</p>
                    <p>\(E(R_p) = 0.3 \times 0.12 + 0.5 \times 0.08 + 0.2 \times 0.15\)</p>
                    <p>\(E(R_p) = 0.036 + 0.04 + 0.03 = 0.106 = 10.6\%\)</p>
                    <p><strong>ç»“è®ºï¼š</strong>è¯¥æŠ•èµ„ç»„åˆçš„é¢„æœŸæ”¶ç›Šç‡ä¸º10.6%</p>
                </div>
                <h3>3. æŠ•èµ„ç»„åˆé£é™©</h3>
                <div class="concept-explanation">
                    <h4>ğŸ’¡ ä¸ºä»€ä¹ˆæŠ•èµ„ç»„åˆé£é™©ä¸æ˜¯ç®€å•çš„åŠ æƒå¹³å‡ï¼Ÿ</h4>
                    <p><strong>ç›´è§‰ç†è§£ï¼š</strong>"ä¸è¦æŠŠé¸¡è›‹æ”¾åœ¨ä¸€ä¸ªç¯®å­é‡Œ"â€”â€”åˆ†æ•£æŠ•èµ„å¯ä»¥é™ä½é£é™©ï¼Œè¿™æ˜¯å› ä¸ºä¸åŒèµ„äº§çš„ä»·æ ¼æ³¢åŠ¨å¾€å¾€ä¸å®Œå…¨åŒæ­¥ã€‚</p>
                    <p><strong>æ•°å­¦åŸå› ï¼š</strong>é£é™©æ¶‰åŠæ³¢åŠ¨æ€§çš„ç›¸äº’ä½œç”¨ï¼Œä¸¤ä¸ªèµ„äº§çš„è”åˆæ³¢åŠ¨ä¸ç­‰äºå„è‡ªæ³¢åŠ¨çš„ç®€å•ç›¸åŠ ã€‚</p>
                    <p><strong>å…³é”®æ¦‚å¿µï¼š</strong>åæ–¹å·®è¡¡é‡ä¸¤ä¸ªèµ„äº§æ”¶ç›Šç‡çš„å…±åŒå˜åŠ¨ç¨‹åº¦ï¼Œæ˜¯åˆ†æ•£åŒ–æ•ˆåº”çš„æ ¸å¿ƒã€‚</p>
                </div>
                <div class="math-formula">
                    <p><strong>æŠ•èµ„ç»„åˆæ–¹å·®ï¼š</strong></p>
                    <p>\[ \sigma_p^2 = \sum_{i=1}^{n} \sum_{j=1}^{n} w_i w_j \sigma_{ij} \]</p>
                    <p>å…¶ä¸­ \(\sigma_{ij}\) æ˜¯èµ„äº§ \(i\) å’Œèµ„äº§ \(j\) çš„åæ–¹å·®ã€‚</p>
                </div>
                <div class="math-formula">
                    <p><strong>åæ–¹å·®çš„å®šä¹‰ï¼š</strong></p>
                    <p>\[ \sigma_{ij} = \text{Cov}(R_i, R_j) = E[(R_i - E(R_i))(R_j - E(R_j))] \]</p>
                    <p><strong>ç›¸å…³ç³»æ•°ï¼š</strong></p>
                    <p>\[ \rho_{ij} = \frac{\sigma_{ij}}{\sigma_i \sigma_j} \]</p>
                </div>
                <div class="formula-explanation">å…¬å¼å«ä¹‰ï¼šæŠ•èµ„ç»„åˆé£é™©è€ƒè™‘äº†æ‰€æœ‰èµ„äº§é—´çš„ç›¸äº’ä½œç”¨ï¼ŒåŒ…æ‹¬å„è‡ªçš„é£é™©å’Œç›¸äº’å…³ç³»</div>
                
                <div class="calculation-example">
                    <h4>ğŸ“Š æ¨å¯¼è¿‡ç¨‹ä¸è®¡ç®—ç¤ºä¾‹</h4>
                    <p><strong>æ¨å¯¼è¿‡ç¨‹ï¼š</strong></p>
                    <p>æŠ•èµ„ç»„åˆæ”¶ç›Šç‡ï¼š\(R_p = \sum_{i=1}^{n} w_i R_i\)</p>
                    <p>æŠ•èµ„ç»„åˆæ–¹å·®ï¼š\(\sigma_p^2 = \text{Var}(R_p) = \text{Var}(\sum_{i=1}^{n} w_i R_i)\)</p>
                    <p>åˆ©ç”¨æ–¹å·®æ€§è´¨ï¼š\(\text{Var}(\sum_{i=1}^{n} w_i R_i) = \sum_{i=1}^{n} \sum_{j=1}^{n} w_i w_j \text{Cov}(R_i, R_j)\)</p>
                    <p>å³ï¼š\(\sigma_p^2 = \sum_{i=1}^{n} \sum_{j=1}^{n} w_i w_j \sigma_{ij}\)</p>
                    
                    <p><strong>ä¸¤èµ„äº§æƒ…å†µçš„è¯¦ç»†å±•å¼€ï¼š</strong></p>
                    <p>\(\sigma_p^2 = w_1^2\sigma_1^2 + w_2^2\sigma_2^2 + 2w_1w_2\sigma_{12}\)</p>
                    <p>\(\sigma_p^2 = w_1^2\sigma_1^2 + w_2^2\sigma_2^2 + 2w_1w_2\rho_{12}\sigma_1\sigma_2\)</p>
                    
                    <p><strong>å®é™…è®¡ç®—ç¤ºä¾‹ï¼š</strong></p>
                    <p>è€ƒè™‘ä¸¤èµ„äº§æŠ•èµ„ç»„åˆï¼š</p>
                    <ul>
                        <li>è‚¡ç¥¨Aï¼šæƒé‡60%ï¼Œæ ‡å‡†å·®20%</li>
                        <li>è‚¡ç¥¨Bï¼šæƒé‡40%ï¼Œæ ‡å‡†å·®15%</li>
                        <li>ç›¸å…³ç³»æ•°ï¼š0.3</li>
                    </ul>
                    <p>è®¡ç®—è¿‡ç¨‹ï¼š</p>
                    <p>\(\sigma_p^2 = (0.6)^2 \times (0.2)^2 + (0.4)^2 \times (0.15)^2 + 2 \times 0.6 \times 0.4 \times 0.3 \times 0.2 \times 0.15\)</p>
                    <p>\(\sigma_p^2 = 0.36 \times 0.04 + 0.16 \times 0.0225 + 2 \times 0.6 \times 0.4 \times 0.3 \times 0.03\)</p>
                    <p>\(\sigma_p^2 = 0.0144 + 0.0036 + 0.00432 = 0.02232\)</p>
                    <p>\(\sigma_p = \sqrt{0.02232} = 0.1494 = 14.94\%\)</p>
                    
                    <p><strong>åˆ†æ•£åŒ–æ•ˆåº”åˆ†æï¼š</strong></p>
                    <p>å¦‚æœä¸¤èµ„äº§å®Œå…¨æ­£ç›¸å…³(Ï=1)ï¼š\(\sigma_p = 0.6 \times 0.2 + 0.4 \times 0.15 = 18\%\)</p>
                    <p>å®é™…é£é™©14.94% < 18%ï¼Œè¯´æ˜åˆ†æ•£åŒ–é™ä½äº†é£é™©ï¼</p>
                </div>
                <h3>4. æœ‰æ•ˆå‰æ²¿</h3>
                <div class="concept-explanation">
                    <h4>ğŸ’¡ ä»€ä¹ˆæ˜¯æœ‰æ•ˆå‰æ²¿ï¼Ÿ</h4>
                    <p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong>åœ¨ç»™å®šé£é™©æ°´å¹³ä¸‹è·å¾—æœ€é«˜æ”¶ç›Šï¼Œæˆ–åœ¨ç»™å®šæ”¶ç›Šæ°´å¹³ä¸‹æ‰¿æ‹…æœ€ä½é£é™©ã€‚</p>
                    <p><strong>å‡ ä½•ç›´è§‰ï¼š</strong>åœ¨æ”¶ç›Š-é£é™©åæ ‡ç³»ä¸­ï¼Œæœ‰æ•ˆå‰æ²¿æ˜¯ä¸€æ¡å‘ä¸Šå¼¯æ›²çš„æ›²çº¿ï¼Œä»£è¡¨æ‰€æœ‰æœ€ä¼˜æŠ•èµ„ç»„åˆã€‚</p>
                    <p><strong>å®é™…æ„ä¹‰ï¼š</strong>å¸®åŠ©æŠ•èµ„è€…åœ¨ä¼—å¤šå¯èƒ½çš„æŠ•èµ„ç»„åˆä¸­æ‰¾åˆ°æœ€ä¼˜é€‰æ‹©ã€‚</p>
                </div>
                <div class="concept-explanation">
                    <h4>ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦å‡å€¼-æ–¹å·®ä¼˜åŒ–ï¼Ÿ</h4>
                    <p>æŠ•èµ„è€…é¢ä¸´é£é™©ä¸æ”¶ç›Šçš„æƒè¡¡ï¼šé«˜æ”¶ç›Šå¾€å¾€ä¼´éšé«˜é£é™©ã€‚å‡å€¼-æ–¹å·®ä¼˜åŒ–å¸®åŠ©æ‰¾åˆ°ç»™å®šæ”¶ç›Šä¸‹é£é™©æœ€å°çš„æŠ•èµ„ç»„åˆã€‚</p>
                    <p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong>é€šè¿‡æ•°å­¦ä¼˜åŒ–æ–¹æ³•ï¼Œåœ¨ä¼—å¤šå¯èƒ½çš„æŠ•èµ„ç»„åˆä¸­æ‰¾åˆ°æœ€ä¼˜é…ç½®ã€‚</p>
                    <p><strong>å®é™…ä»·å€¼ï¼š</strong>ä¸ºæœºæ„æŠ•èµ„è€…æä¾›ç§‘å­¦çš„èµ„äº§é…ç½®ä¾æ®ã€‚</p>
                </div>
                
                <div class="math-formula">
                    <div class="concept-explanation">
                        <h4>ğŸ” ä¼˜åŒ–é—®é¢˜çš„æ•°å­¦è¡¨è¿°</h4>
                        <p><strong>ç›®æ ‡ï¼š</strong>åœ¨ç»™å®šæœŸæœ›æ”¶ç›Šä¸‹ï¼Œæœ€å°åŒ–æŠ•èµ„ç»„åˆé£é™©</p>
                        <p><strong>å†³ç­–å˜é‡ï¼š</strong>å„èµ„äº§çš„æŠ•èµ„æƒé‡</p>
                    </div>
                    <p><strong>å‡å€¼-æ–¹å·®ä¼˜åŒ–é—®é¢˜ï¼š</strong></p>
                    <p>æœ€å°åŒ–ï¼š\[ \sigma_p^2 = \mathbf{w}^T \mathbf{\Sigma} \mathbf{w} \]</p>
                    <p>çº¦æŸæ¡ä»¶ï¼š</p>
                    \[ \mathbf{w}^T \mathbf{\mu} = \mu_p \]
                    \[ \mathbf{w}^T \mathbf{1} = 1 \]
                    <div class="formula-explanation">
                        <p><strong>æ•°å­¦ç¬¦å·è¯¦è§£ï¼š</strong></p>
                        <ul>
                            <li><strong>wï¼š</strong>nÃ—1æƒé‡å‘é‡ï¼Œw_iè¡¨ç¤ºèµ„äº§içš„æŠ•èµ„æ¯”ä¾‹</li>
                            <li><strong>Î£ï¼š</strong>nÃ—nåæ–¹å·®çŸ©é˜µï¼ŒÎ£_{ij}è¡¨ç¤ºèµ„äº§iå’Œjçš„åæ–¹å·®</li>
                            <li><strong>Î¼ï¼š</strong>nÃ—1æœŸæœ›æ”¶ç›Šå‘é‡ï¼ŒÎ¼_iè¡¨ç¤ºèµ„äº§içš„æœŸæœ›æ”¶ç›Šç‡</li>
                            <li><strong>Î¼_pï¼š</strong>ç›®æ ‡æŠ•èµ„ç»„åˆæœŸæœ›æ”¶ç›Šç‡</li>
                            <li><strong>1ï¼š</strong>nÃ—1å…¨1å‘é‡</li>
                        </ul>
                        <p><strong>çº¦æŸæ¡ä»¶å«ä¹‰ï¼š</strong></p>
                        <pre>
ç¬¬ä¸€ä¸ªçº¦æŸï¼šw^T Î¼ = Î¼_p
å«ä¹‰ï¼šæŠ•èµ„ç»„åˆçš„æœŸæœ›æ”¶ç›Šç‡ç­‰äºç›®æ ‡æ”¶ç›Šç‡
å±•å¼€ï¼šwâ‚Î¼â‚ + wâ‚‚Î¼â‚‚ + ... + wâ‚™Î¼â‚™ = Î¼_p

ç¬¬äºŒä¸ªçº¦æŸï¼šw^T 1 = 1  
å«ä¹‰ï¼šæ‰€æœ‰èµ„äº§æƒé‡ä¹‹å’Œç­‰äº1ï¼ˆèµ„é‡‘å®Œå…¨æŠ•å…¥ï¼‰
å±•å¼€ï¼šwâ‚ + wâ‚‚ + ... + wâ‚™ = 1
                        </pre>
                        <p><strong>ç›®æ ‡å‡½æ•°æ¨å¯¼ï¼š</strong></p>
                        <pre>
æŠ•èµ„ç»„åˆæ–¹å·®çš„çŸ©é˜µè¡¨ç¤ºï¼š
Ïƒ_pÂ² = Var(wâ‚Râ‚ + wâ‚‚Râ‚‚ + ... + wâ‚™Râ‚™)
     = Î£áµ¢ Î£â±¼ wáµ¢wâ±¼ Cov(Ráµ¢,Râ±¼)
     = Î£áµ¢ Î£â±¼ wáµ¢wâ±¼ Î£áµ¢â±¼
     = w^T Î£ w

è¿™å°±æ˜¯æˆ‘ä»¬è¦æœ€å°åŒ–çš„ç›®æ ‡å‡½æ•°
                        </pre>
                    </div>
                    <p>å…¶ä¸­ \(\mathbf{w}\) æ˜¯æƒé‡å‘é‡ï¼Œ\(\mathbf{\Sigma}\) æ˜¯åæ–¹å·®çŸ©é˜µï¼Œ\(\mathbf{\mu}\) æ˜¯æœŸæœ›æ”¶ç›Šå‘é‡ã€‚</p>
                </div>
                <div class="concept-explanation">
                    <h4>ğŸ” å…·ä½“è®¡ç®—ç¤ºä¾‹</h4>
                    <p><strong>ä¸¤èµ„äº§ç»„åˆæ¡ˆä¾‹ï¼š</strong>è‚¡ç¥¨Aå’Œè‚¡ç¥¨Bçš„æœ€ä¼˜é…ç½®</p>
                </div>
                <div class="formula-explanation">
                    <p><strong>ç»™å®šæ•°æ®ï¼š</strong></p>
                    <pre>
è‚¡ç¥¨Aï¼šæœŸæœ›æ”¶ç›Šç‡ Î¼_A = 12%ï¼Œæ ‡å‡†å·® Ïƒ_A = 20%
è‚¡ç¥¨Bï¼šæœŸæœ›æ”¶ç›Šç‡ Î¼_B = 8%ï¼Œæ ‡å‡†å·® Ïƒ_B = 15%
ç›¸å…³ç³»æ•°ï¼šÏ_{AB} = 0.3
ç›®æ ‡æ”¶ç›Šç‡ï¼šÎ¼_p = 10%

åæ–¹å·®ï¼šÏƒ_{AB} = Ï_{AB} Ã— Ïƒ_A Ã— Ïƒ_B = 0.3 Ã— 0.20 Ã— 0.15 = 0.009
                    </pre>
                    <p><strong>æ„å»ºä¼˜åŒ–é—®é¢˜ï¼š</strong></p>
                    <pre>
è®¾è‚¡ç¥¨Açš„æƒé‡ä¸ºw_Aï¼Œè‚¡ç¥¨Bçš„æƒé‡ä¸ºw_B = 1 - w_A

ç›®æ ‡å‡½æ•°ï¼š
min Ïƒ_pÂ² = w_AÂ² Ã— Ïƒ_AÂ² + (1-w_A)Â² Ã— Ïƒ_BÂ² + 2w_A(1-w_A) Ã— Ïƒ_{AB}
         = w_AÂ² Ã— 0.04 + (1-w_A)Â² Ã— 0.0225 + 2w_A(1-w_A) Ã— 0.009

çº¦æŸæ¡ä»¶ï¼š
w_A Ã— 0.12 + (1-w_A) Ã— 0.08 = 0.10
åŒ–ç®€ï¼š0.12w_A + 0.08 - 0.08w_A = 0.10
      0.04w_A = 0.02
      w_A = 0.5

å› æ­¤ï¼šw_A = 50%ï¼Œw_B = 50%
                    </pre>
                    <p><strong>éªŒè¯ç»“æœï¼š</strong></p>
                    <pre>
æŠ•èµ„ç»„åˆæœŸæœ›æ”¶ç›Šï¼š
Î¼_p = 0.5 Ã— 12% + 0.5 Ã— 8% = 10% âœ“

æŠ•èµ„ç»„åˆé£é™©ï¼š
Ïƒ_pÂ² = 0.5Â² Ã— 0.04 + 0.5Â² Ã— 0.0225 + 2 Ã— 0.5 Ã— 0.5 Ã— 0.009
     = 0.01 + 0.005625 + 0.0045
     = 0.020125
Ïƒ_p = âˆš0.020125 â‰ˆ 14.19%

åˆ†æ•£åŒ–æ•ˆæœï¼š
åŠ æƒå¹³å‡é£é™©ï¼š0.5 Ã— 20% + 0.5 Ã— 15% = 17.5%
å®é™…ç»„åˆé£é™©ï¼š14.19%
é£é™©é™ä½ï¼š(17.5% - 14.19%) / 17.5% â‰ˆ 18.9%
                    </pre>
                </div>
                
                <div class="calculation-example">
                    <h4>ğŸ“Š æ‹‰æ ¼æœ—æ—¥ä¹˜æ•°æ³•æ±‚è§£</h4>
                    <p><strong>æ‹‰æ ¼æœ—æ—¥å‡½æ•°ï¼š</strong></p>
                    <p>\(L = \frac{1}{2} \mathbf{w}^T \mathbf{\Sigma} \mathbf{w} + \lambda_1 (1 - \mathbf{1}^T \mathbf{w}) + \lambda_2 (\mu_p - \mathbf{\mu}^T \mathbf{w})\)</p>
                    
                    <p><strong>ä¸€é˜¶æ¡ä»¶ï¼š</strong></p>
                    <p>\(\frac{\partial L}{\partial \mathbf{w}} = \mathbf{\Sigma} \mathbf{w} - \lambda_1 \mathbf{1} - \lambda_2 \mathbf{\mu} = 0\)</p>
                    <p>\(\frac{\partial L}{\partial \lambda_1} = 1 - \mathbf{1}^T \mathbf{w} = 0\)</p>
                    <p>\(\frac{\partial L}{\partial \lambda_2} = \mu_p - \mathbf{\mu}^T \mathbf{w} = 0\)</p>
                    
                    <p><strong>è§£å¾—æœ€ä¼˜æƒé‡ï¼š</strong></p>
                    <p>\(\mathbf{w}^* = \mathbf{\Sigma}^{-1}(\lambda_1 \mathbf{1} + \lambda_2 \mathbf{\mu})\)</p>
                    
                    <p><strong>æœ‰æ•ˆå‰æ²¿æ–¹ç¨‹ï¼š</strong></p>
                    <p>\(\sigma_p^2 = \frac{A\mu_p^2 - 2B\mu_p + C}{D}\)</p>
                    <p>å…¶ä¸­ï¼š\(A = \mathbf{1}^T\mathbf{\Sigma}^{-1}\mathbf{1}\)ï¼Œ\(B = \mathbf{1}^T\mathbf{\Sigma}^{-1}\mathbf{\mu}\)ï¼Œ\(C = \mathbf{\mu}^T\mathbf{\Sigma}^{-1}\mathbf{\mu}\)ï¼Œ\(D = AC - B^2\)</p>
                </div>
                
                <h3>5. å¤æ™®æ¯”ç‡</h3>
                <div class="concept-explanation">
                    <h4>ğŸ’¡ å¤æ™®æ¯”ç‡çš„ç»æµå«ä¹‰</h4>
                    <p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong>è¡¡é‡æ¯æ‰¿æ‹…ä¸€å•ä½é£é™©æ‰€è·å¾—çš„è¶…é¢æ”¶ç›Šï¼Œæ˜¯é£é™©è°ƒæ•´åæ”¶ç›Šçš„é‡è¦æŒ‡æ ‡ã€‚</p>
                    <p><strong>å®é™…åº”ç”¨ï¼š</strong>æ¯”è¾ƒä¸åŒæŠ•èµ„ç­–ç•¥çš„ä¼˜åŠ£ï¼Œå¤æ™®æ¯”ç‡è¶Šé«˜ï¼ŒæŠ•èµ„æ•ˆç‡è¶Šå¥½ã€‚</p>
                    <p><strong>å†³ç­–æ„ä¹‰ï¼š</strong>å¸®åŠ©æŠ•èµ„è€…åœ¨é£é™©å’Œæ”¶ç›Šä¹‹é—´åšå‡ºç†æ€§æƒè¡¡ã€‚</p>
                </div>
                <div class="math-formula">
                    <p><strong>å¤æ™®æ¯”ç‡å®šä¹‰ï¼š</strong></p>
                    <p>\[ \text{Sharpe Ratio} = \frac{E(R_p) - R_f}{\sigma_p} \]</p>
                    <p>å…¶ä¸­ \(R_f\) æ˜¯æ— é£é™©æ”¶ç›Šç‡ï¼Œè¡¡é‡å•ä½é£é™©çš„è¶…é¢æ”¶ç›Šã€‚</p>
                </div>
                <div class="formula-explanation">å…¬å¼å«ä¹‰ï¼šå•ä½é£é™©æ‰€è·å¾—çš„é£é™©æº¢ä»·ï¼Œæ•°å€¼è¶Šå¤§è¡¨ç¤ºæŠ•èµ„æ•ˆç‡è¶Šé«˜</div>
                
                <div class="calculation-example">
                    <h4>ğŸ“Š å¤æ™®æ¯”ç‡è®¡ç®—ç¤ºä¾‹</h4>
                    <p><strong>å®é™…æ¡ˆä¾‹ï¼š</strong></p>
                    <p>æ¯”è¾ƒä¸‰ä¸ªæŠ•èµ„ç»„åˆçš„è¡¨ç°ï¼š</p>
                    <table style="border-collapse: collapse; width: 100%; margin: 10px 0;">
                        <tr style="background-color: #f0f0f0;">
                            <th style="border: 1px solid #ddd; padding: 8px;">æŠ•èµ„ç»„åˆ</th>
                            <th style="border: 1px solid #ddd; padding: 8px;">æœŸæœ›æ”¶ç›Šç‡</th>
                            <th style="border: 1px solid #ddd; padding: 8px;">æ ‡å‡†å·®</th>
                            <th style="border: 1px solid #ddd; padding: 8px;">å¤æ™®æ¯”ç‡</th>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;">ç»„åˆA</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">12%</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">18%</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">\(\frac{0.12-0.03}{0.18} = 0.50\)</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;">ç»„åˆB</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">10%</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">12%</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">\(\frac{0.10-0.03}{0.12} = 0.58\)</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;">ç»„åˆC</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">15%</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">25%</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">\(\frac{0.15-0.03}{0.25} = 0.48\)</td>
                        </tr>
                    </table>
                    <p>å‡è®¾æ— é£é™©åˆ©ç‡ \(R_f = 3\%\)</p>
                    <p><strong>ç»“è®ºï¼š</strong>ç»„åˆBçš„å¤æ™®æ¯”ç‡æœ€é«˜(0.58)ï¼Œè¡¨æ˜å…¶é£é™©è°ƒæ•´åæ”¶ç›Šæœ€ä¼˜ï¼Œå°½ç®¡ç»å¯¹æ”¶ç›Šä¸æ˜¯æœ€é«˜ã€‚</p>
                    
                    <p><strong>å¤æ™®æ¯”ç‡çš„å‡ ä½•è§£é‡Šï¼š</strong></p>
                    <p>åœ¨å‡å€¼-æ ‡å‡†å·®å›¾ä¸­ï¼Œå¤æ™®æ¯”ç‡ç­‰äºä»æ— é£é™©èµ„äº§ç‚¹åˆ°æŠ•èµ„ç»„åˆç‚¹è¿çº¿çš„æ–œç‡ã€‚æ–œç‡è¶Šå¤§ï¼ŒæŠ•èµ„æ•ˆç‡è¶Šé«˜ã€‚</p>
                </div>
                <h3>6. èµ„æœ¬èµ„äº§å®šä»·æ¨¡å‹(CAPM)</h3>
                <div class="concept-explanation">
                    <h4>ğŸ’¡ CAPMæ¨¡å‹çš„æ ¸å¿ƒæ€æƒ³</h4>
                    <p>CAPMæ¨¡å‹å›ç­”äº†ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜ï¼šåœ¨æœ‰æ•ˆå¸‚åœºä¸­ï¼Œèµ„äº§çš„æœŸæœ›æ”¶ç›Šç‡åº”è¯¥æ˜¯å¤šå°‘ï¼Ÿ</p>
                    <p><strong>åŸºæœ¬å‡è®¾ï¼š</strong>æŠ•èµ„è€…ç†æ€§ã€å¸‚åœºæœ‰æ•ˆã€ä¿¡æ¯å®Œå…¨ã€æ— äº¤æ˜“æˆæœ¬ã€‚</p>
                    <p><strong>æ ¸å¿ƒæ´å¯Ÿï¼š</strong>åªæœ‰ç³»ç»Ÿæ€§é£é™©ï¼ˆä¸å¯åˆ†æ•£é£é™©ï¼‰æ‰èƒ½è·å¾—é£é™©è¡¥å¿ã€‚</p>
                    <p><strong>å®é™…åº”ç”¨ï¼š</strong>è‚¡ç¥¨ä¼°å€¼ã€æŠ•èµ„å†³ç­–ã€ä¸šç»©è¯„ä¼°ã€èµ„æœ¬æˆæœ¬è®¡ç®—ã€‚</p>
                </div>
                
                <div class="math-formula">
                    <div class="concept-explanation">
                        <h4>ğŸ” CAPMå…¬å¼æ¨å¯¼</h4>
                        <p><strong>æ¨å¯¼æ€è·¯ï¼š</strong>ä»æŠ•èµ„ç»„åˆç†è®ºå‡ºå‘ï¼Œè€ƒè™‘å¸‚åœºå‡è¡¡æ¡ä»¶</p>
                        <p><strong>å…³é”®å‡è®¾ï¼š</strong>æ‰€æœ‰æŠ•èµ„è€…éƒ½æŒæœ‰å¸‚åœºç»„åˆ</p>
                    </div>
                    <p><strong>CAPMå…¬å¼ï¼š</strong></p>
                    \[ E(R_i) = R_f + \beta_i [E(R_m) - R_f] \]
                    <div class="formula-explanation">
                        <p><strong>æ¨å¯¼è¿‡ç¨‹ï¼š</strong></p>
                        <pre>
æ­¥éª¤1ï¼šå¸‚åœºå‡è¡¡æ¡ä»¶
åœ¨å‡è¡¡çŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰èµ„äº§éƒ½åœ¨æœ‰æ•ˆå‰æ²¿ä¸Š
ä»»ä½•èµ„äº§ä¸å¸‚åœºç»„åˆçš„ç»„åˆä¹Ÿåº”åœ¨æœ‰æ•ˆå‰æ²¿ä¸Š

æ­¥éª¤2ï¼šæ„å»ºç»„åˆ
è€ƒè™‘èµ„äº§iä¸å¸‚åœºç»„åˆmçš„ç»„åˆï¼š
ç»„åˆæ”¶ç›Šï¼šR_p = Î±R_i + (1-Î±)R_m
ç»„åˆæ–¹å·®ï¼šÏƒ_pÂ² = Î±Â²Ïƒ_iÂ² + (1-Î±)Â²Ïƒ_mÂ² + 2Î±(1-Î±)Ïƒ_{im}

æ­¥éª¤3ï¼šæœ€ä¼˜åŒ–æ¡ä»¶
åœ¨Î±=0å¤„ï¼ˆçº¯å¸‚åœºç»„åˆï¼‰ï¼Œç»„åˆå¿…é¡»æ˜¯æœ€ä¼˜çš„
å³ï¼šdE(R_p)/dÎ±|_{Î±=0} / dÏƒ_p/dÎ±|_{Î±=0} = [E(R_m) - R_f] / Ïƒ_m

æ­¥éª¤4ï¼šè®¡ç®—å¯¼æ•°
dE(R_p)/dÎ± = E(R_i) - E(R_m)
dÏƒ_p/dÎ±|_{Î±=0} = Ïƒ_{im}/Ïƒ_m

æ­¥éª¤5ï¼šä»£å…¥å‡è¡¡æ¡ä»¶
[E(R_i) - E(R_m)] / [Ïƒ_{im}/Ïƒ_m] = [E(R_m) - R_f] / Ïƒ_m
åŒ–ç®€å¾—ï¼šE(R_i) = R_f + [Ïƒ_{im}/Ïƒ_mÂ²] Ã— [E(R_m) - R_f]

æ­¥éª¤6ï¼šå®šä¹‰Beta
Î²_i = Ïƒ_{im}/Ïƒ_mÂ² = Cov(R_i, R_m)/Var(R_m)

æœ€ç»ˆå¾—åˆ°ï¼šE(R_i) = R_f + Î²_i[E(R_m) - R_f]
                        </pre>
                        <p><strong>å…¬å¼ç»„æˆéƒ¨åˆ†ï¼š</strong></p>
                        <ul>
                            <li><strong>R_fï¼š</strong>æ— é£é™©æ”¶ç›Šç‡ï¼ˆå¦‚å›½å€ºæ”¶ç›Šç‡ï¼‰</li>
                            <li><strong>E(R_m) - R_fï¼š</strong>å¸‚åœºé£é™©æº¢ä»·</li>
                            <li><strong>Î²_iï¼š</strong>èµ„äº§içš„ç³»ç»Ÿæ€§é£é™©ç³»æ•°</li>
                            <li><strong>Î²_i[E(R_m) - R_f]ï¼š</strong>èµ„äº§içš„é£é™©æº¢ä»·</li>
                        </ul>
                    </div>
                    
                    <div class="concept-explanation">
                        <h4>ğŸ” Betaç³»æ•°æ·±åº¦è§£æ</h4>
                        <p><strong>ç»æµå«ä¹‰ï¼š</strong>è¡¡é‡èµ„äº§æ”¶ç›Šç‡å¯¹å¸‚åœºæ”¶ç›Šç‡å˜åŒ–çš„æ•æ„Ÿæ€§</p>
                        <p><strong>è®¡ç®—æ–¹æ³•ï¼š</strong>èµ„äº§ä¸å¸‚åœºçš„åæ–¹å·®é™¤ä»¥å¸‚åœºæ–¹å·®</p>
                    </div>
                    <p><strong>Betaç³»æ•°ï¼š</strong></p>
                    \[ \beta_i = \frac{\text{Cov}(R_i, R_m)}{\text{Var}(R_m)} \]
                    <div class="formula-explanation">
                        <p><strong>Betaå€¼çš„ç»æµå«ä¹‰ï¼š</strong></p>
                        <pre>
Î² = 1ï¼šèµ„äº§ä¸å¸‚åœºåŒæ­¥æ³¢åŠ¨
- å¸‚åœºæ¶¨10%ï¼Œèµ„äº§æœŸæœ›æ¶¨10%
- ç³»ç»Ÿæ€§é£é™©ç­‰äºå¸‚åœºå¹³å‡æ°´å¹³

Î² > 1ï¼šèµ„äº§æ¯”å¸‚åœºæ›´æ•æ„Ÿï¼ˆé«˜Betaè‚¡ç¥¨ï¼‰
- å¸‚åœºæ¶¨10%ï¼Œèµ„äº§æœŸæœ›æ¶¨è¶…è¿‡10%
- ç³»ç»Ÿæ€§é£é™©é«˜äºå¸‚åœºå¹³å‡æ°´å¹³
- ä¾‹å¦‚ï¼šç§‘æŠ€è‚¡ã€æˆé•¿è‚¡

Î² < 1ï¼šèµ„äº§æ¯”å¸‚åœºæ›´ç¨³å®šï¼ˆä½Betaè‚¡ç¥¨ï¼‰
- å¸‚åœºæ¶¨10%ï¼Œèµ„äº§æœŸæœ›æ¶¨ä¸åˆ°10%
- ç³»ç»Ÿæ€§é£é™©ä½äºå¸‚åœºå¹³å‡æ°´å¹³
- ä¾‹å¦‚ï¼šå…¬ç”¨äº‹ä¸šè‚¡ã€é˜²å¾¡æ€§è‚¡ç¥¨

Î² = 0ï¼šèµ„äº§æ”¶ç›Šä¸å¸‚åœºæ— å…³
- ç†è®ºä¸Šçš„æ— é£é™©èµ„äº§

Î² < 0ï¼šèµ„äº§ä¸å¸‚åœºåå‘æ³¢åŠ¨
- å¸‚åœºæ¶¨æ—¶èµ„äº§è·Œï¼Œå¸‚åœºè·Œæ—¶èµ„äº§æ¶¨
- ä¾‹å¦‚ï¼šé»„é‡‘ã€æŸäº›å¯¹å†²åŸºé‡‘
                        </pre>
                        <p><strong>Betaè®¡ç®—ç¤ºä¾‹ï¼š</strong></p>
                        <pre>
å‡è®¾æŸè‚¡ç¥¨ä¸å¸‚åœºçš„å†å²æ•°æ®ï¼š

æ—¶æœŸ    è‚¡ç¥¨æ”¶ç›Šç‡    å¸‚åœºæ”¶ç›Šç‡
1       8%           6%
2       -2%          -1%
3       15%          12%
4       5%           4%
5       -5%          -3%

è®¡ç®—æ­¥éª¤ï¼š
1. è®¡ç®—å¹³å‡æ”¶ç›Šç‡
   è‚¡ç¥¨å¹³å‡ï¼š(8-2+15+5-5)/5 = 4.2%
   å¸‚åœºå¹³å‡ï¼š(6-1+12+4-3)/5 = 3.6%

2. è®¡ç®—åæ–¹å·®
   Cov = Î£[(R_i - RÌ„_i)(R_m - RÌ„_m)] / (n-1)
   = [(8-4.2)(6-3.6) + (-2-4.2)(-1-3.6) + ... ] / 4
   = [3.8Ã—2.4 + (-6.2)Ã—(-4.6) + 10.8Ã—8.4 + 0.8Ã—0.4 + (-9.2)Ã—(-6.6)] / 4
   = [9.12 + 28.52 + 90.72 + 0.32 + 60.72] / 4
   = 189.4 / 4 = 47.35

3. è®¡ç®—å¸‚åœºæ–¹å·®
   Var(R_m) = Î£[(R_m - RÌ„_m)Â²] / (n-1)
   = [2.4Â² + (-4.6)Â² + 8.4Â² + 0.4Â² + (-6.6)Â²] / 4
   = [5.76 + 21.16 + 70.56 + 0.16 + 43.56] / 4
   = 141.2 / 4 = 35.3

4. è®¡ç®—Beta
   Î² = Cov(R_i, R_m) / Var(R_m) = 47.35 / 35.3 â‰ˆ 1.34

è§£é‡Šï¼šè¯¥è‚¡ç¥¨çš„Betaä¸º1.34ï¼Œè¡¨æ˜å…¶ç³»ç»Ÿæ€§é£é™©é«˜äºå¸‚åœºå¹³å‡æ°´å¹³
      å½“å¸‚åœºä¸Šæ¶¨1%æ—¶ï¼Œè¯¥è‚¡ç¥¨æœŸæœ›ä¸Šæ¶¨1.34%
                        </pre>
                    </div>
                    
                    <div class="concept-explanation">
                        <h4>ğŸ” CAPMå®é™…åº”ç”¨ç¤ºä¾‹</h4>
                        <p><strong>è‚¡ç¥¨ä¼°å€¼ï¼š</strong>è®¡ç®—è‚¡ç¥¨çš„ç†è®ºæœŸæœ›æ”¶ç›Šç‡</p>
                    </div>
                    <div class="formula-explanation">
                        <p><strong>å®Œæ•´è®¡ç®—æ¡ˆä¾‹ï¼š</strong></p>
                        <pre>
ç»™å®šä¿¡æ¯ï¼š
- æ— é£é™©åˆ©ç‡ R_f = 3%
- å¸‚åœºæœŸæœ›æ”¶ç›Šç‡ E(R_m) = 10%
- æŸè‚¡ç¥¨çš„Beta Î² = 1.2

ä½¿ç”¨CAPMè®¡ç®—è‚¡ç¥¨æœŸæœ›æ”¶ç›Šç‡ï¼š
E(R_i) = R_f + Î²_i[E(R_m) - R_f]
       = 3% + 1.2 Ã— (10% - 3%)
       = 3% + 1.2 Ã— 7%
       = 3% + 8.4%
       = 11.4%

æŠ•èµ„å†³ç­–åˆ†æï¼š
å¦‚æœè¯¥è‚¡ç¥¨å½“å‰é¢„æœŸæ”¶ç›Šç‡ä¸ºï¼š
- 13%ï¼šé«˜äºCAPMé¢„æœŸ(11.4%)ï¼Œè¢«ä½ä¼°ï¼Œå»ºè®®ä¹°å…¥
- 9%ï¼šä½äºCAPMé¢„æœŸ(11.4%)ï¼Œè¢«é«˜ä¼°ï¼Œå»ºè®®å–å‡º
- 11.4%ï¼šç­‰äºCAPMé¢„æœŸï¼Œå®šä»·åˆç†
                        </pre>
                        <p><strong>èµ„æœ¬æˆæœ¬è®¡ç®—ï¼š</strong></p>
                        <pre>
ä¼ä¸šä½¿ç”¨CAPMè®¡ç®—è‚¡æƒèµ„æœ¬æˆæœ¬ï¼š

å‡è®¾æŸå…¬å¸ï¼š
- è‚¡ç¥¨Beta = 0.8
- æ— é£é™©åˆ©ç‡ = 4%
- å¸‚åœºé£é™©æº¢ä»· = 6%

è‚¡æƒèµ„æœ¬æˆæœ¬ = 4% + 0.8 Ã— 6% = 8.8%

è¿™æ„å‘³ç€ï¼š
1. æŠ•èµ„è€…è¦æ±‚è¯¥å…¬å¸æä¾›8.8%çš„è‚¡æƒå›æŠ¥ç‡
2. å…¬å¸æ–°é¡¹ç›®çš„æœ€ä½æ”¶ç›Šç‡è¦æ±‚ä¸º8.8%
3. ç”¨äºDCFä¼°å€¼çš„æŠ˜ç°ç‡ä¸º8.8%
                        </pre>
                        <p><strong>æŠ•èµ„ç»„åˆBetaè®¡ç®—ï¼š</strong></p>
                        <pre>
æŠ•èµ„ç»„åˆçš„Betaç­‰äºå„æˆåˆ†è‚¡Betaçš„åŠ æƒå¹³å‡ï¼š

å‡è®¾æŠ•èµ„ç»„åˆåŒ…å«ï¼š
- è‚¡ç¥¨Aï¼šæƒé‡30%ï¼ŒBeta = 1.5
- è‚¡ç¥¨Bï¼šæƒé‡50%ï¼ŒBeta = 0.8  
- è‚¡ç¥¨Cï¼šæƒé‡20%ï¼ŒBeta = 1.2

ç»„åˆBeta = 0.3Ã—1.5 + 0.5Ã—0.8 + 0.2Ã—1.2
          = 0.45 + 0.4 + 0.24
          = 1.09

ç»„åˆæœŸæœ›æ”¶ç›Šç‡ = 3% + 1.09Ã—(10%-3%) = 10.63%
                        </pre>
                    </div>
                    <p>å…¶ä¸­ \(R_m\) æ˜¯å¸‚åœºç»„åˆæ”¶ç›Šç‡ã€‚</p>
                </div>
            </div>
        </section>
        <section class="lesson-content">
            <h2>ç°ä»£æŠ•èµ„ç»„åˆç†è®º</h2>
            <p>ç°ä»£æŠ•èµ„ç»„åˆç†è®º(Modern Portfolio Theory, MPT)ç”±Harry Markowitzäº1952å¹´æå‡ºï¼Œå¼ºè°ƒé€šè¿‡èµ„äº§åˆ†æ•£åŒ–æ¥ä¼˜åŒ–é£é™©ä¸æ”¶ç›Šçš„å¹³è¡¡ã€‚</p>
            <h3>1. æ ¸å¿ƒæ¦‚å¿µ</h3>
            <pre><code class="language-python">import numpy as np
import pandas as pd
# å‡è®¾æˆ‘ä»¬æœ‰ä¸‰ç§èµ„äº§çš„æ”¶ç›Šç‡æ•°æ®
returns = pd.DataFrame({
    'Stock_A': [0.02, 0.03, -0.01, 0.04, 0.01],
    'Stock_B': [0.01, 0.05, -0.03, 0.03, 0.02],
    'Stock_C': [0.03, 0.02, 0.00, 0.05, -0.01]
})
# è®¡ç®—é¢„æœŸæ”¶ç›Šç‡
expected_returns = returns.mean()
print("é¢„æœŸæ”¶ç›Šç‡:\n", expected_returns)
# è®¡ç®—åæ–¹å·®çŸ©é˜µ
cov_matrix = returns.cov()
print("\nåæ–¹å·®çŸ©é˜µ:\n", cov_matrix)</code></pre>
            <h3>2. æŠ•èµ„ç»„åˆæ”¶ç›Šä¸é£é™©</h3>
            <pre><code class="language-python">def portfolio_performance(weights, expected_returns, cov_matrix):
    """è®¡ç®—æŠ•èµ„ç»„åˆçš„é¢„æœŸæ”¶ç›Šç‡å’Œé£é™©"""
    port_return = np.dot(weights.T, expected_returns)
    port_risk = np.sqrt(np.dot(weights.T, np.dot(cov_matrix, weights)))
    return port_return, port_risk
# ç­‰æƒé‡ç»„åˆ
weights = np.array([1/3, 1/3, 1/3])
return_, risk_ = portfolio_performance(weights, expected_returns, cov_matrix)
print(f"\nç­‰æƒé‡ç»„åˆ - é¢„æœŸæ”¶ç›Šç‡: {return_:.4f}, é£é™©: {risk_:.4f}")</code></pre>
        </section>
        <section class="lesson-content">
            <h2>æœ‰æ•ˆå‰æ²¿</h2>
            <p>æœ‰æ•ˆå‰æ²¿(Efficient Frontier)è¡¨ç¤ºåœ¨ç»™å®šé£é™©æ°´å¹³ä¸‹èƒ½å¤Ÿæä¾›æœ€é«˜é¢„æœŸæ”¶ç›Šçš„æŠ•èµ„ç»„åˆé›†åˆã€‚</p>
            <h3>1. æ„å»ºæœ‰æ•ˆå‰æ²¿</h3>
            <pre><code class="language-python">import matplotlib.pyplot as plt
def generate_efficient_frontier(expected_returns, cov_matrix, num_portfolios=10000):
    results = np.zeros((3, num_portfolios))
    for i in range(num_portfolios):
        weights = np.random.random(len(expected_returns))
        weights /= np.sum(weights)
        port_return, port_risk = portfolio_performance(weights, expected_returns, cov_matrix)
        results[0,i] = port_risk
        results[1,i] = port_return
        results[2,i] = (port_return - 0.02) / port_risk  # å‡è®¾æ— é£é™©åˆ©ç‡ä¸º2%
    return results
# ç”ŸæˆéšæœºæŠ•èµ„ç»„åˆ
results = generate_efficient_frontier(expected_returns, cov_matrix)
# ç»˜åˆ¶æœ‰æ•ˆå‰æ²¿
plt.figure(figsize=(10,6))
plt.scatter(results[0,:], results[1,:], c=results[2,:], cmap='viridis', alpha=0.3)
plt.colorbar(label='å¤æ™®æ¯”ç‡')
plt.xlabel('é£é™©(æ ‡å‡†å·®)')
plt.ylabel('é¢„æœŸæ”¶ç›Šç‡')
plt.title('æŠ•èµ„ç»„åˆæœ‰æ•ˆå‰æ²¿')
plt.show()</code></pre>
            <h3>2. æœ€ä¼˜æŠ•èµ„ç»„åˆ</h3>
            <pre><code class="language-python"># æ‰¾åˆ°æœ€å¤§å¤æ™®æ¯”ç‡ç»„åˆ
max_sharpe_idx = np.argmax(results[2])
max_sharpe_return = results[1, max_sharpe_idx]
max_sharpe_risk = results[0, max_sharpe_idx]
plt.scatter(max_sharpe_risk, max_sharpe_return, marker='*', color='r', s=300, label='æœ€ä¼˜ç»„åˆ')
plt.legend()
plt.show()</code></pre>
        </section>
        <section class="lesson-content">
            <h2>èµ„æœ¬èµ„äº§å®šä»·æ¨¡å‹(CAPM)</h2>
            <p>èµ„æœ¬èµ„äº§å®šä»·æ¨¡å‹(Capital Asset Pricing Model)æè¿°äº†èµ„äº§é¢„æœŸæ”¶ç›Šä¸ç³»ç»Ÿæ€§é£é™©ä¹‹é—´çš„å…³ç³»ã€‚</p>
            <h3>1. CAPMå…¬å¼</h3>
            <pre><code class="language-python">def capm(expected_market_return, risk_free_rate, beta):
    """è®¡ç®—èµ„äº§çš„é¢„æœŸæ”¶ç›Šç‡"""
    return risk_free_rate + beta * (expected_market_return - risk_free_rate)
# å‡è®¾å‚æ•°
risk_free_rate = 0.02  # æ— é£é™©åˆ©ç‡
expected_market_return = 0.08  # å¸‚åœºç»„åˆé¢„æœŸæ”¶ç›Šç‡
beta = 1.2  # èµ„äº§è´å¡”å€¼
expected_return = capm(expected_market_return, risk_free_rate, beta)
print(f"\næ ¹æ®CAPMè®¡ç®—çš„é¢„æœŸæ”¶ç›Šç‡: {expected_return:.4f}")</code></pre>
            <h3>2. è¯åˆ¸å¸‚åœºçº¿(SML)</h3>
            <pre><code class="language-python">betas = np.linspace(0, 2, 100)
expected_returns = [capm(expected_market_return, risk_free_rate, beta) for beta in betas]
plt.figure(figsize=(10,6))
plt.plot(betas, expected_returns, label='è¯åˆ¸å¸‚åœºçº¿(SML)')
plt.xlabel('è´å¡”ç³»æ•°(ç³»ç»Ÿæ€§é£é™©)')
plt.ylabel('é¢„æœŸæ”¶ç›Šç‡')
plt.title('èµ„æœ¬èµ„äº§å®šä»·æ¨¡å‹(CAPM)')
plt.legend()
plt.grid(True)
plt.show()</code></pre>
        </section>
        
        <section class="lesson-content">
            <h2>äº¤äº’å¼æŠ•èµ„ç»„åˆç†è®ºæ¼”ç¤º</h2>
            <p>é€šè¿‡ä»¥ä¸‹äº¤äº’å¼å·¥å…·ï¼Œæ·±å…¥ç†è§£ç°ä»£æŠ•èµ„ç»„åˆç†è®ºçš„æ ¸å¿ƒæ¦‚å¿µå’Œå®é™…åº”ç”¨ã€‚</p>
            
            <div class="portfolio-demo">
                <h4>ğŸ¯ æœ‰æ•ˆå‰æ²¿å¯è§†åŒ–</h4>
                <p>æ¢ç´¢ä¸åŒèµ„äº§ç»„åˆåœ¨é£é™©-æ”¶ç›Šç©ºé—´ä¸­çš„åˆ†å¸ƒï¼Œç†è§£æœ‰æ•ˆå‰æ²¿çš„å½¢æˆè¿‡ç¨‹</p>
                
                <div class="demo-controls">
                    <div class="control-group">
                        <label>èµ„äº§æ•°é‡</label>
                        <input type="range" id="assetCount" min="2" max="10" value="4" oninput="updateAssetInputs(); calculatePortfolio()">
                        <input type="number" id="assetCountNum" min="2" max="10" value="4" onchange="updateAssetInputs(); calculatePortfolio()">
                    </div>
                    <div class="control-group">
                        <label>ç»„åˆæ•°é‡</label>
                        <input type="range" id="portfolioCount" min="100" max="2000" value="1000" oninput="calculatePortfolio()">
                        <input type="number" id="portfolioCountNum" min="100" max="2000" value="1000" onchange="calculatePortfolio()">
                    </div>
                    <div class="control-group">
                        <label>æ— é£é™©åˆ©ç‡ (%)</label>
                        <input type="range" id="riskFreeRate" min="0" max="10" value="3" step="0.1" oninput="calculatePortfolio()">
                        <input type="number" id="riskFreeRateNum" min="0" max="10" value="3" step="0.1" onchange="calculatePortfolio()">
                    </div>
                    <div class="control-group">
                        <button class="demo-button" onclick="generateRandomAssets()">éšæœºç”Ÿæˆèµ„äº§</button>
                        <button class="demo-button" onclick="resetToDefault()">é‡ç½®é»˜è®¤å€¼</button>
                    </div>
                </div>
                
                <div id="assetInputsContainer" class="asset-inputs">
                    <!-- åŠ¨æ€ç”Ÿæˆçš„èµ„äº§è¾“å…¥æ¡† -->
                </div>
                
                <div class="portfolio-chart">
                    <div id="efficientFrontier"></div>
                </div>
                
                <div class="metrics-display">
                    <div class="metric-card">
                        <div class="metric-value" id="optimalReturn">--</div>
                        <div class="metric-label">æœ€ä¼˜ç»„åˆæ”¶ç›Šç‡ (%)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="optimalRisk">--</div>
                        <div class="metric-label">æœ€ä¼˜ç»„åˆé£é™© (%)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="sharpeRatio">--</div>
                        <div class="metric-label">å¤æ™®æ¯”ç‡</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="minVarianceReturn">--</div>
                        <div class="metric-label">æœ€å°æ–¹å·®ç»„åˆæ”¶ç›Šç‡ (%)</div>
                    </div>
                </div>
                
                <div class="formula-display">
                    <h5>å½“å‰è®¡ç®—å…¬å¼ï¼š</h5>
                    <div id="formulaDisplay">
                        æŠ•èµ„ç»„åˆæ”¶ç›Šç‡: E(Rp) = Î£ wi Ã— E(Ri)<br>
                        æŠ•èµ„ç»„åˆæ–¹å·®: ÏƒÂ²p = Î£ Î£ wi Ã— wj Ã— Ïƒij<br>
                        å¤æ™®æ¯”ç‡: SR = (E(Rp) - Rf) / Ïƒp
                    </div>
                </div>
            </div>
            
            <div class="portfolio-demo">
                <h4>ğŸ“Š ç›¸å…³æ€§çŸ©é˜µçƒ­åŠ›å›¾</h4>
                <p>å¯è§†åŒ–èµ„äº§é—´çš„ç›¸å…³æ€§ï¼Œç†è§£åˆ†æ•£åŒ–æŠ•èµ„çš„é‡è¦æ€§</p>
                
                <div class="demo-controls">
                    <div class="control-group">
                        <label>ç›¸å…³æ€§å¼ºåº¦</label>
                        <input type="range" id="correlationStrength" min="0" max="1" value="0.3" step="0.1" oninput="updateCorrelationMatrix()">
                        <input type="number" id="correlationStrengthNum" min="0" max="1" value="0.3" step="0.1" onchange="updateCorrelationMatrix()">
                    </div>
                    <div class="control-group">
                        <button class="demo-button" onclick="generateCorrelationMatrix()">ç”Ÿæˆæ–°çŸ©é˜µ</button>
                        <button class="demo-button" onclick="showIdentityMatrix()">å•ä½çŸ©é˜µ</button>
                    </div>
                </div>
                
                <div class="portfolio-chart">
                    <div id="correlationHeatmap"></div>
                </div>
            </div>
            
            <div class="portfolio-demo">
                <h4>âš–ï¸ é£é™©åˆ†è§£åˆ†æ</h4>
                <p>åˆ†ææŠ•èµ„ç»„åˆé£é™©çš„æ¥æºï¼Œç†è§£ç³»ç»Ÿæ€§é£é™©å’Œéç³»ç»Ÿæ€§é£é™©</p>
                
                <div class="demo-controls">
                    <div class="control-group">
                        <label>å¸‚åœºè´å¡”</label>
                        <input type="range" id="marketBeta" min="0.5" max="2" value="1" step="0.1" oninput="updateRiskDecomposition()">
                        <input type="number" id="marketBetaNum" min="0.5" max="2" value="1" step="0.1" onchange="updateRiskDecomposition()">
                    </div>
                    <div class="control-group">
                        <label>ç‰¹å¼‚æ€§é£é™© (%)</label>
                        <input type="range" id="specificRisk" min="5" max="50" value="20" oninput="updateRiskDecomposition()">
                        <input type="number" id="specificRiskNum" min="5" max="50" value="20" onchange="updateRiskDecomposition()">
                    </div>
                </div>
                
                <div class="portfolio-chart">
                    <div id="riskDecomposition"></div>
                </div>
                
                <div class="metrics-display">
                    <div class="metric-card">
                        <div class="metric-value" id="systematicRisk">--</div>
                        <div class="metric-label">ç³»ç»Ÿæ€§é£é™© (%)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="unsystematicRisk">--</div>
                        <div class="metric-label">éç³»ç»Ÿæ€§é£é™© (%)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="totalRisk">--</div>
                        <div class="metric-label">æ€»é£é™© (%)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="diversificationBenefit">--</div>
                        <div class="metric-label">åˆ†æ•£åŒ–æ”¶ç›Š (%)</div>
                    </div>
                </div>
            </div>
        </section>
        
        <section class="lesson-content">
            <h2>åˆ†æ•£åŒ–æŠ•èµ„åŸç†</h2>
            <p>åˆ†æ•£åŒ–æŠ•èµ„å¯ä»¥é™ä½éç³»ç»Ÿæ€§é£é™©ï¼Œä½†ä¸èƒ½æ¶ˆé™¤ç³»ç»Ÿæ€§é£é™©ã€‚</p>
            <h3>1. æŠ•èµ„ç»„åˆé£é™©åˆ†è§£</h3>
            <pre><code class="language-python">def risk_decomposition(weights, cov_matrix):
    """åˆ†è§£æŠ•èµ„ç»„åˆé£é™©"""
    port_variance = np.dot(weights.T, np.dot(cov_matrix, weights))
    marginal_risk = np.dot(cov_matrix, weights) / port_variance
    risk_contribution = weights * marginal_risk
    return risk_contribution
# è®¡ç®—é£é™©è´¡çŒ®
risk_contrib = risk_decomposition(weights, cov_matrix)
print("\nå„èµ„äº§é£é™©è´¡çŒ®:\n", risk_contrib)</code></pre>
            <h3>2. åˆ†æ•£åŒ–æ•ˆæœæ¨¡æ‹Ÿ</h3>
            <pre><code class="language-python"># æ¨¡æ‹Ÿä¸åŒèµ„äº§æ•°é‡ä¸‹çš„æŠ•èµ„ç»„åˆé£é™©
num_assets_range = range(1, 50)
portfolio_risks = []
for num_assets in num_assets_range:
    # ç”Ÿæˆéšæœºåæ–¹å·®çŸ©é˜µ
    cov_matrix = np.random.normal(0.1, 0.05, (num_assets, num_assets))
    cov_matrix = np.dot(cov_matrix, cov_matrix.T)  # ç¡®ä¿æ­£å®š
    weights = np.ones(num_assets) / num_assets
    port_risk = np.sqrt(np.dot(weights.T, np.dot(cov_matrix, weights)))
    portfolio_risks.append(port_risk)
plt.figure(figsize=(10,6))
plt.plot(num_assets_range, portfolio_risks)
plt.xlabel('èµ„äº§æ•°é‡')
plt.ylabel('æŠ•èµ„ç»„åˆé£é™©')
plt.title('åˆ†æ•£åŒ–æŠ•èµ„å¯¹é£é™©çš„å½±å“')
plt.grid(True)
plt.show()</code></pre>
        </section>
        <div class="lesson-navigation">
            <a href="../../index.html" class="btn">Â« è¿”å›æ¨¡å—æ¦‚è§ˆ</a>
            <a href="lesson2.html" class="btn">ä¸‹ä¸€è¯¾: èµ„äº§æ”¶ç›Šç‡ä¸é£é™© Â»</a>
        </div>
    </main>
    <footer>
        <div class="container">
            <p>Â© 2023 Pythoné‡‘èç¼–ç¨‹è¯¾ç¨‹. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
        </div>
    </footer>
    
    <script>
    // åˆ›å»ºtooltip
    const tooltip = d3.select("body").append("div")
        .attr("class", "tooltip");
    
    // å…¨å±€å˜é‡
    let assets = [
        {name: 'è‚¡ç¥¨A', return: 12, risk: 20, color: '#1f77b4'},
        {name: 'è‚¡ç¥¨B', return: 10, risk: 15, color: '#ff7f0e'},
        {name: 'å€ºåˆ¸A', return: 6, risk: 8, color: '#2ca02c'},
        {name: 'å€ºåˆ¸B', return: 4, risk: 5, color: '#d62728'}
    ];
    
    let correlationMatrix = [
        [1.0, 0.3, 0.1, 0.0],
        [0.3, 1.0, 0.2, 0.1],
        [0.1, 0.2, 1.0, 0.4],
        [0.0, 0.1, 0.4, 1.0]
    ];
    
    // åˆå§‹åŒ–èµ„äº§è¾“å…¥æ¡†
    function updateAssetInputs() {
        const count = parseInt(document.getElementById('assetCount').value);
        document.getElementById('assetCountNum').value = count;
        
        // è°ƒæ•´assetsæ•°ç»„å¤§å°
        while (assets.length < count) {
            const index = assets.length;
            assets.push({
                name: `èµ„äº§${String.fromCharCode(65 + index)}`,
                return: 5 + Math.random() * 15,
                risk: 5 + Math.random() * 25,
                color: d3.schemeCategory10[index % 10]
            });
        }
        assets = assets.slice(0, count);
        
        // è°ƒæ•´ç›¸å…³æ€§çŸ©é˜µ
        updateCorrelationMatrixSize(count);
        
        const container = document.getElementById('assetInputsContainer');
        container.innerHTML = '';
        
        assets.forEach((asset, i) => {
            const div = document.createElement('div');
            div.className = 'asset-input';
            div.innerHTML = `
                <label>${asset.name}</label>
                <input type="number" placeholder="æ”¶ç›Šç‡(%)" value="${asset.return.toFixed(1)}" 
                       onchange="updateAsset(${i}, 'return', this.value)">
                <input type="number" placeholder="é£é™©(%)" value="${asset.risk.toFixed(1)}" 
                       onchange="updateAsset(${i}, 'risk', this.value)">
            `;
            container.appendChild(div);
        });
    }
    
    function updateAsset(index, property, value) {
        assets[index][property] = parseFloat(value) || 0;
        calculatePortfolio();
    }
    
    function updateCorrelationMatrixSize(size) {
        // åˆ›å»ºæ–°çš„ç›¸å…³æ€§çŸ©é˜µ
        const newMatrix = [];
        for (let i = 0; i < size; i++) {
            newMatrix[i] = [];
            for (let j = 0; j < size; j++) {
                if (i === j) {
                    newMatrix[i][j] = 1.0;
                } else if (i < correlationMatrix.length && j < correlationMatrix[0].length) {
                    newMatrix[i][j] = correlationMatrix[i][j];
                } else {
                    newMatrix[i][j] = Math.random() * 0.6 - 0.3; // -0.3 åˆ° 0.3
                }
            }
        }
        correlationMatrix = newMatrix;
    }
    
    // ç”Ÿæˆéšæœºèµ„äº§
    function generateRandomAssets() {
        assets.forEach(asset => {
            asset.return = 2 + Math.random() * 18; // 2-20%
            asset.risk = 5 + Math.random() * 30;   // 5-35%
        });
        updateAssetInputs();
        calculatePortfolio();
    }
    
    // é‡ç½®ä¸ºé»˜è®¤å€¼
    function resetToDefault() {
        assets = [
            {name: 'è‚¡ç¥¨A', return: 12, risk: 20, color: '#1f77b4'},
            {name: 'è‚¡ç¥¨B', return: 10, risk: 15, color: '#ff7f0e'},
            {name: 'å€ºåˆ¸A', return: 6, risk: 8, color: '#2ca02c'},
            {name: 'å€ºåˆ¸B', return: 4, risk: 5, color: '#d62728'}
        ];
        document.getElementById('assetCount').value = 4;
        updateAssetInputs();
        calculatePortfolio();
    }
    
    // è®¡ç®—æŠ•èµ„ç»„åˆ
    function calculatePortfolio() {
        const portfolioCount = parseInt(document.getElementById('portfolioCount').value);
        document.getElementById('portfolioCountNum').value = portfolioCount;
        
        const riskFreeRate = parseFloat(document.getElementById('riskFreeRate').value);
        document.getElementById('riskFreeRateNum').value = riskFreeRate;
        
        // ç”ŸæˆéšæœºæŠ•èµ„ç»„åˆ
        const portfolios = [];
        for (let i = 0; i < portfolioCount; i++) {
            const weights = generateRandomWeights(assets.length);
            const portfolio = calculatePortfolioMetrics(weights, assets, correlationMatrix);
            portfolios.push(portfolio);
        }
        
        // è®¡ç®—æœ‰æ•ˆå‰æ²¿
        const efficientPortfolios = calculateEfficientFrontier(assets, correlationMatrix, 50);
        
        // æ‰¾åˆ°æœ€ä¼˜ç»„åˆï¼ˆæœ€å¤§å¤æ™®æ¯”ç‡ï¼‰
        const optimalPortfolio = portfolios.reduce((best, current) => {
            const currentSharpe = (current.return - riskFreeRate) / current.risk;
            const bestSharpe = (best.return - riskFreeRate) / best.risk;
            return currentSharpe > bestSharpe ? current : best;
        });
        
        // æ‰¾åˆ°æœ€å°æ–¹å·®ç»„åˆ
        const minVariancePortfolio = efficientPortfolios.reduce((min, current) => 
            current.risk < min.risk ? current : min
        );
        
        // æ›´æ–°å›¾è¡¨
        drawEfficientFrontier(portfolios, efficientPortfolios, optimalPortfolio, minVariancePortfolio, riskFreeRate);
        
        // æ›´æ–°æŒ‡æ ‡
        document.getElementById('optimalReturn').textContent = optimalPortfolio.return.toFixed(2);
        document.getElementById('optimalRisk').textContent = optimalPortfolio.risk.toFixed(2);
        document.getElementById('sharpeRatio').textContent = ((optimalPortfolio.return - riskFreeRate) / optimalPortfolio.risk).toFixed(3);
        document.getElementById('minVarianceReturn').textContent = minVariancePortfolio.return.toFixed(2);
    }
    
    function generateRandomWeights(n) {
        const weights = [];
        let sum = 0;
        
        // ç”Ÿæˆéšæœºæ•°
        for (let i = 0; i < n; i++) {
            const weight = Math.random();
            weights.push(weight);
            sum += weight;
        }
        
        // æ ‡å‡†åŒ–ä½¿æƒé‡å’Œä¸º1
        return weights.map(w => w / sum);
    }
    
    function calculatePortfolioMetrics(weights, assets, correlationMatrix) {
        // è®¡ç®—æŠ•èµ„ç»„åˆæ”¶ç›Šç‡
        let portfolioReturn = 0;
        for (let i = 0; i < weights.length; i++) {
            portfolioReturn += weights[i] * assets[i].return;
        }
        
        // è®¡ç®—æŠ•èµ„ç»„åˆæ–¹å·®
        let portfolioVariance = 0;
        for (let i = 0; i < weights.length; i++) {
            for (let j = 0; j < weights.length; j++) {
                const covariance = correlationMatrix[i][j] * assets[i].risk * assets[j].risk / 10000;
                portfolioVariance += weights[i] * weights[j] * covariance;
            }
        }
        
        const portfolioRisk = Math.sqrt(portfolioVariance) * 100;
        
        return {
            return: portfolioReturn,
            risk: portfolioRisk,
            weights: weights
        };
    }
    
    function calculateEfficientFrontier(assets, correlationMatrix, points) {
        const efficientPortfolios = [];
        const minReturn = Math.min(...assets.map(a => a.return));
        const maxReturn = Math.max(...assets.map(a => a.return));
        
        for (let i = 0; i <= points; i++) {
            const targetReturn = minReturn + (maxReturn - minReturn) * i / points;
            const portfolio = optimizePortfolio(assets, correlationMatrix, targetReturn);
            if (portfolio) {
                efficientPortfolios.push(portfolio);
            }
        }
        
        return efficientPortfolios;
    }
    
    function optimizePortfolio(assets, correlationMatrix, targetReturn) {
        // ç®€åŒ–çš„ä¼˜åŒ–ç®—æ³• - åœ¨å®é™…åº”ç”¨ä¸­åº”ä½¿ç”¨æ›´å¤æ‚çš„ä¼˜åŒ–æ–¹æ³•
        let bestPortfolio = null;
        let minRisk = Infinity;
        
        // å°è¯•å¤šç§æƒé‡ç»„åˆ
        for (let trial = 0; trial < 1000; trial++) {
            const weights = generateRandomWeights(assets.length);
            const portfolio = calculatePortfolioMetrics(weights, assets, correlationMatrix);
            
            // æ£€æŸ¥æ˜¯å¦æ¥è¿‘ç›®æ ‡æ”¶ç›Šç‡
            if (Math.abs(portfolio.return - targetReturn) < 0.5 && portfolio.risk < minRisk) {
                minRisk = portfolio.risk;
                bestPortfolio = portfolio;
            }
        }
        
        return bestPortfolio;
    }
    
    function drawEfficientFrontier(portfolios, efficientPortfolios, optimalPortfolio, minVariancePortfolio, riskFreeRate) {
        const container = d3.select("#efficientFrontier");
        container.selectAll("*").remove();
        
        const margin = {top: 20, right: 30, bottom: 50, left: 60};
        const width = 700 - margin.left - margin.right;
        const height = 400 - margin.top - margin.bottom;
        
        const svg = container.append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom);
        
        const g = svg.append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);
        
        // è®¾ç½®æ¯”ä¾‹å°º
        const allPortfolios = [...portfolios, ...efficientPortfolios];
        const xScale = d3.scaleLinear()
            .domain([0, d3.max(allPortfolios, d => d.risk) * 1.1])
            .range([0, width]);
        
        const yScale = d3.scaleLinear()
            .domain([0, d3.max(allPortfolios, d => d.return) * 1.1])
            .range([height, 0]);
        
        // ç»˜åˆ¶éšæœºæŠ•èµ„ç»„åˆ
        g.selectAll(".portfolio-dot")
            .data(portfolios)
            .enter().append("circle")
            .attr("class", "portfolio-dot")
            .attr("cx", d => xScale(d.risk))
            .attr("cy", d => yScale(d.return))
            .attr("r", 2)
            .attr("fill", "rgba(100, 100, 100, 0.3)")
            .on("mouseover", function(event, d) {
                tooltip.transition().duration(200).style("opacity", .9);
                tooltip.html(`æ”¶ç›Šç‡: ${d.return.toFixed(2)}%<br/>é£é™©: ${d.risk.toFixed(2)}%<br/>å¤æ™®æ¯”ç‡: ${((d.return - riskFreeRate) / d.risk).toFixed(3)}`)
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 28) + "px");
            })
            .on("mouseout", function() {
                tooltip.transition().duration(500).style("opacity", 0);
            });
        
        // ç»˜åˆ¶æœ‰æ•ˆå‰æ²¿
        if (efficientPortfolios.length > 1) {
            const line = d3.line()
                .x(d => xScale(d.risk))
                .y(d => yScale(d.return))
                .curve(d3.curveMonotoneX);
            
            g.append("path")
                .datum(efficientPortfolios.sort((a, b) => a.risk - b.risk))
                .attr("fill", "none")
                .attr("stroke", "#ff6b6b")
                .attr("stroke-width", 3)
                .attr("d", line);
        }
        
        // ç»˜åˆ¶ä¸ªåˆ«èµ„äº§
        g.selectAll(".asset-dot")
            .data(assets)
            .enter().append("circle")
            .attr("class", "asset-dot")
            .attr("cx", d => xScale(d.risk))
            .attr("cy", d => yScale(d.return))
            .attr("r", 6)
            .attr("fill", d => d.color)
            .attr("stroke", "white")
            .attr("stroke-width", 2)
            .on("mouseover", function(event, d) {
                tooltip.transition().duration(200).style("opacity", .9);
                tooltip.html(`${d.name}<br/>æ”¶ç›Šç‡: ${d.return.toFixed(2)}%<br/>é£é™©: ${d.risk.toFixed(2)}%`)
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 28) + "px");
            })
            .on("mouseout", function() {
                tooltip.transition().duration(500).style("opacity", 0);
            });
        
        // æ ‡è®°æœ€ä¼˜ç»„åˆ
        g.append("circle")
            .attr("cx", xScale(optimalPortfolio.risk))
            .attr("cy", yScale(optimalPortfolio.return))
            .attr("r", 8)
            .attr("fill", "gold")
            .attr("stroke", "orange")
            .attr("stroke-width", 3);
        
        // æ ‡è®°æœ€å°æ–¹å·®ç»„åˆ
        g.append("circle")
            .attr("cx", xScale(minVariancePortfolio.risk))
            .attr("cy", yScale(minVariancePortfolio.return))
            .attr("r", 8)
            .attr("fill", "lightgreen")
            .attr("stroke", "green")
            .attr("stroke-width", 3);
        
        // ç»˜åˆ¶èµ„æœ¬é…ç½®çº¿ï¼ˆä»æ— é£é™©èµ„äº§åˆ°æœ€ä¼˜ç»„åˆï¼‰
        g.append("line")
            .attr("x1", xScale(0))
            .attr("y1", yScale(riskFreeRate))
            .attr("x2", xScale(optimalPortfolio.risk * 1.5))
            .attr("y2", yScale(riskFreeRate + (optimalPortfolio.return - riskFreeRate) * 1.5))
            .attr("stroke", "blue")
            .attr("stroke-width", 2)
            .attr("stroke-dasharray", "5,5");
        
        // æ·»åŠ åæ ‡è½´
        g.append("g")
            .attr("transform", `translate(0,${height})`)
            .call(d3.axisBottom(xScale))
            .append("text")
            .attr("x", width / 2)
            .attr("y", 40)
            .style("text-anchor", "middle")
            .style("fill", "#333")
            .text("é£é™© (æ ‡å‡†å·® %)");
        
        g.append("g")
            .call(d3.axisLeft(yScale))
            .append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", -40)
            .attr("x", -height / 2)
            .style("text-anchor", "middle")
            .style("fill", "#333")
            .text("é¢„æœŸæ”¶ç›Šç‡ (%)");
        
        // æ·»åŠ å›¾ä¾‹
        const legend = g.append("g")
            .attr("transform", `translate(${width - 150}, 20)`);
        
        const legendData = [
            {label: "éšæœºç»„åˆ", color: "rgba(100, 100, 100, 0.3)", type: "circle"},
            {label: "æœ‰æ•ˆå‰æ²¿", color: "#ff6b6b", type: "line"},
            {label: "æœ€ä¼˜ç»„åˆ", color: "gold", type: "circle"},
            {label: "æœ€å°æ–¹å·®", color: "lightgreen", type: "circle"},
            {label: "èµ„æœ¬é…ç½®çº¿", color: "blue", type: "line"}
        ];
        
        legendData.forEach((item, i) => {
            const legendRow = legend.append("g")
                .attr("transform", `translate(0, ${i * 20})`);
            
            if (item.type === "circle") {
                legendRow.append("circle")
                    .attr("cx", 8)
                    .attr("cy", 8)
                    .attr("r", 4)
                    .attr("fill", item.color);
            } else {
                legendRow.append("line")
                    .attr("x1", 2)
                    .attr("x2", 14)
                    .attr("y1", 8)
                    .attr("y2", 8)
                    .attr("stroke", item.color)
                    .attr("stroke-width", 2);
            }
            
            legendRow.append("text")
                .attr("x", 20)
                .attr("y", 12)
                .text(item.label)
                .style("font-size", "12px")
                .style("fill", "#333");
        });
    }
    
    // ç›¸å…³æ€§çŸ©é˜µçƒ­åŠ›å›¾
    function updateCorrelationMatrix() {
        const strength = parseFloat(document.getElementById('correlationStrength').value);
        document.getElementById('correlationStrengthNum').value = strength;
        
        // è°ƒæ•´ç›¸å…³æ€§çŸ©é˜µå¼ºåº¦
        for (let i = 0; i < correlationMatrix.length; i++) {
            for (let j = 0; j < correlationMatrix[0].length; j++) {
                if (i !== j) {
                    correlationMatrix[i][j] = correlationMatrix[i][j] * strength / 0.3;
                    correlationMatrix[i][j] = Math.max(-0.9, Math.min(0.9, correlationMatrix[i][j]));
                }
            }
        }
        
        drawCorrelationHeatmap();
        calculatePortfolio();
    }
    
    function generateCorrelationMatrix() {
        const size = assets.length;
        for (let i = 0; i < size; i++) {
            for (let j = 0; j < size; j++) {
                if (i === j) {
                    correlationMatrix[i][j] = 1.0;
                } else {
                    correlationMatrix[i][j] = (Math.random() - 0.5) * 1.6; // -0.8 åˆ° 0.8
                }
            }
        }
        drawCorrelationHeatmap();
        calculatePortfolio();
    }
    
    function showIdentityMatrix() {
        const size = assets.length;
        for (let i = 0; i < size; i++) {
            for (let j = 0; j < size; j++) {
                correlationMatrix[i][j] = i === j ? 1.0 : 0.0;
            }
        }
        drawCorrelationHeatmap();
        calculatePortfolio();
    }
    
    function drawCorrelationHeatmap() {
        const container = d3.select("#correlationHeatmap");
        container.selectAll("*").remove();
        
        const size = assets.length;
        const cellSize = Math.min(60, 400 / size);
        const width = size * cellSize + 100;
        const height = size * cellSize + 100;
        
        const svg = container.append("svg")
            .attr("width", width)
            .attr("height", height);
        
        const g = svg.append("g")
            .attr("transform", "translate(50, 50)");
        
        const colorScale = d3.scaleSequential(d3.interpolateRdBu)
            .domain([1, -1]);
        
        // ç»˜åˆ¶çƒ­åŠ›å›¾
        for (let i = 0; i < size; i++) {
            for (let j = 0; j < size; j++) {
                g.append("rect")
                    .attr("x", j * cellSize)
                    .attr("y", i * cellSize)
                    .attr("width", cellSize)
                    .attr("height", cellSize)
                    .attr("fill", colorScale(correlationMatrix[i][j]))
                    .attr("stroke", "white")
                    .attr("stroke-width", 1)
                    .on("mouseover", function(event) {
                        tooltip.transition().duration(200).style("opacity", .9);
                        tooltip.html(`${assets[i].name} vs ${assets[j].name}<br/>ç›¸å…³æ€§: ${correlationMatrix[i][j].toFixed(3)}`)
                            .style("left", (event.pageX + 10) + "px")
                            .style("top", (event.pageY - 28) + "px");
                    })
                    .on("mouseout", function() {
                        tooltip.transition().duration(500).style("opacity", 0);
                    });
                
                // æ·»åŠ æ•°å€¼æ ‡ç­¾
                g.append("text")
                    .attr("x", j * cellSize + cellSize / 2)
                    .attr("y", i * cellSize + cellSize / 2)
                    .attr("text-anchor", "middle")
                    .attr("dominant-baseline", "middle")
                    .style("font-size", `${Math.min(12, cellSize / 4)}px`)
                    .style("fill", Math.abs(correlationMatrix[i][j]) > 0.5 ? "white" : "black")
                    .text(correlationMatrix[i][j].toFixed(2));
            }
        }
        
        // æ·»åŠ è¡Œæ ‡ç­¾
        assets.forEach((asset, i) => {
            g.append("text")
                .attr("x", -10)
                .attr("y", i * cellSize + cellSize / 2)
                .attr("text-anchor", "end")
                .attr("dominant-baseline", "middle")
                .style("font-size", "12px")
                .style("fill", "#333")
                .text(asset.name);
        });
        
        // æ·»åŠ åˆ—æ ‡ç­¾
        assets.forEach((asset, j) => {
            g.append("text")
                .attr("x", j * cellSize + cellSize / 2)
                .attr("y", -10)
                .attr("text-anchor", "middle")
                .attr("dominant-baseline", "middle")
                .style("font-size", "12px")
                .style("fill", "#333")
                .text(asset.name);
        });
    }
    
    // é£é™©åˆ†è§£åˆ†æ
    function updateRiskDecomposition() {
        const marketBeta = parseFloat(document.getElementById('marketBeta').value);
        const specificRisk = parseFloat(document.getElementById('specificRisk').value);
        
        document.getElementById('marketBetaNum').value = marketBeta;
        document.getElementById('specificRiskNum').value = specificRisk;
        
        // å‡è®¾å¸‚åœºé£é™©ä¸º15%
        const marketRisk = 15;
        const systematicRisk = marketBeta * marketRisk;
        const totalRisk = Math.sqrt(systematicRisk * systematicRisk + specificRisk * specificRisk);
        const diversificationBenefit = (systematicRisk + specificRisk) - totalRisk;
        
        // æ›´æ–°æŒ‡æ ‡æ˜¾ç¤º
        document.getElementById('systematicRisk').textContent = systematicRisk.toFixed(2);
        document.getElementById('unsystematicRisk').textContent = specificRisk.toFixed(2);
        document.getElementById('totalRisk').textContent = totalRisk.toFixed(2);
        document.getElementById('diversificationBenefit').textContent = diversificationBenefit.toFixed(2);
        
        drawRiskDecomposition(systematicRisk, specificRisk, totalRisk);
    }
    
    function drawRiskDecomposition(systematicRisk, specificRisk, totalRisk) {
        const container = d3.select("#riskDecomposition");
        container.selectAll("*").remove();
        
        const width = 600;
        const height = 300;
        const margin = {top: 20, right: 30, bottom: 50, left: 60};
        
        const svg = container.append("svg")
            .attr("width", width)
            .attr("height", height);
        
        const g = svg.append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);
        
        const data = [
            {label: 'ç³»ç»Ÿæ€§é£é™©', value: systematicRisk, color: '#ff6b6b'},
            {label: 'éç³»ç»Ÿæ€§é£é™©', value: specificRisk, color: '#4ecdc4'},
            {label: 'æ€»é£é™©', value: totalRisk, color: '#45b7d1'}
        ];
        
        const xScale = d3.scaleBand()
            .domain(data.map(d => d.label))
            .range([0, width - margin.left - margin.right])
            .padding(0.2);
        
        const yScale = d3.scaleLinear()
            .domain([0, Math.max(...data.map(d => d.value)) * 1.1])
            .range([height - margin.top - margin.bottom, 0]);
        
        // ç»˜åˆ¶æŸ±çŠ¶å›¾
        g.selectAll(".risk-bar")
            .data(data)
            .enter().append("rect")
            .attr("class", "risk-bar")
            .attr("x", d => xScale(d.label))
            .attr("y", d => yScale(d.value))
            .attr("width", xScale.bandwidth())
            .attr("height", d => yScale(0) - yScale(d.value))
            .attr("fill", d => d.color)
            .on("mouseover", function(event, d) {
                tooltip.transition().duration(200).style("opacity", .9);
                tooltip.html(`${d.label}: ${d.value.toFixed(2)}%`)
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 28) + "px");
            })
            .on("mouseout", function() {
                tooltip.transition().duration(500).style("opacity", 0);
            });
        
        // æ·»åŠ æ•°å€¼æ ‡ç­¾
        g.selectAll(".risk-label")
            .data(data)
            .enter().append("text")
            .attr("class", "risk-label")
            .attr("x", d => xScale(d.label) + xScale.bandwidth() / 2)
            .attr("y", d => yScale(d.value) - 5)
            .attr("text-anchor", "middle")
            .style("font-size", "12px")
            .style("fill", "#333")
            .text(d => d.value.toFixed(1) + "%");
        
        // æ·»åŠ åæ ‡è½´
        g.append("g")
            .attr("transform", `translate(0,${height - margin.top - margin.bottom})`)
            .call(d3.axisBottom(xScale));
        
        g.append("g")
            .call(d3.axisLeft(yScale))
            .append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", -40)
            .attr("x", -(height - margin.top - margin.bottom) / 2)
            .style("text-anchor", "middle")
            .style("fill", "#333")
            .text("é£é™© (%)");
    }
    
    // åŒæ­¥æ»‘å—å’Œè¾“å…¥æ¡†
    function syncInputs() {
        const inputs = [
            ['assetCount', 'assetCountNum'],
            ['portfolioCount', 'portfolioCountNum'],
            ['riskFreeRate', 'riskFreeRateNum'],
            ['correlationStrength', 'correlationStrengthNum'],
            ['marketBeta', 'marketBetaNum'],
            ['specificRisk', 'specificRiskNum']
        ];
        
        inputs.forEach(([sliderId, numberId]) => {
            const slider = document.getElementById(sliderId);
            const number = document.getElementById(numberId);
            
            if (slider && number) {
                slider.addEventListener('input', function() {
                    number.value = this.value;
                });
                
                number.addEventListener('input', function() {
                    slider.value = this.value;
                });
            }
        });
    }
    
    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(() => {
            updateAssetInputs();
            calculatePortfolio();
            drawCorrelationHeatmap();
            updateRiskDecomposition();
            syncInputs();
        }, 100);
    });
    </script>
</body>
</html>