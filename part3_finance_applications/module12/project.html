<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¡¹ç›®å®æˆ˜</title>
    <link rel="stylesheet" href="../../css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
</head>
<body>
<div id="navigation-container"></div>
<script>
// åŠ¨æ€åŠ è½½å¯¼èˆªæ¡
function loadNavigation() {
    fetch('../../nav.html')
        .then(response => response.text())
        .then(html => {
            // æ›´æ–°å¯¼èˆªä¸­çš„é“¾æ¥è·¯å¾„
            let updatedHtml = html;
            
            // å¤„ç†æ ¹ç›®å½•æ–‡ä»¶é“¾æ¥ï¼ˆindex.html, syllabus.htmlç­‰ï¼‰
            updatedHtml = updatedHtml.replace(/href="index\.html"/g, 'href="../../index.html"');
            updatedHtml = updatedHtml.replace(/href="\.\/([^/]*\.html)"/g, 'href="../../$1"');
            
            // å¤„ç†æ¨¡å—è·¯å¾„é“¾æ¥ï¼ˆå·²ç»æ˜¯å®Œæ•´ç›¸å¯¹è·¯å¾„ï¼Œåªéœ€è¦æ·»åŠ æ ¹è·¯å¾„å‰ç¼€ï¼‰
            updatedHtml = updatedHtml.replace(/href="\.\/part([^"]*)"/g, 'href="../../part$1"');
            
            document.getElementById('navigation-container').innerHTML = updatedHtml;
            
            // æ·»åŠ ç§»åŠ¨ç«¯èœå•åˆ‡æ¢åŠŸèƒ½
            const menuToggle = document.getElementById('menuToggle');
            const navMenu = document.querySelector('.nav-menu');
            if (menuToggle && navMenu) {
                menuToggle.addEventListener('click', function() {
                    navMenu.classList.toggle('active');
                });
            }
        })
        .catch(error => console.error('å¯¼èˆªåŠ è½½å¤±è´¥:', error));
}

// é¡µé¢åŠ è½½å®ŒæˆååŠ è½½å¯¼èˆª
document.addEventListener('DOMContentLoaded', loadNavigation);
</script>



    
    
    <main class="container">
        <!-- æ•°æ®é›†ä¸‹è½½åŒºåŸŸ -->
        <section class="lesson-content data-section">
            <h2>ğŸ“Š é…å¥—æ•°æ®é›†</h2>
            <div class="data-download-area">
                <div class="data-info">
                    <p>æœ¬é¡¹ç›®éœ€è¦ä½¿ç”¨ä»¥ä¸‹æ•°æ®æ–‡ä»¶æ„å»ºå®Œæ•´çš„è‡ªåŠ¨åŒ–äº¤æ˜“ç³»ç»Ÿã€‚æ‚¨å¯ä»¥ç›´æ¥ä¸‹è½½ä½¿ç”¨ã€‚</p>
                </div>
                
                <div class="data-files-grid">
                    <div class="data-file-card">
                        <div class="file-header">
                            <span class="file-icon">ğŸ“Š</span>
                            <span class="file-name">data.csv</span>
                        </div>
                        <div class="file-description">
                            ç»¼åˆå¸‚åœºæ•°æ®ï¼ŒåŒ…å«ä»·æ ¼ã€æˆäº¤é‡ã€æŠ€æœ¯æŒ‡æ ‡ç­‰ï¼Œç”¨äºç­–ç•¥å¼€å‘å’Œå›æµ‹
                        </div>
                        <div class="file-stats">
                            <span>ğŸ“ˆ å¸‚åœºæ•°æ®</span>
                            <span>ğŸ“… é•¿æœŸå†å²</span>
                            <span>ğŸ’¾ ~200KB</span>
                        </div>
                        <button class="download-btn" onclick="downloadDataFile('data.csv')">
                            <span>â¬‡ï¸</span> ä¸‹è½½æ•°æ®æ–‡ä»¶
                        </button>
                    </div>
                    
                    <div class="data-file-card">
                        <div class="file-header">
                            <span class="file-icon">ğŸ“°</span>
                            <span class="file-name">news_data.csv</span>
                        </div>
                        <div class="file-description">
                            æ–°é—»æƒ…æ„Ÿæ•°æ®ï¼ŒåŒ…å«æ–°é—»æ ‡é¢˜ã€æƒ…æ„Ÿåˆ†æç»“æœç­‰ï¼Œç”¨äºæƒ…æ„Ÿé©±åŠ¨çš„äº¤æ˜“ç­–ç•¥
                        </div>
                        <div class="file-stats">
                            <span>ğŸ“° æ–°é—»æ•°æ®</span>
                            <span>ğŸ­ æƒ…æ„Ÿåˆ†æ</span>
                            <span>ğŸ’¾ ~150KB</span>
                        </div>
                        <button class="download-btn" onclick="downloadDataFile('news_data.csv')">
                            <span>â¬‡ï¸</span> ä¸‹è½½æ•°æ®æ–‡ä»¶
                        </button>
                    </div>
                </div>
                
                <div class="data-usage-tips">
                    <h4>ğŸ’¡ ä½¿ç”¨è¯´æ˜</h4>
                    <ul>
                        <li>ä¸‹è½½æ‰€æœ‰æ•°æ®æ–‡ä»¶åˆ°æ‚¨çš„å·¥ä½œç›®å½•</li>
                        <li><code>data.csv</code> ç”¨äºæŠ€æœ¯åˆ†æç­–ç•¥å’Œå›æµ‹æ¡†æ¶</li>
                        <li><code>news_data.csv</code> ç”¨äºæƒ…æ„Ÿåˆ†æå’Œæ–°é—»é©±åŠ¨ç­–ç•¥</li>
                        <li>æ•°æ®é€‚åˆæ„å»ºå®Œæ•´çš„è‡ªåŠ¨åŒ–äº¤æ˜“ç³»ç»Ÿé¡¹ç›®</li>
                    </ul>
                </div>
            </div>
        </section>

        <section class="project-intro">
            <h2>é¡¹ç›®æ¦‚è¿°</h2>
            <p>æœ¬é¡¹ç›®å°†æ„å»ºä¸€ä¸ªå®Œæ•´çš„è‡ªåŠ¨åŒ–äº¤æ˜“ç³»ç»Ÿï¼Œæ•´åˆæœ¬æ¨¡å—å­¦åˆ°çš„æ‰€æœ‰çŸ¥è¯†ï¼Œä»æ•°æ®è·å–åˆ°ç­–ç•¥æ‰§è¡Œçš„å…¨æµç¨‹å®ç°ã€‚</p>
            <div class="project-requirements">
                <h3>é¡¹ç›®è¦æ±‚</h3>
                <ul>
                    <li>å®ç°è‡³å°‘ä¸¤ç§ä¸åŒçš„äº¤æ˜“ç­–ç•¥</li>
                    <li>æ„å»ºå®Œæ•´çš„å›æµ‹æ¡†æ¶</li>
                    <li>é›†æˆé£é™©ç®¡ç†ç³»ç»Ÿ</li>
                    <li>æ”¯æŒæ¨¡æ‹Ÿäº¤æ˜“å’Œå®ç›˜äº¤æ˜“</li>
                    <li>æä¾›å¯è§†åŒ–ç›‘æ§ç•Œé¢</li>
                </ul>
            </div>
        </section>
        <section class="project-architecture">
            <h2>ç³»ç»Ÿæ¶æ„è®¾è®¡</h2>
            <h3>1. æ•´ä½“æ¶æ„</h3>
            <pre><code class="language-python">system_architecture = {
    'æ•°æ®å±‚': ['å®æ—¶æ•°æ®æµ', 'å†å²æ•°æ®å­˜å‚¨', 'æ•°æ®é¢„å¤„ç†'],
    'ç­–ç•¥å±‚': ['ä¿¡å·ç”Ÿæˆ', 'ç»„åˆç®¡ç†', 'å‚æ•°ä¼˜åŒ–'],
    'æ‰§è¡Œå±‚': ['è®¢å•ç®¡ç†', 'äº¤æ˜“æ‰§è¡Œ', 'æ»‘ç‚¹æ¨¡å‹'],
    'é£æ§å±‚': ['å¤´å¯¸é™åˆ¶', 'æ­¢æŸç­–ç•¥', 'æ³¢åŠ¨ç‡æ§åˆ¶'],
    'ç›‘æ§å±‚': ['å®æ—¶ç›‘æ§', 'æŠ¥è­¦ç³»ç»Ÿ', 'æ—¥å¿—è®°å½•']
}</code></pre>
            <h3>2. ç±»å›¾è®¾è®¡</h3>
            <pre><code class="language-python">class TradingSystem:
    """äº¤æ˜“ç³»ç»Ÿä¸»ç±»"""
    def __init__(self, data_source, broker):
        self.data_source = data_source
        self.broker = broker
        self.strategies = []
        self.portfolio = Portfolio()
        self.risk_manager = RiskManager()
        self.order_manager = OrderManager()
    def add_strategy(self, strategy):
        """æ·»åŠ äº¤æ˜“ç­–ç•¥"""
        self.strategies.append(strategy)
    def run(self):
        """è¿è¡Œäº¤æ˜“ç³»ç»Ÿ"""
        self._initialize()
        self._start_event_loop()
    def _initialize(self):
        """åˆå§‹åŒ–ç³»ç»Ÿ"""
        self.data_source.connect()
        self.broker.connect()
    def _start_event_loop(self):
        """å¯åŠ¨äº‹ä»¶å¾ªç¯"""
        while True:
            data = self.data_source.get_next()
            self._process_data(data)
    def _process_data(self, data):
        """å¤„ç†å¸‚åœºæ•°æ®"""
        for strategy in self.strategies:
            signals = strategy.generate_signals(data)
            self._execute_signals(signals, data)
    def _execute_signals(self, signals, data):
        """æ‰§è¡Œäº¤æ˜“ä¿¡å·"""
        orders = self.order_manager.create_orders(signals, data)
        approved_orders = self.risk_manager.check_orders(orders, self.portfolio)
        self.broker.execute_orders(approved_orders)</code></pre>
        </section>
        <section class="project-implementation">
            <h2>æ ¸å¿ƒæ¨¡å—å®ç°</h2>
            <h3>1. åŒå‡çº¿ç­–ç•¥å®ç°</h3>
            <pre><code class="language-python">class DualMovingAverageStrategy:
    """åŒå‡çº¿äº¤å‰ç­–ç•¥"""
    def __init__(self, symbol, short_window=10, long_window=50):
        self.symbol = symbol
        self.short_window = short_window
        self.long_window = long_window
        self.short_ma = None
        self.long_ma = None
    def generate_signals(self, data):
        """ç”Ÿæˆäº¤æ˜“ä¿¡å·"""
        if self.symbol not in data:
            return {}
        # è®¡ç®—ç§»åŠ¨å¹³å‡çº¿
        prices = data[self.symbol]['close']
        self.short_ma = prices.rolling(self.short_window).mean()
        self.long_ma = prices.rolling(self.long_window).mean()
        # ç”Ÿæˆä¿¡å·
        signals = {}
        if self.short_ma[-1] > self.long_ma[-1] and self.short_ma[-2] <= self.long_ma[-2]:
            signals[self.symbol] = 'BUY'
        elif self.short_ma[-1] < self.long_ma[-1] and self.short_ma[-2] >= self.long_ma[-2]:
            signals[self.symbol] = 'SELL'
        else:
            signals[self.symbol] = 'HOLD'
        return signals</code></pre>
            <h3>2. é£é™©ç®¡ç†ç³»ç»Ÿå®ç°</h3>
            <pre><code class="language-python">class RiskManager:
    """é£é™©ç®¡ç†ç³»ç»Ÿ"""
    def __init__(self, max_position_pct=0.2, max_loss_pct=0.05):
        self.max_position_pct = max_position_pct
        self.max_loss_pct = max_loss_pct
        self.daily_pnl = 0
    def check_orders(self, orders, portfolio):
        """æ£€æŸ¥è®¢å•æ˜¯å¦ç¬¦åˆé£æ§è§„åˆ™"""
        approved_orders = []
        for order in orders:
            # æ£€æŸ¥å•æ ‡çš„é£é™©æ•å£
            position_value = portfolio.positions.get(order.symbol, 0)
            order_value = order.quantity * portfolio.get_last_price(order.symbol)
            if (position_value + order_value) / portfolio.total_value > self.max_position_pct:
                continue
            # æ£€æŸ¥å½“æ—¥äºæŸ
            if self.daily_pnl < -self.max_loss_pct * portfolio.total_value:
                continue
            approved_orders.append(order)
        return approved_orders
    def update_pnl(self, pnl):
        """æ›´æ–°ç›ˆäº"""
        self.daily_pnl += pnl</code></pre>
        </section>
        <section class="project-complete">
            <h2>å®Œæ•´ç³»ç»Ÿå®ç°</h2>
            <h3>1. ä¸»ç¨‹åºä»£ç </h3>
            <pre><code class="language-python">import pandas as pd
import numpy as np
from datetime import datetime, timedelta
import time
class DataSimulator:
    """æ¨¡æ‹Ÿæ•°æ®æº"""
    def __init__(self, symbols):
        self.symbols = symbols
        self.data = {symbol: self._generate_random_walk() for symbol in symbols}
    def _generate_random_walk(self, start_price=100, steps=1000):
        """ç”Ÿæˆéšæœºæ¸¸èµ°ä»·æ ¼åºåˆ—"""
        returns = np.random.normal(0, 0.01, steps)
        prices = start_price * (1 + returns).cumprod()
        dates = pd.date_range(end=datetime.now(), periods=steps, freq='1min')
        return pd.Series(prices, index=dates)
    def get_next(self):
        """è·å–ä¸‹ä¸€åˆ†é’Ÿæ•°æ®"""
        time.sleep(0.1)  # æ¨¡æ‹Ÿå®æ—¶å»¶è¿Ÿ
        now = datetime.now()
        data = {}
        for symbol in self.symbols:
            data[symbol] = {
                'open': self.data[symbol].loc[:now].iloc[-1],
                'high': self.data[symbol].loc[:now].iloc[-1] * 1.01,
                'low': self.data[symbol].loc[:now].iloc[-1] * 0.99,
                'close': self.data[symbol].loc[:now].iloc[-1],
                'volume': np.random.randint(100, 1000)
            }
        return data
class PaperBroker:
    """æ¨¡æ‹Ÿç»çºªå•†"""
    def __init__(self):
        self.positions = {}
        self.cash = 100000
        self.orders = []
    def execute_order(self, order):
        """æ‰§è¡Œè®¢å•"""
        fill_price = order.price if order.order_type == 'LIMIT' else \
            self.get_market_price(order.symbol)
        if order.side == 'BUY':
            cost = order.quantity * fill_price
            if cost <= self.cash:
                self.cash -= cost
                self.positions[order.symbol] = self.positions.get(order.symbol, 0) + order.quantity
                return True
        else:  # SELL
            if order.symbol in self.positions and self.positions[order.symbol] >= order.quantity:
                proceeds = order.quantity * fill_price
                self.cash += proceeds
                self.positions[order.symbol] -= order.quantity
                if self.positions[order.symbol] == 0:
                    del self.positions[order.symbol]
                return True
        return False
    def get_market_price(self, symbol):
        """è·å–å½“å‰å¸‚åœºä»·æ ¼"""
        return np.random.uniform(95, 105)  # ç®€å•æ¨¡æ‹Ÿ
# åˆå§‹åŒ–ç³»ç»Ÿ
symbols = ['AAPL', 'MSFT']
data_source = DataSimulator(symbols)
broker = PaperBroker()
trading_system = TradingSystem(data_source, broker)
# æ·»åŠ ç­–ç•¥
trading_system.add_strategy(DualMovingAverageStrategy('AAPL'))
trading_system.add_strategy(DualMovingAverageStrategy('MSFT', 5, 20))
# è¿è¡Œç³»ç»Ÿ
print("å¯åŠ¨è‡ªåŠ¨åŒ–äº¤æ˜“ç³»ç»Ÿ...")
trading_system.run()</code></pre>
            <h3>2. ç›‘æ§ç•Œé¢å®ç°</h3>
            <pre><code class="language-python">import matplotlib.pyplot as plt
from IPython.display import clear_output
class Dashboard:
    """äº¤æ˜“ç›‘æ§ä»ªè¡¨æ¿"""
    def __init__(self, trading_system):
        self.system = trading_system
        self.fig, self.axes = plt.subplots(2, 2, figsize=(15, 10))
    def update(self):
        """æ›´æ–°ç›‘æ§ç•Œé¢"""
        clear_output(wait=True)
        # ä»·æ ¼å’Œä¿¡å·å›¾
        self.axes[0, 0].clear()
        for symbol in self.system.data_source.symbols:
            prices = [d[symbol]['close'] for d in self.system.data_history]
            self.axes[0, 0].plot(prices, label=symbol)
        self.axes[0, 0].set_title('ä»·æ ¼èµ°åŠ¿')
        self.axes[0, 0].legend()
        # æŒä»“å›¾
        self.axes[0, 1].clear()
        positions = self.system.portfolio.positions
        self.axes[0, 1].bar(positions.keys(), positions.values())
        self.axes[0, 1].set_title('å½“å‰æŒä»“')
        # èµ„é‡‘æ›²çº¿
        self.axes[1, 0].clear()
        equity = [p.total_value for p in self.system.portfolio_history]
        self.axes[1, 0].plot(equity)
        self.axes[1, 0].set_title('èµ„é‡‘æ›²çº¿')
        # é£é™©æŒ‡æ ‡
        self.axes[1, 1].clear()
        metrics = [
            f"å¤æ™®æ¯”ç‡: {self.system.performance.sharpe:.2f}",
            f"æœ€å¤§å›æ’¤: {self.system.performance.max_drawdown:.2%}",
            f"å¹´åŒ–æ”¶ç›Š: {self.system.performance.annual_return:.2%}"
        ]
        self.axes[1, 1].text(0.1, 0.5, '\n'.join(metrics), fontsize=12)
        self.axes[1, 1].axis('off')
        plt.tight_layout()
        plt.show()</code></pre>
        </section>
        <section class="project-deployment">
            <h2>æµ‹è¯•ä¸éƒ¨ç½²</h2>
            <h3>1. æµ‹è¯•ç­–ç•¥</h3>
            <pre><code class="language-python">def test_strategy(strategy, test_data):
    """æµ‹è¯•äº¤æ˜“ç­–ç•¥"""
    signals = []
    for data in test_data:
        signals.append(strategy.generate_signals(data))
    # è®¡ç®—ç­–ç•¥è¡¨ç°
    returns = []
    position = 0
    for i in range(1, len(test_data)):
        if signals[i-1] == 'BUY':
            position = 1
        elif signals[i-1] == 'SELL':
            position = -1
        ret = position * (test_data[i]['close'] / test_data[i-1]['close'] - 1)
        returns.append(ret)
    # è®¡ç®—ç»©æ•ˆæŒ‡æ ‡
    sharpe = np.mean(returns) / np.std(returns) * np.sqrt(252)
    return {
        'æ€»æ”¶ç›Šç‡': np.sum(returns),
        'å¤æ™®æ¯”ç‡': sharpe,
        'äº¤æ˜“æ¬¡æ•°': len([s for s in signals if s != 'HOLD'])
    }
# ç¤ºä¾‹æµ‹è¯•
test_data = [...]  # åŠ è½½æµ‹è¯•æ•°æ®
strategy = DualMovingAverageStrategy('AAPL')
results = test_strategy(strategy, test_data)
print("ç­–ç•¥æµ‹è¯•ç»“æœ:", results)</code></pre>
            <h3>2. éƒ¨ç½²æŒ‡å—</h3>
            <pre><code class="language-markdown">## è‡ªåŠ¨åŒ–äº¤æ˜“ç³»ç»Ÿéƒ¨ç½²æŒ‡å—
1. **ç¯å¢ƒå‡†å¤‡**
   - Python 3.8+
   - ä¾èµ–åº“: `pip install pandas numpy matplotlib requests`
2. **é…ç½®æ–‡ä»¶**
   ```ini
   [broker]
   api_key = your_api_key
   secret_key = your_secret_key
   paper_trading = true
   [data]
   symbols = AAPL,MSFT,GOOG
   ```
3. **å¯åŠ¨ç³»ç»Ÿ**
   ```bash
   python trading_system.py --config config.ini
   ```
4. **ç›‘æ§ç³»ç»Ÿ**
   - è®¿é—® `http://localhost:8080/dashboard` æŸ¥çœ‹å®æ—¶ç›‘æ§
   - æ—¥å¿—æ–‡ä»¶: `logs/trading.log`
5. **æ³¨æ„äº‹é¡¹**
   - å…ˆåœ¨æ¨¡æ‹Ÿè´¦æˆ·æµ‹è¯•
   - è®¾ç½®åˆç†çš„é£é™©æ§åˆ¶å‚æ•°
   - å®šæœŸæ£€æŸ¥ç³»ç»Ÿå¥åº·çŠ¶å†µ</code></pre>
        </section>
        <div class="project-navigation">
            <a href="lesson4.html" class="btn">Â« ä¸Šä¸€è¯¾: å®ç›˜äº¤æ˜“ç³»ç»Ÿé›†æˆ</a>
            <a href="exercises.html" class="btn">ç»ƒä¹ é¢˜ Â»</a>
        </div>
    </main>
    <footer>
        <div class="container">
            <p>Â© 2023 Pythoné‡‘èç¼–ç¨‹è¯¾ç¨‹. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
        </div>
    </footer>
</body>
</html>