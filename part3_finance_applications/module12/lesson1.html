<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬1è¯¾: äº¤æ˜“ç­–ç•¥åŸºç¡€ - Pythoné‡‘èç¼–ç¨‹è¯¾ç¨‹</title>
    <link rel="stylesheet" href="../../css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <script>
    // äº¤æ˜“ç­–ç•¥æ¼”ç¤ºç›¸å…³å˜é‡
    let priceData = [];
    let currentIndicator = 'ma';
    let trendDirection = 1;
    let backtestResults = null;
    
    // ç”Ÿæˆä»·æ ¼æ•°æ®
    function generatePriceData(periods, volatility, trendStrength) {
        const data = [];
        let price = 100;
        const vol = volatility / 100;
        const trend = (trendStrength / 100) * 0.001 * trendDirection;
        
        for (let i = 0; i < periods; i++) {
            const randomChange = d3.randomNormal(trend, vol)();
            price *= (1 + randomChange);
            data.push({
                date: i,
                price: price,
                return: randomChange
            });
        }
        return data;
    }
    
    // è®¡ç®—ç§»åŠ¨å¹³å‡çº¿
    function calculateMA(data, period) {
        const ma = [];
        for (let i = 0; i < data.length; i++) {
            if (i < period - 1) {
                ma.push(null);
            } else {
                const sum = data.slice(i - period + 1, i + 1).reduce((acc, d) => acc + d.price, 0);
                ma.push(sum / period);
            }
        }
        return ma;
    }
    
    // è®¡ç®—RSI
    function calculateRSI(data, period = 14) {
        const rsi = [];
        const gains = [];
        const losses = [];
        
        for (let i = 1; i < data.length; i++) {
            const change = data[i].price - data[i-1].price;
            gains.push(change > 0 ? change : 0);
            losses.push(change < 0 ? -change : 0);
        }
        
        for (let i = 0; i < gains.length; i++) {
            if (i < period - 1) {
                rsi.push(null);
            } else {
                const avgGain = gains.slice(i - period + 1, i + 1).reduce((a, b) => a + b, 0) / period;
                const avgLoss = losses.slice(i - period + 1, i + 1).reduce((a, b) => a + b, 0) / period;
                const rs = avgGain / (avgLoss || 0.001);
                rsi.push(100 - (100 / (1 + rs)));
            }
        }
        
        return [null, ...rsi]; // æ·»åŠ ç¬¬ä¸€ä¸ªnullä»¥åŒ¹é…ä»·æ ¼æ•°æ®é•¿åº¦
    }
    
    // è®¡ç®—MACD
    function calculateMACD(data, fastPeriod = 12, slowPeriod = 26, signalPeriod = 9) {
        const ema12 = calculateEMA(data, fastPeriod);
        const ema26 = calculateEMA(data, slowPeriod);
        const macdLine = [];
        
        for (let i = 0; i < data.length; i++) {
            if (ema12[i] !== null && ema26[i] !== null) {
                macdLine.push(ema12[i] - ema26[i]);
            } else {
                macdLine.push(null);
            }
        }
        
        const signalLine = calculateEMAFromArray(macdLine, signalPeriod);
        const histogram = [];
        
        for (let i = 0; i < macdLine.length; i++) {
            if (macdLine[i] !== null && signalLine[i] !== null) {
                histogram.push(macdLine[i] - signalLine[i]);
            } else {
                histogram.push(null);
            }
        }
        
        return { macd: macdLine, signal: signalLine, histogram: histogram };
    }
    
    // è®¡ç®—EMA
    function calculateEMA(data, period) {
        const ema = [];
        const multiplier = 2 / (period + 1);
        
        for (let i = 0; i < data.length; i++) {
            if (i === 0) {
                ema.push(data[i].price);
            } else if (i < period) {
                const sum = data.slice(0, i + 1).reduce((acc, d) => acc + d.price, 0);
                ema.push(sum / (i + 1));
            } else {
                ema.push((data[i].price * multiplier) + (ema[i-1] * (1 - multiplier)));
            }
        }
        return ema;
    }
    
    // ä»æ•°ç»„è®¡ç®—EMA
    function calculateEMAFromArray(data, period) {
        const ema = [];
        const multiplier = 2 / (period + 1);
        let validStart = -1;
        
        for (let i = 0; i < data.length; i++) {
            if (data[i] === null) {
                ema.push(null);
            } else {
                if (validStart === -1) validStart = i;
                
                if (i === validStart) {
                    ema.push(data[i]);
                } else {
                    ema.push((data[i] * multiplier) + (ema[i-1] * (1 - multiplier)));
                }
            }
        }
        return ema;
    }
    
    // è®¡ç®—å¸ƒæ—å¸¦
    function calculateBollingerBands(data, period = 20, stdDev = 2) {
        const ma = calculateMA(data, period);
        const upper = [];
        const lower = [];
        
        for (let i = 0; i < data.length; i++) {
            if (ma[i] === null) {
                upper.push(null);
                lower.push(null);
            } else {
                const prices = data.slice(i - period + 1, i + 1).map(d => d.price);
                const std = d3.deviation(prices);
                upper.push(ma[i] + (std * stdDev));
                lower.push(ma[i] - (std * stdDev));
            }
        }
        
        return { middle: ma, upper: upper, lower: lower };
    }
    
    // ç»˜åˆ¶æŒ‡æ ‡å›¾è¡¨
    function drawIndicatorChart() {
        const container = d3.select('#indicatorChart');
        container.selectAll('*').remove();
        
        const margin = {top: 20, right: 30, bottom: 40, left: 50};
        const width = 800 - margin.left - margin.right;
        const height = 400 - margin.bottom - margin.top;
        
        const svg = container.append('svg')
            .attr('width', width + margin.left + margin.right)
            .attr('height', height + margin.bottom + margin.top);
            
        const g = svg.append('g')
            .attr('transform', `translate(${margin.left},${margin.top})`);
        
        const x = d3.scaleLinear()
            .domain([0, priceData.length - 1])
            .range([0, width]);
        
        // æ ¹æ®å½“å‰æŒ‡æ ‡ç»˜åˆ¶ä¸åŒå›¾è¡¨
        switch(currentIndicator) {
            case 'ma':
                drawMAChart(g, x, width, height);
                break;
            case 'rsi':
                drawRSIChart(g, x, width, height);
                break;
            case 'macd':
                drawMACDChart(g, x, width, height);
                break;
            case 'bollinger':
                drawBollingerChart(g, x, width, height);
                break;
        }
    }
    
    // ç»˜åˆ¶ç§»åŠ¨å¹³å‡çº¿å›¾è¡¨
    function drawMAChart(g, x, width, height) {
        const prices = priceData.map(d => d.price);
        const ma5 = calculateMA(priceData, 5);
        const ma20 = calculateMA(priceData, 20);
        
        const y = d3.scaleLinear()
            .domain(d3.extent(prices))
            .range([height, 0]);
        
        const line = d3.line()
            .x((d, i) => x(i))
            .y(d => y(d))
            .defined(d => d !== null);
        
        // ç»˜åˆ¶ä»·æ ¼çº¿
        g.append('path')
            .datum(prices)
            .attr('fill', 'none')
            .attr('stroke', '#333')
            .attr('stroke-width', 2)
            .attr('d', line);
        
        // ç»˜åˆ¶MA5
        g.append('path')
            .datum(ma5)
            .attr('fill', 'none')
            .attr('stroke', '#ff6b6b')
            .attr('stroke-width', 2)
            .attr('d', line);
        
        // ç»˜åˆ¶MA20
        g.append('path')
            .datum(ma20)
            .attr('fill', 'none')
            .attr('stroke', '#4ecdc4')
            .attr('stroke-width', 2)
            .attr('d', line);
        
        // æ·»åŠ åæ ‡è½´
        g.append('g')
            .attr('transform', `translate(0,${height})`)
            .call(d3.axisBottom(x));
            
        g.append('g')
            .call(d3.axisLeft(y));
        
        // æ›´æ–°æŒ‡æ ‡å€¼
        const lastPrice = prices[prices.length - 1];
        const lastMA5 = ma5[ma5.length - 1];
        const lastMA20 = ma20[ma20.length - 1];
        
        document.getElementById('currentPrice').textContent = lastPrice.toFixed(2);
        document.getElementById('indicatorValue').textContent = `MA5: ${lastMA5?.toFixed(2) || '--'}, MA20: ${lastMA20?.toFixed(2) || '--'}`;
        document.getElementById('indicatorLabel').textContent = 'ç§»åŠ¨å¹³å‡çº¿';
        
        // åˆ¤æ–­äº¤æ˜“ä¿¡å·
        let signal = 'HOLD';
        if (lastMA5 && lastMA20) {
            if (lastMA5 > lastMA20 && lastPrice > lastMA5) signal = 'BUY';
            else if (lastMA5 < lastMA20 && lastPrice < lastMA5) signal = 'SELL';
        }
        
        document.getElementById('currentSignal').innerHTML = `<span class="signal-indicator signal-${signal.toLowerCase()}"></span>${signal}`;
        document.getElementById('signalStrength').textContent = Math.abs(((lastMA5 || 0) - (lastMA20 || 0)) / (lastMA20 || 1) * 100).toFixed(1) + '%';
    }
    
    // ç»˜åˆ¶RSIå›¾è¡¨
    function drawRSIChart(g, x, width, height) {
        const rsi = calculateRSI(priceData);
        
        const y = d3.scaleLinear()
            .domain([0, 100])
            .range([height, 0]);
        
        const line = d3.line()
            .x((d, i) => x(i))
            .y(d => y(d))
            .defined(d => d !== null);
        
        // ç»˜åˆ¶RSIçº¿
        g.append('path')
            .datum(rsi)
            .attr('fill', 'none')
            .attr('stroke', '#9b59b6')
            .attr('stroke-width', 2)
            .attr('d', line);
        
        // ç»˜åˆ¶è¶…ä¹°è¶…å–çº¿
        g.append('line')
            .attr('x1', 0).attr('x2', width)
            .attr('y1', y(70)).attr('y2', y(70))
            .attr('stroke', '#e74c3c')
            .attr('stroke-dasharray', '5,5');
            
        g.append('line')
            .attr('x1', 0).attr('x2', width)
            .attr('y1', y(30)).attr('y2', y(30))
            .attr('stroke', '#27ae60')
            .attr('stroke-dasharray', '5,5');
        
        // æ·»åŠ åæ ‡è½´
        g.append('g')
            .attr('transform', `translate(0,${height})`)
            .call(d3.axisBottom(x));
            
        g.append('g')
            .call(d3.axisLeft(y));
        
        // æ›´æ–°æŒ‡æ ‡å€¼
        const lastRSI = rsi[rsi.length - 1];
        document.getElementById('currentPrice').textContent = priceData[priceData.length - 1].price.toFixed(2);
        document.getElementById('indicatorValue').textContent = lastRSI?.toFixed(2) || '--';
        document.getElementById('indicatorLabel').textContent = 'RSI';
        
        // åˆ¤æ–­äº¤æ˜“ä¿¡å·
        let signal = 'HOLD';
        if (lastRSI) {
            if (lastRSI < 30) signal = 'BUY';
            else if (lastRSI > 70) signal = 'SELL';
        }
        
        document.getElementById('currentSignal').innerHTML = `<span class="signal-indicator signal-${signal.toLowerCase()}"></span>${signal}`;
        document.getElementById('signalStrength').textContent = lastRSI ? Math.abs(50 - lastRSI).toFixed(1) : '--';
    }
    
    // ç»˜åˆ¶MACDå›¾è¡¨
    function drawMACDChart(g, x, width, height) {
        const macdData = calculateMACD(priceData);
        
        const allValues = [...macdData.macd, ...macdData.signal, ...macdData.histogram].filter(d => d !== null);
        const y = d3.scaleLinear()
            .domain(d3.extent(allValues))
            .range([height, 0]);
        
        const line = d3.line()
            .x((d, i) => x(i))
            .y(d => y(d))
            .defined(d => d !== null);
        
        // ç»˜åˆ¶MACDçº¿
        g.append('path')
            .datum(macdData.macd)
            .attr('fill', 'none')
            .attr('stroke', '#3498db')
            .attr('stroke-width', 2)
            .attr('d', line);
        
        // ç»˜åˆ¶ä¿¡å·çº¿
        g.append('path')
            .datum(macdData.signal)
            .attr('fill', 'none')
            .attr('stroke', '#e74c3c')
            .attr('stroke-width', 2)
            .attr('d', line);
        
        // ç»˜åˆ¶æŸ±çŠ¶å›¾
        macdData.histogram.forEach((d, i) => {
            if (d !== null) {
                g.append('rect')
                    .attr('x', x(i) - 1)
                    .attr('y', d > 0 ? y(d) : y(0))
                    .attr('width', 2)
                    .attr('height', Math.abs(y(d) - y(0)))
                    .attr('fill', d > 0 ? '#27ae60' : '#e74c3c')
                    .attr('opacity', 0.7);
            }
        });
        
        // æ·»åŠ é›¶çº¿
        g.append('line')
            .attr('x1', 0).attr('x2', width)
            .attr('y1', y(0)).attr('y2', y(0))
            .attr('stroke', '#666')
            .attr('stroke-dasharray', '3,3');
        
        // æ·»åŠ åæ ‡è½´
        g.append('g')
            .attr('transform', `translate(0,${height})`)
            .call(d3.axisBottom(x));
            
        g.append('g')
            .call(d3.axisLeft(y));
        
        // æ›´æ–°æŒ‡æ ‡å€¼
        const lastMACD = macdData.macd[macdData.macd.length - 1];
        const lastSignal = macdData.signal[macdData.signal.length - 1];
        const lastHist = macdData.histogram[macdData.histogram.length - 1];
        
        document.getElementById('currentPrice').textContent = priceData[priceData.length - 1].price.toFixed(2);
        document.getElementById('indicatorValue').textContent = `MACD: ${lastMACD?.toFixed(4) || '--'}`;
        document.getElementById('indicatorLabel').textContent = 'MACD';
        
        // åˆ¤æ–­äº¤æ˜“ä¿¡å·
        let signal = 'HOLD';
        if (lastMACD && lastSignal) {
            if (lastMACD > lastSignal && lastHist > 0) signal = 'BUY';
            else if (lastMACD < lastSignal && lastHist < 0) signal = 'SELL';
        }
        
        document.getElementById('currentSignal').innerHTML = `<span class="signal-indicator signal-${signal.toLowerCase()}"></span>${signal}`;
        document.getElementById('signalStrength').textContent = lastHist ? Math.abs(lastHist).toFixed(4) : '--';
    }
    
    // ç»˜åˆ¶å¸ƒæ—å¸¦å›¾è¡¨
    function drawBollingerChart(g, x, width, height) {
        const prices = priceData.map(d => d.price);
        const bollinger = calculateBollingerBands(priceData);
        
        const allValues = [...prices, ...bollinger.upper.filter(d => d !== null), ...bollinger.lower.filter(d => d !== null)];
        const y = d3.scaleLinear()
            .domain(d3.extent(allValues))
            .range([height, 0]);
        
        const line = d3.line()
            .x((d, i) => x(i))
            .y(d => y(d))
            .defined(d => d !== null);
        
        // ç»˜åˆ¶å¸ƒæ—å¸¦åŒºåŸŸ
        const area = d3.area()
            .x((d, i) => x(i))
            .y0(d => y(d.lower))
            .y1(d => y(d.upper))
            .defined(d => d.upper !== null && d.lower !== null);
        
        const bandData = bollinger.upper.map((upper, i) => ({
            upper: upper,
            lower: bollinger.lower[i]
        }));
        
        g.append('path')
            .datum(bandData)
            .attr('fill', '#3498db')
            .attr('opacity', 0.2)
            .attr('d', area);
        
        // ç»˜åˆ¶ä»·æ ¼çº¿
        g.append('path')
            .datum(prices)
            .attr('fill', 'none')
            .attr('stroke', '#333')
            .attr('stroke-width', 2)
            .attr('d', line);
        
        // ç»˜åˆ¶ä¸­è½¨
        g.append('path')
            .datum(bollinger.middle)
            .attr('fill', 'none')
            .attr('stroke', '#f39c12')
            .attr('stroke-width', 2)
            .attr('d', line);
        
        // ç»˜åˆ¶ä¸Šä¸‹è½¨
        g.append('path')
            .datum(bollinger.upper)
            .attr('fill', 'none')
            .attr('stroke', '#3498db')
            .attr('stroke-width', 1)
            .attr('stroke-dasharray', '5,5')
            .attr('d', line);
            
        g.append('path')
            .datum(bollinger.lower)
            .attr('fill', 'none')
            .attr('stroke', '#3498db')
            .attr('stroke-width', 1)
            .attr('stroke-dasharray', '5,5')
            .attr('d', line);
        
        // æ·»åŠ åæ ‡è½´
        g.append('g')
            .attr('transform', `translate(0,${height})`)
            .call(d3.axisBottom(x));
            
        g.append('g')
            .call(d3.axisLeft(y));
        
        // æ›´æ–°æŒ‡æ ‡å€¼
        const lastPrice = prices[prices.length - 1];
        const lastUpper = bollinger.upper[bollinger.upper.length - 1];
        const lastLower = bollinger.lower[bollinger.lower.length - 1];
        const lastMiddle = bollinger.middle[bollinger.middle.length - 1];
        
        document.getElementById('currentPrice').textContent = lastPrice.toFixed(2);
        document.getElementById('indicatorValue').textContent = `å¸¦å®½: ${lastUpper && lastLower ? ((lastUpper - lastLower) / lastMiddle * 100).toFixed(2) + '%' : '--'}`;
        document.getElementById('indicatorLabel').textContent = 'å¸ƒæ—å¸¦';
        
        // åˆ¤æ–­äº¤æ˜“ä¿¡å·
        let signal = 'HOLD';
        if (lastPrice && lastUpper && lastLower && lastMiddle) {
            if (lastPrice < lastLower) signal = 'BUY';
            else if (lastPrice > lastUpper) signal = 'SELL';
        }
        
        document.getElementById('currentSignal').innerHTML = `<span class="signal-indicator signal-${signal.toLowerCase()}"></span>${signal}`;
        
        const position = lastMiddle ? ((lastPrice - lastMiddle) / (lastUpper - lastMiddle) * 100) : 0;
        document.getElementById('signalStrength').textContent = Math.abs(position).toFixed(1) + '%';
    }
    
    // åˆ‡æ¢æŒ‡æ ‡
    function switchIndicator(indicator) {
        currentIndicator = indicator;
        
        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        
        drawIndicatorChart();
    }
    
    // æ›´æ–°æŒ‡æ ‡
    function updateIndicators() {
        const period = +document.getElementById('dataPeriod').value;
        const volatility = +document.getElementById('priceVolatility').value;
        const trendStrength = +document.getElementById('trendStrength').value;
        
        document.getElementById('dataPeriodNum').value = period;
        document.getElementById('priceVolatilityNum').value = volatility;
        document.getElementById('trendStrengthNum').value = trendStrength;
        
        priceData = generatePriceData(period, volatility, trendStrength);
        drawIndicatorChart();
    }
    
    // ç”Ÿæˆæ–°ä»·æ ¼æ•°æ®
    function generateNewPriceData() {
        updateIndicators();
    }
    
    // åˆ‡æ¢è¶‹åŠ¿
    function toggleTrend() {
        trendDirection *= -1;
        const button = event.target;
        button.textContent = trendDirection > 0 ? 'åˆ‡æ¢è¶‹åŠ¿ (ä¸Šæ¶¨)' : 'åˆ‡æ¢è¶‹åŠ¿ (ä¸‹è·Œ)';
        updateIndicators();
    }
    
    // è¿è¡Œå›æµ‹
    function runBacktest() {
        const strategy = document.getElementById('strategyType').value;
        const period = +document.getElementById('backtestPeriod').value;
        const cost = +document.getElementById('tradingCost').value / 10000; // è½¬æ¢ä¸ºå°æ•°
        
        document.getElementById('backtestPeriodNum').value = period;
        document.getElementById('tradingCostNum').value = document.getElementById('tradingCost').value;
        
        // ç”Ÿæˆå›æµ‹æ•°æ®
        const testData = generatePriceData(period, 25, 20);
        
        // æ ¹æ®ç­–ç•¥ç”Ÿæˆä¿¡å·
        const signals = generateSignals(testData, strategy);
        
        // è®¡ç®—å›æµ‹ç»“æœ
        backtestResults = calculateBacktestResults(testData, signals, cost);
        
        // ç»˜åˆ¶å›æµ‹å›¾è¡¨
        drawBacktestChart(testData, signals, backtestResults);
        
        // æ›´æ–°æŒ‡æ ‡æ˜¾ç¤º
        updateBacktestMetrics(backtestResults);
    }
    
    // ç”Ÿæˆäº¤æ˜“ä¿¡å·
    function generateSignals(data, strategy) {
        const signals = [];
        
        switch(strategy) {
            case 'ma_crossover':
                const ma5 = calculateMA(data, 5);
                const ma20 = calculateMA(data, 20);
                for (let i = 0; i < data.length; i++) {
                    if (i === 0 || !ma5[i] || !ma20[i]) {
                        signals.push(0);
                    } else {
                        const prevMA5 = ma5[i-1];
                        const prevMA20 = ma20[i-1];
                        if (prevMA5 <= prevMA20 && ma5[i] > ma20[i]) {
                            signals.push(1); // ä¹°å…¥
                        } else if (prevMA5 >= prevMA20 && ma5[i] < ma20[i]) {
                            signals.push(-1); // å–å‡º
                        } else {
                            signals.push(0); // æŒæœ‰
                        }
                    }
                }
                break;
                
            case 'rsi_reversal':
                const rsi = calculateRSI(data);
                for (let i = 0; i < data.length; i++) {
                    if (!rsi[i]) {
                        signals.push(0);
                    } else if (rsi[i] < 30) {
                        signals.push(1); // ä¹°å…¥
                    } else if (rsi[i] > 70) {
                        signals.push(-1); // å–å‡º
                    } else {
                        signals.push(0);
                    }
                }
                break;
                
            case 'macd_momentum':
                const macdData = calculateMACD(data);
                for (let i = 1; i < data.length; i++) {
                    if (!macdData.macd[i] || !macdData.signal[i] || !macdData.macd[i-1] || !macdData.signal[i-1]) {
                        signals.push(0);
                    } else {
                        const prevDiff = macdData.macd[i-1] - macdData.signal[i-1];
                        const currDiff = macdData.macd[i] - macdData.signal[i];
                        if (prevDiff <= 0 && currDiff > 0) {
                            signals.push(1); // ä¹°å…¥
                        } else if (prevDiff >= 0 && currDiff < 0) {
                            signals.push(-1); // å–å‡º
                        } else {
                            signals.push(0);
                        }
                    }
                }
                signals.unshift(0); // æ·»åŠ ç¬¬ä¸€ä¸ªä¿¡å·
                break;
                
            case 'bollinger_mean':
                const bollinger = calculateBollingerBands(data);
                for (let i = 0; i < data.length; i++) {
                    if (!bollinger.upper[i] || !bollinger.lower[i]) {
                        signals.push(0);
                    } else if (data[i].price < bollinger.lower[i]) {
                        signals.push(1); // ä¹°å…¥
                    } else if (data[i].price > bollinger.upper[i]) {
                        signals.push(-1); // å–å‡º
                    } else {
                        signals.push(0);
                    }
                }
                break;
        }
        
        return signals;
    }
    
    // è®¡ç®—å›æµ‹ç»“æœ
    function calculateBacktestResults(data, signals, cost) {
        let position = 0;
        let cash = 10000;
        let portfolio = [];
        let trades = [];
        
        for (let i = 0; i < data.length; i++) {
            const price = data[i].price;
            const signal = signals[i];
            
            if (signal === 1 && position === 0) {
                // ä¹°å…¥
                const shares = Math.floor(cash / price);
                const tradeCost = shares * price * cost;
                cash -= shares * price + tradeCost;
                position = shares;
                trades.push({ type: 'buy', price: price, shares: shares, date: i });
            } else if (signal === -1 && position > 0) {
                // å–å‡º
                const tradeCost = position * price * cost;
                cash += position * price - tradeCost;
                trades.push({ type: 'sell', price: price, shares: position, date: i });
                position = 0;
            }
            
            const portfolioValue = cash + position * price;
            portfolio.push(portfolioValue);
        }
        
        // è®¡ç®—æ”¶ç›Šç‡
        const returns = [];
        for (let i = 1; i < portfolio.length; i++) {
            returns.push((portfolio[i] - portfolio[i-1]) / portfolio[i-1]);
        }
        
        // è®¡ç®—æŒ‡æ ‡
        const totalReturn = (portfolio[portfolio.length - 1] - 10000) / 10000 * 100;
        const avgReturn = d3.mean(returns) || 0;
        const stdReturn = d3.deviation(returns) || 0;
        const sharpeRatio = stdReturn > 0 ? (avgReturn * 252) / (stdReturn * Math.sqrt(252)) : 0;
        
        // è®¡ç®—æœ€å¤§å›æ’¤
        let maxDrawdown = 0;
        let peak = portfolio[0];
        for (let i = 1; i < portfolio.length; i++) {
            if (portfolio[i] > peak) {
                peak = portfolio[i];
            } else {
                const drawdown = (peak - portfolio[i]) / peak;
                maxDrawdown = Math.max(maxDrawdown, drawdown);
            }
        }
        
        // è®¡ç®—èƒœç‡
        const winningTrades = trades.filter((trade, i) => {
            if (trade.type === 'sell' && i > 0) {
                const buyTrade = trades[i-1];
                return trade.price > buyTrade.price;
            }
            return false;
        }).length;
        
        const totalCompleteTrades = Math.floor(trades.length / 2);
        const winRate = totalCompleteTrades > 0 ? (winningTrades / totalCompleteTrades) * 100 : 0;
        
        const calmarRatio = maxDrawdown > 0 ? (totalReturn / 100) / maxDrawdown : 0;
        
        return {
            portfolio: portfolio,
            trades: trades,
            totalReturn: totalReturn,
            sharpeRatio: sharpeRatio,
            maxDrawdown: maxDrawdown * 100,
            winRate: winRate,
            totalTrades: trades.length,
            calmarRatio: calmarRatio
        };
    }
    
    // ç»˜åˆ¶å›æµ‹å›¾è¡¨
    function drawBacktestChart(data, signals, results) {
        const container = d3.select('#backtestChart');
        container.selectAll('*').remove();
        
        const margin = {top: 20, right: 30, bottom: 40, left: 50};
        const width = 800 - margin.left - margin.right;
        const height = 400 - margin.bottom - margin.top;
        
        const svg = container.append('svg')
            .attr('width', width + margin.left + margin.right)
            .attr('height', height + margin.bottom + margin.top);
            
        const g = svg.append('g')
            .attr('transform', `translate(${margin.left},${margin.top})`);
        
        const x = d3.scaleLinear()
            .domain([0, data.length - 1])
            .range([0, width]);
        
        // æ ‡å‡†åŒ–ç»„åˆä»·å€¼å’Œä»·æ ¼åˆ°ç›¸åŒèµ·ç‚¹
        const normalizedPrice = data.map((d, i) => d.price / data[0].price * 10000);
        const allValues = [...normalizedPrice, ...results.portfolio];
        
        const y = d3.scaleLinear()
            .domain(d3.extent(allValues))
            .range([height, 0]);
        
        const line = d3.line()
            .x((d, i) => x(i))
            .y(d => y(d));
        
        // ç»˜åˆ¶åŸºå‡†ä»·æ ¼çº¿
        g.append('path')
            .datum(normalizedPrice)
            .attr('fill', 'none')
            .attr('stroke', '#bdc3c7')
            .attr('stroke-width', 2)
            .attr('d', line);
        
        // ç»˜åˆ¶ç­–ç•¥æ”¶ç›Šçº¿
        g.append('path')
            .datum(results.portfolio)
            .attr('fill', 'none')
            .attr('stroke', '#3498db')
            .attr('stroke-width', 3)
            .attr('d', line);
        
        // æ ‡è®°äº¤æ˜“ç‚¹
        results.trades.forEach(trade => {
            g.append('circle')
                .attr('cx', x(trade.date))
                .attr('cy', y(results.portfolio[trade.date]))
                .attr('r', 4)
                .attr('fill', trade.type === 'buy' ? '#27ae60' : '#e74c3c');
        });
        
        // æ·»åŠ åæ ‡è½´
        g.append('g')
            .attr('transform', `translate(0,${height})`)
            .call(d3.axisBottom(x));
            
        g.append('g')
            .call(d3.axisLeft(y));
        
        // æ·»åŠ å›¾ä¾‹
        const legend = g.append('g')
            .attr('transform', `translate(${width - 150}, 20)`);
            
        legend.append('line')
            .attr('x1', 0).attr('x2', 20)
            .attr('y1', 0).attr('y2', 0)
            .attr('stroke', '#bdc3c7')
            .attr('stroke-width', 2);
            
        legend.append('text')
            .attr('x', 25).attr('y', 5)
            .text('åŸºå‡†');
            
        legend.append('line')
            .attr('x1', 0).attr('x2', 20)
            .attr('y1', 20).attr('y2', 20)
            .attr('stroke', '#3498db')
            .attr('stroke-width', 3);
            
        legend.append('text')
            .attr('x', 25).attr('y', 25)
            .text('ç­–ç•¥');
    }
    
    // æ›´æ–°å›æµ‹æŒ‡æ ‡
    function updateBacktestMetrics(results) {
        document.getElementById('totalReturn').textContent = `${results.totalReturn.toFixed(2)}%`;
        document.getElementById('sharpeRatio').textContent = results.sharpeRatio.toFixed(3);
        document.getElementById('maxDrawdown').textContent = `${results.maxDrawdown.toFixed(2)}%`;
        document.getElementById('winRate').textContent = `${results.winRate.toFixed(1)}%`;
        document.getElementById('totalTrades').textContent = results.totalTrades;
        document.getElementById('calmarRatio').textContent = results.calmarRatio.toFixed(3);
    }
    
    // é‡ç½®å›æµ‹
    function resetBacktest() {
        backtestResults = null;
        const container = d3.select('#backtestChart');
        container.selectAll('*').remove();
        container.append('div')
            .style('text-align', 'center')
            .style('padding', '50px')
            .style('color', '#666')
            .text('ç‚¹å‡»"è¿è¡Œå›æµ‹"å¼€å§‹åˆ†æ');
        
        document.getElementById('totalReturn').textContent = '--';
        document.getElementById('sharpeRatio').textContent = '--';
        document.getElementById('maxDrawdown').textContent = '--';
        document.getElementById('winRate').textContent = '--';
        document.getElementById('totalTrades').textContent = '--';
        document.getElementById('calmarRatio').textContent = '--';
    }
    
    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
        updateIndicators();
        resetBacktest();
    });
    </script>

    <style>
    /* ç¡®ä¿ä»£ç å—å·¦å¯¹é½ */
    .lesson-content pre {
        text-align: left !important;
        font-family: 'Courier New', Courier, monospace;
        background-color: #f5f7fa;
        padding: 15px;
        border-radius: 8px;
        overflow-x: auto;
        margin: 20px 0;
        border-left: 4px solid #4299e1;
    }
    
    .lesson-content code {
        text-align: left !important;
        font-family: 'Courier New', Courier, monospace;
        background-color: #f5f7fa;
        padding: 2px 5px;
        border-radius: 3px;
    }
    
    /* ç¡®ä¿preæ ‡ç­¾å†…çš„å†…å®¹å·¦å¯¹é½ */
    pre * {
        text-align: left !important;
    }
    
    /* ç¡®ä¿æ‰€æœ‰ä»£ç ç›¸å…³å…ƒç´ éƒ½å·¦å¯¹é½ */
    pre, code, .hljs {
        text-align: left !important;
    }
    
    /* äº¤æ˜“ç­–ç•¥æ¼”ç¤ºæ ·å¼ */
    .strategy-demo {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 15px;
        margin: 30px 0;
        box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
    }
    
    .demo-controls {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 20px 0;
    }
    
    .control-group {
        background: rgba(255,255,255,0.1);
        padding: 15px;
        border-radius: 10px;
        border: 1px solid rgba(255,255,255,0.2);
    }
    
    .control-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        font-size: 14px;
    }
    
    .control-group input[type="range"] {
        width: 100%;
        margin: 5px 0;
    }
    
    .control-group input[type="number"] {
        width: 80px;
        padding: 5px 8px;
        border: 1px solid rgba(255,255,255,0.3);
        border-radius: 5px;
        background: rgba(255,255,255,0.2);
        color: white;
        font-size: 14px;
    }
    
    .control-group select {
        width: 100%;
        padding: 8px;
        border-radius: 5px;
        background: rgba(255,255,255,0.2);
        color: white;
        border: 1px solid rgba(255,255,255,0.3);
        font-size: 14px;
    }
    
    .strategy-chart {
        background: white;
        border-radius: 12px;
        padding: 25px;
        margin: 20px 0;
        box-shadow: 0 6px 25px rgba(0,0,0,0.1);
        min-height: 400px;
    }
    
    .metrics-display {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
    }
    
    .metric-card {
        background: rgba(255,255,255,0.15);
        padding: 15px;
        border-radius: 10px;
        text-align: center;
        border: 1px solid rgba(255,255,255,0.2);
    }
    
    .metric-value {
        font-size: 24px;
        font-weight: bold;
        margin: 5px 0;
    }
    
    .metric-label {
        font-size: 12px;
        opacity: 0.9;
    }
    
    .demo-button {
        background: rgba(255,255,255,0.2);
        color: white;
        border: 2px solid rgba(255,255,255,0.3);
        padding: 12px 25px;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
        margin: 5px;
    }
    
    .demo-button:hover {
        background: rgba(255,255,255,0.3);
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(0,0,0,0.2);
    }
    
    .demo-button.active {
        background: rgba(255,255,255,0.4);
        border-color: rgba(255,255,255,0.6);
    }
    
    .indicator-tabs {
        display: flex;
        gap: 10px;
        margin: 20px 0;
        flex-wrap: wrap;
    }
    
    .tab-button {
        background: rgba(255,255,255,0.1);
        color: white;
        border: 1px solid rgba(255,255,255,0.3);
        padding: 10px 20px;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
    }
    
    .tab-button.active {
        background: rgba(255,255,255,0.3);
        border-color: rgba(255,255,255,0.6);
    }
    
    .signal-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 8px;
    }
    
    .signal-buy { background-color: #27ae60; }
    .signal-sell { background-color: #e74c3c; }
    .signal-hold { background-color: #f39c12; }
    </style>
    
</head>
<body>
<div id="navigation-container"></div>
<script>
// åŠ¨æ€åŠ è½½å¯¼èˆªæ¡
function loadNavigation() {
    fetch('../../nav.html')
        .then(response => response.text())
        .then(html => {
            // æ›´æ–°å¯¼èˆªä¸­çš„é“¾æ¥è·¯å¾„
            let updatedHtml = html;
            
            // å¤„ç†æ ¹ç›®å½•æ–‡ä»¶é“¾æ¥ï¼ˆindex.html, syllabus.htmlç­‰ï¼‰
            updatedHtml = updatedHtml.replace(/href="index\.html"/g, 'href="../../index.html"');
            updatedHtml = updatedHtml.replace(/href="\.\/([^/]*\.html)"/g, 'href="../../$1"');
            
            // å¤„ç†æ¨¡å—è·¯å¾„é“¾æ¥ï¼ˆå·²ç»æ˜¯å®Œæ•´ç›¸å¯¹è·¯å¾„ï¼Œåªéœ€è¦æ·»åŠ æ ¹è·¯å¾„å‰ç¼€ï¼‰
            updatedHtml = updatedHtml.replace(/href="\.\/part([^"]*)"/g, 'href="../../part$1"');
            
            document.getElementById('navigation-container').innerHTML = updatedHtml;
            
            // æ·»åŠ ç§»åŠ¨ç«¯èœå•åˆ‡æ¢åŠŸèƒ½
            const menuToggle = document.getElementById('menuToggle');
            const navMenu = document.querySelector('.nav-menu');
            if (menuToggle && navMenu) {
                menuToggle.addEventListener('click', function() {
                    navMenu.classList.toggle('active');
                });
            }
        })
        .catch(error => console.error('å¯¼èˆªåŠ è½½å¤±è´¥:', error));
}

// é¡µé¢åŠ è½½å®ŒæˆååŠ è½½å¯¼èˆª
document.addEventListener('DOMContentLoaded', loadNavigation);
</script>



<main class="container">
        <section class="lesson-content">
            <h2>é‡åŒ–äº¤æ˜“æ¦‚è¿°</h2>
            <p>é‡åŒ–äº¤æ˜“æ˜¯åˆ©ç”¨æ•°å­¦æ¨¡å‹å’Œè®¡ç®—æœºç¨‹åºæ¥è¯†åˆ«å’Œæ‰§è¡Œäº¤æ˜“æœºä¼šçš„ç³»ç»ŸåŒ–æ–¹æ³•ã€‚</p>
            <div class="math-theory">
                <h3>æ•°å­¦ç†è®ºåŸºç¡€</h3>
                <h4>1. æ”¶ç›Šç‡è®¡ç®—</h4>
                <p>ç®€å•æ”¶ç›Šç‡ï¼š</p>
                <div class="formula">
                    \[R_t = \frac{P_t - P_{t-1}}{P_{t-1}}\]
                </div>
                <p>å¯¹æ•°æ”¶ç›Šç‡ï¼ˆè¿ç»­å¤åˆ©æ”¶ç›Šç‡ï¼‰ï¼š</p>
                <div class="formula">
                    \[r_t = \ln\left(\frac{P_t}{P_{t-1}}\right) = \ln(1 + R_t)\]
                </div>
                <h4>2. ç­–ç•¥ç»©æ•ˆæŒ‡æ ‡</h4>
                <p><strong>å¤æ™®æ¯”ç‡</strong>ï¼š</p>
                <div class="formula">
                    \[Sharpe = \frac{E[R_p] - R_f}{\sigma_p}\]
                </div>
                <p>å…¶ä¸­ \(R_p\) ä¸ºæŠ•èµ„ç»„åˆæ”¶ç›Šç‡ï¼Œ\(R_f\) ä¸ºæ— é£é™©åˆ©ç‡ï¼Œ\(\sigma_p\) ä¸ºæŠ•èµ„ç»„åˆæ”¶ç›Šç‡æ ‡å‡†å·®ã€‚</p>
                <p><strong>æœ€å¤§å›æ’¤</strong>ï¼š</p>
                <div class="formula">
                    \[MDD = \max_{t \in [0,T]} \left( \max_{s \in [0,t]} V_s - V_t \right) / \max_{s \in [0,t]} V_s\]
                </div>
                <p>å…¶ä¸­ \(V_t\) ä¸ºæ—¶åˆ» \(t\) çš„æŠ•èµ„ç»„åˆä»·å€¼ã€‚</p>
                <p><strong>å¡å°”é©¬æ¯”ç‡</strong>ï¼š</p>
                <div class="formula">
                    \[Calmar = \frac{å¹´åŒ–æ”¶ç›Šç‡}{æœ€å¤§å›æ’¤}\]
                </div>
                <h4>3. æŠ€æœ¯æŒ‡æ ‡æ•°å­¦å…¬å¼</h4>
                <p><strong>ç§»åŠ¨å¹³å‡çº¿</strong>ï¼š</p>
                <div class="formula">
                    \[MA_n(t) = \frac{1}{n} \sum_{i=0}^{n-1} P_{t-i}\]
                </div>
                <p><strong>æŒ‡æ•°ç§»åŠ¨å¹³å‡çº¿</strong>ï¼š</p>
                <div class="formula">
                    \[EMA_t = \alpha \cdot P_t + (1-\alpha) \cdot EMA_{t-1}\]
                </div>
                <p>å…¶ä¸­ \(\alpha = \frac{2}{n+1}\) ä¸ºå¹³æ»‘å› å­ã€‚</p>
                <p><strong>ç›¸å¯¹å¼ºå¼±æŒ‡æ•°(RSI)</strong>ï¼š</p>
                <div class="formula">
                    \[RSI = 100 - \frac{100}{1 + RS}\]
                </div>
                <div class="formula">
                    \[RS = \frac{å¹³å‡ä¸Šæ¶¨å¹…åº¦}{å¹³å‡ä¸‹è·Œå¹…åº¦}\]
                </div>
                <h4>4. å‡å€¼å›å½’ç­–ç•¥</h4>
                <p><strong>Z-Scoreæ ‡å‡†åŒ–</strong>ï¼š</p>
                <div class="formula">
                    \[Z_t = \frac{P_t - \mu}{\sigma}\]
                </div>
                <p>å…¶ä¸­ \(\mu\) ä¸ºå†å²å‡å€¼ï¼Œ\(\sigma\) ä¸ºå†å²æ ‡å‡†å·®ã€‚</p>
                <p><strong>å¸ƒæ—å¸¦</strong>ï¼š</p>
                <div class="formula">
                    \[ä¸Šè½¨ = MA_n + k \cdot \sigma_n\]
                </div>
                <div class="formula">
                    \[ä¸‹è½¨ = MA_n - k \cdot \sigma_n\]
                </div>
                <p>å…¶ä¸­ \(k\) é€šå¸¸å–2ï¼Œ\(\sigma_n\) ä¸º \(n\) æœŸæ ‡å‡†å·®ã€‚</p>
                <h4>5. åŠ¨é‡ç­–ç•¥</h4>
                <p><strong>ä»·æ ¼åŠ¨é‡</strong>ï¼š</p>
                <div class="formula">
                    \[Momentum_t = \frac{P_t - P_{t-n}}{P_{t-n}}\]
                </div>
                <p><strong>MACDæŒ‡æ ‡</strong>ï¼š</p>
                <div class="formula">
                    \[MACD = EMA_{12} - EMA_{26}\]
                </div>
                <div class="formula">
                    \[Signal = EMA_9(MACD)\]
                </div>
                <div class="formula">
                    \[Histogram = MACD - Signal\]
                </div>
            </div>
            <h3>1. é‡åŒ–äº¤æ˜“çš„åŸºæœ¬ç‰¹å¾</h3>
            <pre><code class="language-python"># é‡åŒ–äº¤æ˜“ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶
components = {
    'æ•°æ®è·å–': 'å®æ—¶å¸‚åœºæ•°æ®ã€å†å²æ•°æ®ã€æ›¿ä»£æ•°æ®',
    'ç­–ç•¥ç ”ç©¶': 'ç»Ÿè®¡æ¨¡å‹ã€æœºå™¨å­¦ä¹ ã€æŠ€æœ¯åˆ†æ',
    'é£é™©æ§åˆ¶': 'å¤´å¯¸ç®¡ç†ã€æ­¢æŸç­–ç•¥ã€æ³¢åŠ¨ç‡æ§åˆ¶',
    'æ‰§è¡Œç³»ç»Ÿ': 'è®¢å•è·¯ç”±ã€äº¤æ˜“æˆæœ¬åˆ†æã€ç»©æ•ˆè¯„ä¼°'
}</code></pre>
            <h3>2. é‡åŒ–äº¤æ˜“çš„ä¼˜åŠ¿</h3>
            <pre><code class="language-python">advantages = [
    'æ¶ˆé™¤äººä¸ºæƒ…ç»ªå½±å“',
    'å¯å›æµ‹å’ŒéªŒè¯ç­–ç•¥',
    'èƒ½å¤Ÿå¤„ç†å¤§é‡æ•°æ®',
    'å¯åŒæ—¶ç›‘æ§å¤šä¸ªå¸‚åœº',
    'æ‰§è¡Œé€Ÿåº¦å¿«ä¸”ä¸€è‡´'
]</code></pre>
        </section>
        <section class="lesson-content">
            <h2>å¸¸è§äº¤æ˜“ç­–ç•¥ç±»å‹</h2>
            <p>é‡åŒ–ç­–ç•¥ä¸»è¦åˆ†ä¸ºè¶‹åŠ¿è·Ÿéšã€å‡å€¼å›å½’ã€ç»Ÿè®¡å¥—åˆ©ç­‰å‡ å¤§ç±»ã€‚</p>
            <h3>1. å‡å€¼å›å½’ç­–ç•¥</h3>
            <pre><code class="language-python">import numpy as np
import pandas as pd
def mean_reversion_strategy(prices, window=20, z_threshold=1.5):
    """
    ç®€å•çš„å‡å€¼å›å½’ç­–ç•¥
    å½“ä»·æ ¼åç¦»ç§»åŠ¨å¹³å‡çº¿è¶…è¿‡é˜ˆå€¼æ—¶äº¤æ˜“
    """
    # è®¡ç®—æ»šåŠ¨å‡å€¼å’Œæ ‡å‡†å·®
    rolling_mean = prices.rolling(window=window).mean()
    rolling_std = prices.rolling(window=window).std()
    # è®¡ç®—Zåˆ†æ•°
    z_score = (prices - rolling_mean) / rolling_std
    # ç”Ÿæˆäº¤æ˜“ä¿¡å·
    signals = pd.Series(0, index=prices.index)
    signals[z_score > z_threshold] = -1  # å–å‡ºä¿¡å·
    signals[z_score < -z_threshold] = 1   # ä¹°å…¥ä¿¡å·
    signals[abs(z_score) < 0.5] = 0       # å¹³ä»“ä¿¡å·
    return signals
# ç¤ºä¾‹ä½¿ç”¨
prices = pd.Series(np.random.normal(0, 1, 100).cumsum() + 100)
signals = mean_reversion_strategy(prices)
print(signals.tail())</code></pre>
            <h3>2. åŠ¨é‡ç­–ç•¥</h3>
            <pre><code class="language-python">def momentum_strategy(prices, lookback=30, hold_period=5):
    """
    ç®€å•åŠ¨é‡ç­–ç•¥
    åŸºäºè¿‡å»è¡¨ç°ä¹°å…¥è¡¨ç°æœ€å¥½çš„èµ„äº§
    """
    # è®¡ç®—è¿‡å»lookbackå¤©çš„æ”¶ç›Šç‡
    returns = prices.pct_change(lookback)
    # ç”Ÿæˆäº¤æ˜“ä¿¡å·
    signals = pd.Series(0, index=prices.index)
    signals[returns > 0] = 1   # æ­£å‘åŠ¨é‡ä¹°å…¥
    signals[returns <= 0] = -1  # è´Ÿå‘åŠ¨é‡å–å‡º
    # ä¿æŒæŒä»“hold_periodå¤©
    signals = signals.rolling(hold_period).mean()
    return signals
# ç¤ºä¾‹ä½¿ç”¨
mom_signals = momentum_strategy(prices)
print(mom_signals.tail())</code></pre>
        </section>
        <section class="lesson-content">
            <h2>ç­–ç•¥è®¾è®¡åŸåˆ™</h2>
            <p>ä¼˜ç§€çš„äº¤æ˜“ç­–ç•¥éœ€è¦éµå¾ªä¸€å®šçš„è®¾è®¡åŸåˆ™å’Œè¯„ä¼°æ ‡å‡†ã€‚</p>
            <h3>1. ç­–ç•¥è®¾è®¡æ£€æŸ¥æ¸…å•</h3>
            <pre><code class="language-python">checklist = {
    'ç†è®ºåŸºç¡€': 'ç­–ç•¥æ˜¯å¦æœ‰åˆç†çš„å¸‚åœºè¡Œä¸ºè§£é‡Š',
    'å‚æ•°æ•æ„Ÿæ€§': 'ç­–ç•¥è¡¨ç°æ˜¯å¦å¯¹å‚æ•°é€‰æ‹©è¿‡äºæ•æ„Ÿ',
    'äº¤æ˜“æˆæœ¬': 'æ˜¯å¦è€ƒè™‘äº†ä½£é‡‘ã€æ»‘ç‚¹ç­‰äº¤æ˜“æˆæœ¬',
    'é£é™©ç®¡ç†': 'æ˜¯å¦æœ‰æ˜ç¡®çš„é£é™©æ§åˆ¶æœºåˆ¶',
    'æ ·æœ¬å¤–æµ‹è¯•': 'ç­–ç•¥åœ¨æœªå‚ä¸è®­ç»ƒçš„æ•°æ®ä¸Šè¡¨ç°å¦‚ä½•'
}</code></pre>
            <h3>2. ç­–ç•¥è¯„ä¼°æŒ‡æ ‡</h3>
            <pre><code class="language-python">def evaluate_strategy(signals, prices):
    """
    è¯„ä¼°ç­–ç•¥è¡¨ç°çš„åŸºæœ¬æŒ‡æ ‡
    """
    # è®¡ç®—æ¯æ—¥æ”¶ç›Šç‡
    daily_returns = prices.pct_change()
    strategy_returns = signals.shift(1) * daily_returns
    # è®¡ç®—è¡¨ç°æŒ‡æ ‡
    total_return = strategy_returns.sum()
    sharpe_ratio = strategy_returns.mean() / strategy_returns.std() * np.sqrt(252)
    max_drawdown = (strategy_returns.cumsum().cummax() - strategy_returns.cumsum()).max()
    return {
        'æ€»æ”¶ç›Šç‡': total_return,
        'å¹´åŒ–å¤æ™®æ¯”ç‡': sharpe_ratio,
        'æœ€å¤§å›æ’¤': max_drawdown
    }
# è¯„ä¼°å‡å€¼å›å½’ç­–ç•¥
performance = evaluate_strategy(signals, prices)
print(performance)</code></pre>
            
            <div class="strategy-demo">
                <h4>ğŸ“Š æŠ€æœ¯æŒ‡æ ‡å®æ—¶è®¡ç®—</h4>
                <p>å®æ—¶è®¡ç®—å’Œå¯è§†åŒ–å„ç§æŠ€æœ¯æŒ‡æ ‡ï¼Œç†è§£æŒ‡æ ‡çš„è®¡ç®—åŸç†å’Œäº¤æ˜“ä¿¡å·</p>
                
                <div class="indicator-tabs">
                    <button class="tab-button active" onclick="switchIndicator('ma')">ç§»åŠ¨å¹³å‡çº¿</button>
                    <button class="tab-button" onclick="switchIndicator('rsi')">RSI</button>
                    <button class="tab-button" onclick="switchIndicator('macd')">MACD</button>
                    <button class="tab-button" onclick="switchIndicator('bollinger')">å¸ƒæ—å¸¦</button>
                </div>
                
                <div class="demo-controls">
                    <div class="control-group">
                        <label>æ•°æ®å‘¨æœŸï¼ˆå¤©ï¼‰</label>
                        <input type="range" id="dataPeriod" min="50" max="500" value="252" oninput="updateIndicators()">
                        <input type="number" id="dataPeriodNum" min="50" max="500" value="252" onchange="updateIndicators()">
                    </div>
                    <div class="control-group">
                        <label>æ³¢åŠ¨ç‡ (%)</label>
                        <input type="range" id="priceVolatility" min="10" max="50" value="25" oninput="updateIndicators()">
                        <input type="number" id="priceVolatilityNum" min="10" max="50" value="25" onchange="updateIndicators()">
                    </div>
                    <div class="control-group">
                        <label>è¶‹åŠ¿å¼ºåº¦</label>
                        <input type="range" id="trendStrength" min="0" max="100" value="30" oninput="updateIndicators()">
                        <input type="number" id="trendStrengthNum" min="0" max="100" value="30" onchange="updateIndicators()">
                    </div>
                    <div class="control-group">
                        <button class="demo-button" onclick="generateNewPriceData()">ç”Ÿæˆæ–°æ•°æ®</button>
                        <button class="demo-button" onclick="toggleTrend()">åˆ‡æ¢è¶‹åŠ¿</button>
                    </div>
                </div>
                
                <div class="strategy-chart">
                    <div id="indicatorChart"></div>
                </div>
                
                <div class="metrics-display">
                    <div class="metric-card">
                        <div class="metric-value" id="currentPrice">--</div>
                        <div class="metric-label">å½“å‰ä»·æ ¼</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="currentSignal">--</div>
                        <div class="metric-label">äº¤æ˜“ä¿¡å·</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="indicatorValue">--</div>
                        <div class="metric-label" id="indicatorLabel">æŒ‡æ ‡å€¼</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="signalStrength">--</div>
                        <div class="metric-label">ä¿¡å·å¼ºåº¦</div>
                    </div>
                </div>
            </div>
            
            <div class="strategy-demo">
                <h4>ğŸ¯ ç­–ç•¥å›æµ‹ç³»ç»Ÿ</h4>
                <p>å›æµ‹ä¸åŒäº¤æ˜“ç­–ç•¥çš„è¡¨ç°ï¼Œæ¯”è¾ƒç­–ç•¥æ”¶ç›Šå’Œé£é™©æŒ‡æ ‡</p>
                
                <div class="demo-controls">
                    <div class="control-group">
                        <label>ç­–ç•¥ç±»å‹</label>
                        <select id="strategyType" onchange="runBacktest()">
                            <option value="ma_crossover">åŒå‡çº¿ç­–ç•¥</option>
                            <option value="rsi_reversal">RSIåè½¬ç­–ç•¥</option>
                            <option value="macd_momentum">MACDåŠ¨é‡ç­–ç•¥</option>
                            <option value="bollinger_mean">å¸ƒæ—å¸¦å‡å€¼å›å½’</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>å›æµ‹æœŸé—´ï¼ˆå¤©ï¼‰</label>
                        <input type="range" id="backtestPeriod" min="100" max="1000" value="500" oninput="runBacktest()">
                        <input type="number" id="backtestPeriodNum" min="100" max="1000" value="500" onchange="runBacktest()">
                    </div>
                    <div class="control-group">
                        <label>äº¤æ˜“æˆæœ¬ (%)</label>
                        <input type="range" id="tradingCost" min="0" max="50" value="10" step="5" oninput="runBacktest()">
                        <input type="number" id="tradingCostNum" min="0" max="50" value="10" step="5" onchange="runBacktest()">
                    </div>
                    <div class="control-group">
                        <button class="demo-button" onclick="runBacktest()">è¿è¡Œå›æµ‹</button>
                        <button class="demo-button" onclick="resetBacktest()">é‡ç½®</button>
                    </div>
                </div>
                
                <div class="strategy-chart">
                    <div id="backtestChart"></div>
                </div>
                
                <div class="metrics-display">
                    <div class="metric-card">
                        <div class="metric-value" id="totalReturn">--</div>
                        <div class="metric-label">æ€»æ”¶ç›Šç‡ (%)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="sharpeRatio">--</div>
                        <div class="metric-label">å¤æ™®æ¯”ç‡</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="maxDrawdown">--</div>
                        <div class="metric-label">æœ€å¤§å›æ’¤ (%)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="winRate">--</div>
                        <div class="metric-label">èƒœç‡ (%)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="totalTrades">--</div>
                        <div class="metric-label">äº¤æ˜“æ¬¡æ•°</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="calmarRatio">--</div>
                        <div class="metric-label">å¡å°”é©¬æ¯”ç‡</div>
                    </div>
                </div>
            </div>
        </section>
        <div class="lesson-navigation">
            <a href="../../index.html" class="btn">Â« è¿”å›æ¨¡å—é¦–é¡µ</a>
            <a href="lesson2.html" class="btn">ä¸‹ä¸€è¯¾: æŠ€æœ¯æŒ‡æ ‡ä¸ç­–ç•¥è®¾è®¡ Â»</a>
        </div>
    </main>
    <footer>
        <div class="container">
            <p>Â© 2023 Pythoné‡‘èç¼–ç¨‹è¯¾ç¨‹. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
        </div>
    </footer>
</body>
</html>