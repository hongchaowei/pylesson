<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬1è¯¾: æœŸæƒå®šä»·ä¸å¸Œè…Šå­—æ¯ - Pythoné‡‘èç¼–ç¨‹è¯¾ç¨‹</title>
    <link rel="stylesheet" href="../../css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
<div id="navigation-container"></div>
<script>
// åŠ¨æ€åŠ è½½å¯¼èˆªæ¡
function loadNavigation() {
    fetch('../../nav.html')
        .then(response => response.text())
        .then(html => {
            // æ›´æ–°å¯¼èˆªä¸­çš„é“¾æ¥è·¯å¾„
            let updatedHtml = html;
            
            // å¤„ç†æ ¹ç›®å½•æ–‡ä»¶é“¾æ¥ï¼ˆindex.html, syllabus.htmlç­‰ï¼‰
            updatedHtml = updatedHtml.replace(/href="index\.html"/g, 'href="../../index.html"');
            updatedHtml = updatedHtml.replace(/href="\.\/([^/]*\.html)"/g, 'href="../../$1"');
            
            // å¤„ç†æ¨¡å—è·¯å¾„é“¾æ¥ï¼ˆå·²ç»æ˜¯å®Œæ•´ç›¸å¯¹è·¯å¾„ï¼Œåªéœ€è¦æ·»åŠ æ ¹è·¯å¾„å‰ç¼€ï¼‰
            updatedHtml = updatedHtml.replace(/href="\.\/part([^"]*)"/g, 'href="../../part$1"');
            
            document.getElementById('navigation-container').innerHTML = updatedHtml;
            
            // æ·»åŠ ç§»åŠ¨ç«¯èœå•åˆ‡æ¢åŠŸèƒ½
            const menuToggle = document.getElementById('menuToggle');
            const navMenu = document.querySelector('.nav-menu');
            if (menuToggle && navMenu) {
                menuToggle.addEventListener('click', function() {
                    navMenu.classList.toggle('active');
                });
            }
        })
        .catch(error => console.error('å¯¼èˆªåŠ è½½å¤±è´¥:', error));
}

// é¡µé¢åŠ è½½å®ŒæˆååŠ è½½å¯¼èˆª
document.addEventListener('DOMContentLoaded', loadNavigation);
</script>

<main class="container">
    
        <section class="theory-section">
            <h2>ğŸ“š æ•°å­¦ç†è®ºåŸºç¡€</h2>
            <div class="theory-content">
                <h3>1. Black-Scholesåå¾®åˆ†æ–¹ç¨‹</h3>
                <div class="math-formula">
                    <p><strong>Black-Scholes PDEï¼š</strong></p>
                    <p>\[ \frac{\partial V}{\partial t} + \frac{1}{2}\sigma^2 S^2 \frac{\partial^2 V}{\partial S^2} + rS\frac{\partial V}{\partial S} - rV = 0 \]</p>
                    <p>å…¶ä¸­ \(V(S,t)\) æ˜¯æœŸæƒä»·å€¼ï¼Œ\(S\) æ˜¯æ ‡çš„èµ„äº§ä»·æ ¼ï¼Œ\(t\) æ˜¯æ—¶é—´ï¼Œ\(\sigma\) æ˜¯æ³¢åŠ¨ç‡ï¼Œ\(r\) æ˜¯æ— é£é™©åˆ©ç‡ã€‚</p>
                </div>
                <h3>2. Black-Scholesåå¾®åˆ†æ–¹ç¨‹æ¨å¯¼</h3>
                <div class="concept-explanation">
                    <h4>ğŸ’¡ Black-Scholesæ–¹ç¨‹çš„ç»æµç›´è§‰</h4>
                    <p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong>åœ¨æ— å¥—åˆ©çš„å¸‚åœºä¸­ï¼ŒæœŸæƒä»·æ ¼çš„å˜åŒ–å¿…é¡»ä¸å…¶å¯¹å†²ç»„åˆçš„ä»·å€¼å˜åŒ–ç›¸åŒ¹é…ã€‚</p>
                    <p><strong>ç‰©ç†ç±»æ¯”ï¼š</strong>å°±åƒçƒ­ä¼ å¯¼æ–¹ç¨‹æè¿°æ¸©åº¦åœ¨ç©ºé—´å’Œæ—¶é—´ä¸­çš„æ‰©æ•£ï¼ŒBSæ–¹ç¨‹æè¿°æœŸæƒä»·å€¼åœ¨ä»·æ ¼å’Œæ—¶é—´ç»´åº¦çš„æ¼”åŒ–ã€‚</p>
                    <p><strong>æ•°å­¦æœ¬è´¨ï¼š</strong>è¿™æ˜¯ä¸€ä¸ªæŠ›ç‰©å‹åå¾®åˆ†æ–¹ç¨‹ï¼Œä½“ç°äº†æœŸæƒä»·å€¼å¯¹æ ‡çš„ä»·æ ¼ã€æ—¶é—´å’Œæ³¢åŠ¨ç‡çš„æ•æ„Ÿæ€§ã€‚</p>
                </div>
                <div class="calculation-example">
                    <h4>ğŸ“Š Black-Scholesæ–¹ç¨‹æ¨å¯¼</h4>
                    <p><strong>æ¨å¯¼æ€è·¯ï¼š</strong>æ„å»ºæ— é£é™©å¯¹å†²ç»„åˆï¼Œåˆ©ç”¨æ— å¥—åˆ©åŸç†</p>
                    
                    <p><strong>æ­¥éª¤1ï¼šæ„å»ºå¯¹å†²ç»„åˆ</strong></p>
                    <p>ç»„åˆ \(\Pi = V - \Delta S\)ï¼Œå…¶ä¸­ \(\Delta = \frac{\partial V}{\partial S}\)</p>
                    
                    <p><strong>æ­¥éª¤2ï¼šè®¡ç®—ç»„åˆä»·å€¼å˜åŒ–</strong></p>
                    <p>\(d\Pi = dV - \Delta dS\)</p>
                    <p>åˆ©ç”¨Itoå¼•ç†ï¼š\(dV = \frac{\partial V}{\partial t}dt + \frac{\partial V}{\partial S}dS + \frac{1}{2}\frac{\partial^2 V}{\partial S^2}(dS)^2\)</p>
                    <p>å…¶ä¸­ \(dS = rSdt + \sigma S dW\)ï¼Œ\((dS)^2 = \sigma^2 S^2 dt\)</p>
                    
                    <p><strong>æ­¥éª¤3ï¼šæ¶ˆé™¤éšæœºé¡¹</strong></p>
                    <p>é€‰æ‹© \(\Delta = \frac{\partial V}{\partial S}\) ä½¿éšæœºé¡¹ç›¸æ¶ˆï¼š</p>
                    <p>\(d\Pi = [\frac{\partial V}{\partial t} + \frac{1}{2}\sigma^2 S^2 \frac{\partial^2 V}{\partial S^2} - r\Delta S]dt\)</p>
                    
                    <p><strong>æ­¥éª¤4ï¼šæ— å¥—åˆ©æ¡ä»¶</strong></p>
                    <p>æ— é£é™©ç»„åˆå¿…é¡»è·å¾—æ— é£é™©æ”¶ç›Šï¼š\(d\Pi = r\Pi dt = r(V - \Delta S)dt\)</p>
                    <p>æ•´ç†å¾—åˆ°Black-Scholesæ–¹ç¨‹ã€‚</p>
                </div>
                <h3>3. å‡ ä½•å¸ƒæœ—è¿åŠ¨</h3>
                <div class="math-formula">
                    <p><strong>è‚¡ä»·åŠ¨æ€è¿‡ç¨‹ï¼š</strong></p>
                    <p>\[ dS = \mu S dt + \sigma S dW \]</p>
                    <p>å…¶ä¸­ \(\mu\) æ˜¯æ¼‚ç§»ç‡ï¼Œ\(dW\) æ˜¯ç»´çº³è¿‡ç¨‹çš„å¢é‡ã€‚</p>
                    <p><strong>è§£æè§£ï¼š</strong></p>
                    <p>\[ S_T = S_0 \exp\left[(\mu - \frac{\sigma^2}{2})T + \sigma W_T\right] \]</p>
                </div>
                <h3>4. Black-Scholeså…¬å¼</h3>
                <div class="concept-explanation">
                    <h4>ğŸ’¡ Black-Scholeså…¬å¼çš„ç»æµç›´è§‰</h4>
                    <p><strong>çœ‹æ¶¨æœŸæƒå…¬å¼è§£è¯»ï¼š</strong>\(C = S_0 N(d_1) - Ke^{-rT} N(d_2)\)</p>
                    <ul>
                        <li>\(S_0 N(d_1)\)ï¼šæŒæœ‰æ ‡çš„èµ„äº§çš„æœŸæœ›ä»·å€¼ï¼ˆè€ƒè™‘è¡Œæƒæ¦‚ç‡ï¼‰</li>
                        <li>\(Ke^{-rT} N(d_2)\)ï¼šæ”¯ä»˜è¡Œæƒä»·çš„æœŸæœ›ç°å€¼</li>
                        <li>\(N(d_1)\)ï¼šé£é™©ä¸­æ€§æµ‹åº¦ä¸‹çš„è¡Œæƒæ¦‚ç‡ï¼ˆDeltaï¼‰</li>
                        <li>\(N(d_2)\)ï¼šå®é™…æµ‹åº¦ä¸‹çš„è¡Œæƒæ¦‚ç‡</li>
                    </ul>
                    <p><strong>æ•°å­¦ç¾æ„Ÿï¼š</strong>è¿™ä¸ªå…¬å¼ä¼˜é›…åœ°å°†æ¦‚ç‡ã€æ—¶é—´ä»·å€¼å’Œé£é™©è°ƒæ•´èä¸ºä¸€ä½“ã€‚</p>
                </div>
                <div class="math-formula">
                    <p><strong>æ¬§å¼çœ‹æ¶¨æœŸæƒï¼š</strong></p>
                    <p>\[ C = S_0 N(d_1) - Ke^{-rT} N(d_2) \]</p>
                    <p><strong>æ¬§å¼çœ‹è·ŒæœŸæƒï¼š</strong></p>
                    <p>\[ P = Ke^{-rT} N(-d_2) - S_0 N(-d_1) \]</p>
                    <p>å…¶ä¸­ï¼š</p>
                    <p>\[ d_1 = \frac{\ln(S_0/K) + (r + \sigma^2/2)T}{\sigma\sqrt{T}} \]</p>
                    <p>\[ d_2 = d_1 - \sigma\sqrt{T} \]</p>
                    <p>\(N(\cdot)\) æ˜¯æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„ç´¯ç§¯åˆ†å¸ƒå‡½æ•°ã€‚</p>
                </div>
                <div class="formula-explanation">å…¬å¼å«ä¹‰ï¼šæœŸæƒä»·å€¼ = æŒæœ‰èµ„äº§çš„æœŸæœ›æ”¶ç›Š - æ”¯ä»˜è¡Œæƒä»·çš„æœŸæœ›æˆæœ¬</div>
                
                <div class="calculation-example">
                    <h4>ğŸ“Š Black-Scholeså…¬å¼æ¨å¯¼ä¸è®¡ç®—ç¤ºä¾‹</h4>
                    
                    <p><strong>æ¨å¯¼å…³é”®æ­¥éª¤ï¼š</strong></p>
                    <p>1. å‡è®¾è‚¡ä»·éµå¾ªå‡ ä½•å¸ƒæœ—è¿åŠ¨ï¼š\(dS = rSdt + \sigma SdW\)</p>
                    <p>2. æœŸæƒåˆ°æœŸæ”¶ç›Šï¼š\(C_T = \max(S_T - K, 0)\)</p>
                    <p>3. é£é™©ä¸­æ€§å®šä»·ï¼š\(C_0 = e^{-rT}E^Q[C_T]\)</p>
                    <p>4. è®¡ç®—æœŸæœ›ï¼š\(E^Q[\max(S_T - K, 0)]\)</p>
                    <p>5. åˆ©ç”¨\(S_T\)çš„å¯¹æ•°æ­£æ€åˆ†å¸ƒæ€§è´¨æ±‚è§£ç§¯åˆ†</p>
                    
                    <p><strong>å®é™…è®¡ç®—ç¤ºä¾‹ï¼š</strong></p>
                    <p>è®¡ç®—ä¸€ä¸ªæ¬§å¼çœ‹æ¶¨æœŸæƒçš„ä»·æ ¼ï¼Œå‚æ•°å¦‚ä¸‹ï¼š</p>
                    <ul>
                        <li>å½“å‰è‚¡ä»· \(S_0 = 100\)</li>
                        <li>è¡Œæƒä»· \(K = 105\)</li>
                        <li>åˆ°æœŸæ—¶é—´ \(T = 0.25\) å¹´ï¼ˆ3ä¸ªæœˆï¼‰</li>
                        <li>æ— é£é™©åˆ©ç‡ \(r = 5\% = 0.05\)</li>
                        <li>æ³¢åŠ¨ç‡ \(\sigma = 20\% = 0.20\)</li>
                    </ul>
                    
                    <p><strong>è®¡ç®—è¿‡ç¨‹ï¼š</strong></p>
                    <p>\(d_1 = \frac{\ln(100/105) + (0.05 + 0.20^2/2) \times 0.25}{0.20\sqrt{0.25}}\)</p>
                    <p>\(d_1 = \frac{-0.0488 + (0.05 + 0.02) \times 0.25}{0.20 \times 0.5}\)</p>
                    <p>\(d_1 = \frac{-0.0488 + 0.0175}{0.1} = \frac{-0.0313}{0.1} = -0.313\)</p>
                    
                    <p>\(d_2 = d_1 - \sigma\sqrt{T} = -0.313 - 0.20 \times 0.5 = -0.413\)</p>
                    
                    <p>æŸ¥æ ‡å‡†æ­£æ€åˆ†å¸ƒè¡¨ï¼š</p>
                    <p>\(N(d_1) = N(-0.313) = 0.3773\)</p>
                    <p>\(N(d_2) = N(-0.413) = 0.3398\)</p>
                    
                    <p>æœŸæƒä»·æ ¼ï¼š</p>
                    <p>\(C = 100 \times 0.3773 - 105 \times e^{-0.05 \times 0.25} \times 0.3398\)</p>
                    <p>\(C = 37.73 - 105 \times 0.9876 \times 0.3398\)</p>
                    <p>\(C = 37.73 - 35.24 = 2.49\)</p>
                    
                    <p><strong>ç»“è®ºï¼š</strong>è¯¥çœ‹æ¶¨æœŸæƒçš„ç†è®ºä»·æ ¼ä¸º2.49å…ƒã€‚</p>
                    
                    <p><strong>æ•æ„Ÿæ€§åˆ†æï¼š</strong></p>
                    <p>â€¢ å¦‚æœæ³¢åŠ¨ç‡å¢åŠ åˆ°30%ï¼ŒæœŸæƒä»·æ ¼ä¼šä¸Šå‡åˆ°çº¦4.1å…ƒ</p>
                    <p>â€¢ å¦‚æœè‚¡ä»·ä¸Šæ¶¨åˆ°110å…ƒï¼ŒæœŸæƒä»·æ ¼ä¼šä¸Šå‡åˆ°çº¦8.8å…ƒ</p>
                    <p>â€¢ å¦‚æœè·ç¦»åˆ°æœŸæ—¶é—´å»¶é•¿åˆ°6ä¸ªæœˆï¼ŒæœŸæƒä»·æ ¼ä¼šä¸Šå‡åˆ°çº¦5.2å…ƒ</p>
                </div>
                <h3>5. å¸Œè…Šå­—æ¯çš„æ•°å­¦å®šä¹‰</h3>
                <div class="math-formula">
                    <p><strong>Delta (Î”)ï¼š</strong></p>
                    <p>\[ \Delta = \frac{\partial V}{\partial S} \]</p>
                    <p>å¯¹äºçœ‹æ¶¨æœŸæƒï¼š\(\Delta_c = N(d_1)\)</p>
                    <p>å¯¹äºçœ‹è·ŒæœŸæƒï¼š\(\Delta_p = N(d_1) - 1\)</p>
                </div>
                <div class="math-formula">
                    <p><strong>Gamma (Î“)ï¼š</strong></p>
                    <p>\[ \Gamma = \frac{\partial^2 V}{\partial S^2} = \frac{\phi(d_1)}{S_0\sigma\sqrt{T}} \]</p>
                    <p>å…¶ä¸­ \(\phi(\cdot)\) æ˜¯æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦å‡½æ•°ã€‚</p>
                </div>
                <div class="math-formula">
                    <p><strong>Theta (Î˜)ï¼š</strong></p>
                    <p>\[ \Theta = -\frac{\partial V}{\partial t} \]</p>
                    <p>å¯¹äºçœ‹æ¶¨æœŸæƒï¼š</p>
                    <p>\[ \Theta_c = -\frac{S_0\phi(d_1)\sigma}{2\sqrt{T}} - rKe^{-rT}N(d_2) \]</p>
                </div>
                <div class="math-formula">
                    <p><strong>Vega (Î½)ï¼š</strong></p>
                    <p>\[ \nu = \frac{\partial V}{\partial \sigma} = S_0\phi(d_1)\sqrt{T} \]</p>
                </div>
                <div class="math-formula">
                    <p><strong>Rho (Ï)ï¼š</strong></p>
                    <p>\[ \rho = \frac{\partial V}{\partial r} \]</p>
                    <p>å¯¹äºçœ‹æ¶¨æœŸæƒï¼š\(\rho_c = KTe^{-rT}N(d_2)\)</p>
                    <p>å¯¹äºçœ‹è·ŒæœŸæƒï¼š\(\rho_p = -KTe^{-rT}N(-d_2)\)</p>
                </div>
            </div>
        </section>
        <section class="lesson-content">
            <h2>æœŸæƒåŸºç¡€çŸ¥è¯†</h2>
            <p>æœŸæƒæ˜¯ä¸€ç§é‡‘èè¡ç”Ÿå“ï¼Œå®ƒèµ‹äºˆæŒæœ‰è€…åœ¨ç‰¹å®šæ—¥æœŸæˆ–ä¹‹å‰ä»¥ç‰¹å®šä»·æ ¼ä¹°å…¥æˆ–å–å‡ºæ ‡çš„èµ„äº§çš„æƒåˆ©ã€‚</p>
            <h3>1. æœŸæƒåŸºæœ¬ç±»å‹</h3>
            <pre><code class="language-python">option_types = {
    'çœ‹æ¶¨æœŸæƒ': 'èµ‹äºˆæŒæœ‰è€…ä»¥æ‰§è¡Œä»·ä¹°å…¥æ ‡çš„èµ„äº§çš„æƒåˆ©',
    'çœ‹è·ŒæœŸæƒ': 'èµ‹äºˆæŒæœ‰è€…ä»¥æ‰§è¡Œä»·å–å‡ºæ ‡çš„èµ„äº§çš„æƒåˆ©',
    'æ¬§å¼æœŸæƒ': 'åªèƒ½åœ¨åˆ°æœŸæ—¥è¡Œæƒ',
    'ç¾å¼æœŸæƒ': 'å¯ä»¥åœ¨åˆ°æœŸæ—¥æˆ–ä¹‹å‰ä»»ä½•æ—¶é—´è¡Œæƒ'
}</code></pre>
            <h3>2. æœŸæƒå®šä»·å½±å“å› ç´ </h3>
            <pre><code class="language-python">option_pricing_factors = [
    'æ ‡çš„èµ„äº§ä»·æ ¼(S)',
    'æ‰§è¡Œä»·æ ¼(K)',
    'åˆ°æœŸæ—¶é—´(T)',
    'æ— é£é™©åˆ©ç‡(r)',
    'æ³¢åŠ¨ç‡(Ïƒ)',
    'è‚¡æ¯ç‡(q)'
]</code></pre>
        </section>
        <section class="lesson-content">
            <h2>Black-Scholesæ¨¡å‹</h2>
            <p>Black-Scholesæ¨¡å‹æ˜¯æœŸæƒå®šä»·çš„ç»å…¸æ–¹æ³•ï¼Œä¸ºæ¬§å¼æœŸæƒæä¾›äº†ç†è®ºä»·æ ¼ã€‚</p>
            <h3>1. æ¨¡å‹å…¬å¼</h3>
            <pre><code class="language-python">import math
from scipy.stats import norm
def black_scholes(S, K, T, r, sigma, option_type='call'):
    """
    Black-ScholesæœŸæƒå®šä»·æ¨¡å‹
    :param S: æ ‡çš„èµ„äº§ä»·æ ¼
    :param K: æ‰§è¡Œä»·æ ¼
    :param T: åˆ°æœŸæ—¶é—´(å¹´)
    :param r: æ— é£é™©åˆ©ç‡
    :param sigma: æ³¢åŠ¨ç‡
    :param option_type: æœŸæƒç±»å‹('call'æˆ–'put')
    :return: æœŸæƒä»·æ ¼
    """
    d1 = (math.log(S / K) + (r + 0.5 * sigma ** 2) * T) / (sigma * math.sqrt(T))
    d2 = d1 - sigma * math.sqrt(T)
    if option_type == 'call':
        price = S * norm.cdf(d1) - K * math.exp(-r * T) * norm.cdf(d2)
    else:
        price = K * math.exp(-r * T) * norm.cdf(-d2) - S * norm.cdf(-d1)
    return price
# ç¤ºä¾‹è®¡ç®—
call_price = black_scholes(100, 105, 0.5, 0.05, 0.2, 'call')
put_price = black_scholes(100, 105, 0.5, 0.05, 0.2, 'put')</code></pre>
            <h3>2. éšå«æ³¢åŠ¨ç‡è®¡ç®—</h3>
            <pre><code class="language-python">from scipy.optimize import brentq
def implied_volatility(S, K, T, r, option_price, option_type='call'):
    """
    è®¡ç®—éšå«æ³¢åŠ¨ç‡
    :param option_price: è§‚å¯Ÿåˆ°çš„æœŸæƒå¸‚åœºä»·æ ¼
    :return: éšå«æ³¢åŠ¨ç‡
    """
    def price_difference(sigma):
        return black_scholes(S, K, T, r, sigma, option_type) - option_price
    try:
        iv = brentq(price_difference, 0.001, 5.0)
        return iv
    except ValueError:
        return None
# ç¤ºä¾‹è®¡ç®—
iv = implied_volatility(100, 105, 0.5, 0.05, 8.0, 'call')</code></pre>
        </section>
        <section class="lesson-content">
            <h2>è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿ</h2>
            <p>è’™ç‰¹å¡æ´›æ–¹æ³•é€šè¿‡æ¨¡æ‹Ÿæ ‡çš„èµ„äº§ä»·æ ¼çš„éšæœºè·¯å¾„æ¥ä¼°è®¡æœŸæƒä»·æ ¼ã€‚</p>
            <h3>1. æ¬§å¼æœŸæƒå®šä»·</h3>
            <pre><code class="language-python">import numpy as np
def monte_carlo_option_price(S, K, T, r, sigma, option_type='call', n_simulations=100000):
    """
    è’™ç‰¹å¡æ´›æ¨¡æ‹ŸæœŸæƒå®šä»·
    :param n_simulations: æ¨¡æ‹Ÿæ¬¡æ•°
    :return: æœŸæƒä»·æ ¼
    """
    # ç”Ÿæˆéšæœºè·¯å¾„
    z = np.random.normal(0, 1, n_simulations)
    ST = S * np.exp((r - 0.5 * sigma**2) * T + sigma * np.sqrt(T) * z)
    # è®¡ç®—æ”¶ç›Š
    if option_type == 'call':
        payoff = np.maximum(ST - K, 0)
    else:
        payoff = np.maximum(K - ST, 0)
    # è´´ç°æ±‚å¹³å‡å€¼
    option_price = np.exp(-r * T) * np.mean(payoff)
    return option_price
# ç¤ºä¾‹è®¡ç®—
mc_price = monte_carlo_option_price(100, 105, 0.5, 0.05, 0.2, 'call')</code></pre>
            <h3>2. ç¾å¼æœŸæƒå®šä»·</h3>
            <pre><code class="language-python">def monte_carlo_american_option(S, K, T, r, sigma, option_type='call', n_simulations=10000, n_steps=100):
    """
    è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿç¾å¼æœŸæƒå®šä»·(æœ€å°äºŒä¹˜è’™ç‰¹å¡æ´›æ–¹æ³•)
    :return: æœŸæƒä»·æ ¼
    """
    dt = T / n_steps
    discount = np.exp(-r * dt)
    # ç”Ÿæˆä»·æ ¼è·¯å¾„
    paths = np.zeros((n_simulations, n_steps + 1))
    paths[:, 0] = S
    for t in range(1, n_steps + 1):
        z = np.random.normal(0, 1, n_simulations)
        paths[:, t] = paths[:, t-1] * np.exp((r - 0.5 * sigma**2) * dt + sigma * np.sqrt(dt) * z)
    # é€†å‘è®¡ç®—
    payoff = np.zeros_like(paths)
    if option_type == 'call':
        payoff = np.maximum(paths - K, 0)
    else:
        payoff = np.maximum(K - paths, 0)
    value = payoff[:, -1]
    for t in range(n_steps - 1, 0, -1):
        # å›å½’åˆ†æ
        regression = np.polyfit(paths[:, t], value * discount, 5)
        continuation_value = np.polyval(regression, paths[:, t])
        # æ¯”è¾ƒç«‹å³è¡Œæƒä»·å€¼ä¸ç»§ç»­æŒæœ‰ä»·å€¼
        value = np.where(
            payoff[:, t] > continuation_value,
            payoff[:, t],
            value * discount
        )
    option_price = np.mean(value) * discount
    return option_price
# ç¤ºä¾‹è®¡ç®—
american_price = monte_carlo_american_option(100, 105, 0.5, 0.05, 0.2, 'put')</code></pre>
        </section>
        <section class="lesson-content">
            <h2>æœŸæƒå¸Œè…Šå­—æ¯</h2>
            <p>å¸Œè…Šå­—æ¯è¡¡é‡æœŸæƒä»·æ ¼å¯¹å„ç§å› ç´ çš„æ•æ„Ÿåº¦ï¼Œæ˜¯é£é™©ç®¡ç†çš„é‡è¦å·¥å…·ã€‚</p>
            <h3>1. ä¸»è¦å¸Œè…Šå­—æ¯è®¡ç®—</h3>
            <pre><code class="language-python">def black_scholes_greeks(S, K, T, r, sigma, option_type='call'):
    """
    è®¡ç®—Black-Scholeså¸Œè…Šå­—æ¯
    :return: delta, gamma, theta, vega, rho
    """
    d1 = (math.log(S / K) + (r + 0.5 * sigma ** 2) * T) / (sigma * math.sqrt(T))
    d2 = d1 - sigma * math.sqrt(T)
    # Delta
    if option_type == 'call':
        delta = norm.cdf(d1)
    else:
        delta = norm.cdf(d1) - 1
    # Gamma
    gamma = norm.pdf(d1) / (S * sigma * math.sqrt(T))
    # Theta
    if option_type == 'call':
        theta = - (S * norm.pdf(d1) * sigma) / (2 * math.sqrt(T)) - r * K * math.exp(-r * T) * norm.cdf(d2)
    else:
        theta = - (S * norm.pdf(d1) * sigma) / (2 * math.sqrt(T)) + r * K * math.exp(-r * T) * norm.cdf(-d2)
    theta = theta / 365  # è½¬æ¢ä¸ºæ¯æ—¥theta
    # Vega
    vega = S * math.sqrt(T) * norm.pdf(d1)
    vega = vega / 100  # è¡¨ç¤ºæ³¢åŠ¨ç‡å˜åŒ–1%çš„å½±å“
    # Rho
    if option_type == 'call':
        rho = K * T * math.exp(-r * T) * norm.cdf(d2)
    else:
        rho = -K * T * math.exp(-r * T) * norm.cdf(-d2)
    rho = rho / 100  # è¡¨ç¤ºåˆ©ç‡å˜åŒ–1%çš„å½±å“
    return delta, gamma, theta, vega, rho
# ç¤ºä¾‹è®¡ç®—
greeks = black_scholes_greeks(100, 105, 0.5, 0.05, 0.2, 'call')</code></pre>
            <h3>2. å¸Œè…Šå­—æ¯å¯è§†åŒ–</h3>
            <pre><code class="language-python">import matplotlib.pyplot as plt
def plot_option_greeks(S_range, K, T, r, sigma, option_type='call'):
    """ç»˜åˆ¶å¸Œè…Šå­—æ¯éšæ ‡çš„èµ„äº§ä»·æ ¼å˜åŒ–çš„æ›²çº¿"""
    deltas, gammas, thetas, vegas, rhos = [], [], [], [], []
    for S in S_range:
        greek = black_scholes_greeks(S, K, T, r, sigma, option_type)
        deltas.append(greek[0])
        gammas.append(greek[1])
        thetas.append(greek[2])
        vegas.append(greek[3])
        rhos.append(greek[4])
    plt.figure(figsize=(12, 8))
    plt.subplot(2, 3, 1)
    plt.plot(S_range, deltas)
    plt.title('Delta')
    plt.subplot(2, 3, 2)
    plt.plot(S_range, gammas)
    plt.title('Gamma')
    plt.subplot(2, 3, 3)
    plt.plot(S_range, thetas)
    plt.title('Theta')
    plt.subplot(2, 3, 4)
    plt.plot(S_range, vegas)
    plt.title('Vega')
    plt.subplot(2, 3, 5)
    plt.plot(S_range, rhos)
    plt.title('Rho')
    plt.tight_layout()
    plt.show()
# ç¤ºä¾‹å¯è§†åŒ–
S_range = np.linspace(50, 150, 100)
plot_option_greeks(S_range, 105, 0.5, 0.05, 0.2, 'call')</code></pre>

    <script>
    // æœŸæƒå®šä»·æ¼”ç¤ºç›¸å…³å˜é‡
    let currentChartType = 'payoff';
    let optionParams = {
        S: 100,    // æ ‡çš„ä»·æ ¼
        K: 100,    // æ‰§è¡Œä»·æ ¼
        T: 0.25,   // åˆ°æœŸæ—¶é—´
        r: 0.05,   // æ— é£é™©åˆ©ç‡
        sigma: 0.2, // æ³¢åŠ¨ç‡
        type: 'call' // æœŸæƒç±»å‹
    };
    
    // æ ‡å‡†æ­£æ€åˆ†å¸ƒç´¯ç§¯åˆ†å¸ƒå‡½æ•°
    function normalCDF(x) {
        return 0.5 * (1 + erf(x / Math.sqrt(2)));
    }
    
    // è¯¯å·®å‡½æ•°è¿‘ä¼¼
    function erf(x) {
        const a1 =  0.254829592;
        const a2 = -0.284496736;
        const a3 =  1.421413741;
        const a4 = -1.453152027;
        const a5 =  1.061405429;
        const p  =  0.3275911;
        
        const sign = x < 0 ? -1 : 1;
        x = Math.abs(x);
        
        const t = 1.0 / (1.0 + p * x);
        const y = 1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);
        
        return sign * y;
    }
    
    // æ ‡å‡†æ­£æ€åˆ†å¸ƒæ¦‚ç‡å¯†åº¦å‡½æ•°
    function normalPDF(x) {
        return Math.exp(-0.5 * x * x) / Math.sqrt(2 * Math.PI);
    }
    
    // Black-ScholesæœŸæƒå®šä»·å…¬å¼
    function blackScholesPrice(S, K, T, r, sigma, type) {
        if (T <= 0) {
            // åˆ°æœŸæ—¶çš„å†…åœ¨ä»·å€¼
            if (type === 'call') {
                return Math.max(S - K, 0);
            } else {
                return Math.max(K - S, 0);
            }
        }
        
        const d1 = (Math.log(S / K) + (r + 0.5 * sigma * sigma) * T) / (sigma * Math.sqrt(T));
        const d2 = d1 - sigma * Math.sqrt(T);
        
        if (type === 'call') {
            return S * normalCDF(d1) - K * Math.exp(-r * T) * normalCDF(d2);
        } else {
            return K * Math.exp(-r * T) * normalCDF(-d2) - S * normalCDF(-d1);
        }
    }
    
    // è®¡ç®—å¸Œè…Šå­—æ¯
    function calculateGreeks(S, K, T, r, sigma, type) {
        if (T <= 0) {
            return { delta: 0, gamma: 0, theta: 0, vega: 0, rho: 0 };
        }
        
        const d1 = (Math.log(S / K) + (r + 0.5 * sigma * sigma) * T) / (sigma * Math.sqrt(T));
        const d2 = d1 - sigma * Math.sqrt(T);
        
        let delta, gamma, theta, vega, rho;
        
        if (type === 'call') {
            delta = normalCDF(d1);
            theta = -(S * normalPDF(d1) * sigma) / (2 * Math.sqrt(T)) - r * K * Math.exp(-r * T) * normalCDF(d2);
            rho = K * T * Math.exp(-r * T) * normalCDF(d2);
        } else {
            delta = normalCDF(d1) - 1;
            theta = -(S * normalPDF(d1) * sigma) / (2 * Math.sqrt(T)) + r * K * Math.exp(-r * T) * normalCDF(-d2);
            rho = -K * T * Math.exp(-r * T) * normalCDF(-d2);
        }
        
        gamma = normalPDF(d1) / (S * sigma * Math.sqrt(T));
        vega = S * normalPDF(d1) * Math.sqrt(T);
        
        // è½¬æ¢å•ä½
        theta = theta / 365; // æ¯æ—¥æ—¶é—´è¡°å‡
        vega = vega / 100;   // æ³¢åŠ¨ç‡å˜åŒ–1%çš„å½±å“
        rho = rho / 100;     // åˆ©ç‡å˜åŒ–1%çš„å½±å“
        
        return { delta, gamma, theta, vega, rho };
    }
    
    // è®¡ç®—å†…åœ¨ä»·å€¼
    function calculateIntrinsicValue(S, K, type) {
        if (type === 'call') {
            return Math.max(S - K, 0);
        } else {
            return Math.max(K - S, 0);
        }
    }
    
    // æ›´æ–°å‚æ•°æ˜¾ç¤º
    function updateParameterDisplay() {
        document.getElementById('stockPriceValue').textContent = optionParams.S;
        document.getElementById('strikePriceValue').textContent = optionParams.K;
        document.getElementById('timeToExpiryValue').textContent = optionParams.T;
        document.getElementById('riskFreeRateValue').textContent = optionParams.r * 100;
        document.getElementById('volatilityValue').textContent = optionParams.sigma * 100;
        
        // åŒæ­¥æ»‘å—å’Œæ•°å­—è¾“å…¥æ¡†
        document.getElementById('stockPrice').value = optionParams.S;
        document.getElementById('stockPriceNum').value = optionParams.S;
        document.getElementById('strikePrice').value = optionParams.K;
        document.getElementById('strikePriceNum').value = optionParams.K;
        document.getElementById('timeToExpiry').value = optionParams.T;
        document.getElementById('timeToExpiryNum').value = optionParams.T;
        document.getElementById('riskFreeRate').value = optionParams.r * 100;
        document.getElementById('riskFreeRateNum').value = optionParams.r * 100;
        document.getElementById('volatility').value = optionParams.sigma * 100;
        document.getElementById('volatilityNum').value = optionParams.sigma * 100;
        document.getElementById('optionType').value = optionParams.type;
    }
    
    // æ›´æ–°æœŸæƒå®šä»·è®¡ç®—
    function updateOptionPricing() {
        // è·å–å‚æ•°
        optionParams.S = +document.getElementById('stockPrice').value;
        optionParams.K = +document.getElementById('strikePrice').value;
        optionParams.T = +document.getElementById('timeToExpiry').value;
        optionParams.r = +document.getElementById('riskFreeRate').value / 100;
        optionParams.sigma = +document.getElementById('volatility').value / 100;
        optionParams.type = document.getElementById('optionType').value;
        
        // æ›´æ–°æ˜¾ç¤º
        updateParameterDisplay();
        
        // è®¡ç®—æœŸæƒä»·æ ¼
        const optionPrice = blackScholesPrice(optionParams.S, optionParams.K, optionParams.T, optionParams.r, optionParams.sigma, optionParams.type);
        const intrinsicValue = calculateIntrinsicValue(optionParams.S, optionParams.K, optionParams.type);
        const timeValue = optionPrice - intrinsicValue;
        
        // è®¡ç®—å¸Œè…Šå­—æ¯
        const greeks = calculateGreeks(optionParams.S, optionParams.K, optionParams.T, optionParams.r, optionParams.sigma, optionParams.type);
        
        // æ›´æ–°æ˜¾ç¤º
        document.getElementById('optionPrice').textContent = optionPrice.toFixed(4);
        document.getElementById('intrinsicValue').textContent = intrinsicValue.toFixed(4);
        document.getElementById('timeValue').textContent = timeValue.toFixed(4);
        
        document.getElementById('deltaValue').textContent = greeks.delta.toFixed(4);
        document.getElementById('gammaValue').textContent = greeks.gamma.toFixed(6);
        document.getElementById('thetaValue').textContent = greeks.theta.toFixed(4);
        document.getElementById('vegaValue').textContent = greeks.vega.toFixed(4);
        document.getElementById('rhoValue').textContent = greeks.rho.toFixed(4);
        
        // æ›´æ–°å›¾è¡¨
        drawChart();
    }
    
    // é‡ç½®å‚æ•°
    function resetParameters() {
        optionParams = {
            S: 100,
            K: 100,
            T: 0.25,
            r: 0.05,
            sigma: 0.2,
            type: 'call'
        };
        updateParameterDisplay();
        updateOptionPricing();
    }
    
    // åˆ‡æ¢å›¾è¡¨ç±»å‹
    function switchChart() {
        currentChartType = document.getElementById('chartType').value;
        drawChart();
    }
    
    // ç»˜åˆ¶å›¾è¡¨
    function drawChart() {
        const container = d3.select('#optionChart');
        container.selectAll('*').remove();
        
        switch(currentChartType) {
            case 'payoff':
                drawPayoffDiagram();
                break;
            case 'price_surface':
                drawPriceSurface();
                break;
            case 'greeks':
                drawGreeksChart();
                break;
            case 'sensitivity':
                drawSensitivityAnalysis();
                break;
        }
    }
    
    // ç»˜åˆ¶æŸç›Šå›¾
    function drawPayoffDiagram() {
        const container = d3.select('#optionChart');
        const margin = {top: 20, right: 30, bottom: 40, left: 50};
        const width = 800 - margin.left - margin.right;
        const height = 400 - margin.bottom - margin.top;
        
        const svg = container.append('svg')
            .attr('width', width + margin.left + margin.right)
            .attr('height', height + margin.bottom + margin.top);
            
        const g = svg.append('g')
            .attr('transform', `translate(${margin.left},${margin.top})`);
        
        // ç”Ÿæˆè‚¡ä»·èŒƒå›´
        const stockPrices = d3.range(optionParams.K * 0.5, optionParams.K * 1.5, 1);
        
        // è®¡ç®—æœŸæƒä»·æ ¼å’ŒæŸç›Š
        const optionPrices = stockPrices.map(S => {
            const price = blackScholesPrice(S, optionParams.K, optionParams.T, optionParams.r, optionParams.sigma, optionParams.type);
            const intrinsic = calculateIntrinsicValue(S, optionParams.K, optionParams.type);
            return { S, price, intrinsic };
        });
        
        const x = d3.scaleLinear()
            .domain(d3.extent(stockPrices))
            .range([0, width]);
        
        const y = d3.scaleLinear()
            .domain([0, d3.max(optionPrices, d => Math.max(d.price, d.intrinsic))])
            .range([height, 0]);
        
        const line = d3.line()
            .x(d => x(d.S))
            .y(d => y(d.price));
            
        const intrinsicLine = d3.line()
            .x(d => x(d.S))
            .y(d => y(d.intrinsic));
        
        // ç»˜åˆ¶æœŸæƒä»·æ ¼çº¿
        g.append('path')
            .datum(optionPrices)
            .attr('fill', 'none')
            .attr('stroke', '#3498db')
            .attr('stroke-width', 3)
            .attr('d', line);
        
        // ç»˜åˆ¶å†…åœ¨ä»·å€¼çº¿
        g.append('path')
            .datum(optionPrices)
            .attr('fill', 'none')
            .attr('stroke', '#e74c3c')
            .attr('stroke-width', 2)
            .attr('stroke-dasharray', '5,5')
            .attr('d', intrinsicLine);
        
        // æ ‡è®°å½“å‰è‚¡ä»·
        g.append('line')
            .attr('x1', x(optionParams.S))
            .attr('x2', x(optionParams.S))
            .attr('y1', 0)
            .attr('y2', height)
            .attr('stroke', '#f39c12')
            .attr('stroke-width', 2)
            .attr('stroke-dasharray', '3,3');
        
        // æ·»åŠ åæ ‡è½´
        g.append('g')
            .attr('transform', `translate(0,${height})`)
            .call(d3.axisBottom(x))
            .append('text')
            .attr('x', width / 2)
            .attr('y', 35)
            .attr('fill', 'black')
            .style('text-anchor', 'middle')
            .text('æ ‡çš„ä»·æ ¼');
            
        g.append('g')
            .call(d3.axisLeft(y))
            .append('text')
            .attr('transform', 'rotate(-90)')
            .attr('y', -35)
            .attr('x', -height / 2)
            .attr('fill', 'black')
            .style('text-anchor', 'middle')
            .text('æœŸæƒä»·æ ¼');
        
        // æ·»åŠ å›¾ä¾‹
        const legend = g.append('g')
            .attr('transform', `translate(${width - 150}, 20)`);
            
        legend.append('line')
            .attr('x1', 0).attr('x2', 20)
            .attr('y1', 0).attr('y2', 0)
            .attr('stroke', '#3498db')
            .attr('stroke-width', 3);
            
        legend.append('text')
            .attr('x', 25).attr('y', 5)
            .text('æœŸæƒä»·æ ¼');
            
        legend.append('line')
            .attr('x1', 0).attr('x2', 20)
            .attr('y1', 20).attr('y2', 20)
            .attr('stroke', '#e74c3c')
            .attr('stroke-width', 2)
            .attr('stroke-dasharray', '5,5');
            
        legend.append('text')
            .attr('x', 25).attr('y', 25)
            .text('å†…åœ¨ä»·å€¼');
    }
    
    // ç»˜åˆ¶ä»·æ ¼æ›²é¢ï¼ˆç®€åŒ–ä¸º2Dçƒ­åŠ›å›¾ï¼‰
    function drawPriceSurface() {
        const container = d3.select('#optionChart');
        const margin = {top: 20, right: 100, bottom: 40, left: 50};
        const width = 800 - margin.left - margin.right;
        const height = 400 - margin.bottom - margin.top;
        
        const svg = container.append('svg')
            .attr('width', width + margin.left + margin.right)
            .attr('height', height + margin.bottom + margin.top);
            
        const g = svg.append('g')
            .attr('transform', `translate(${margin.left},${margin.top})`);
        
        // ç”Ÿæˆæ•°æ®ç½‘æ ¼
        const stockPrices = d3.range(optionParams.K * 0.7, optionParams.K * 1.3, 2);
        const timeValues = d3.range(0.01, 1, 0.02);
        
        const data = [];
        stockPrices.forEach(S => {
            timeValues.forEach(T => {
                const price = blackScholesPrice(S, optionParams.K, T, optionParams.r, optionParams.sigma, optionParams.type);
                data.push({ S, T, price });
            });
        });
        
        const x = d3.scaleLinear()
            .domain(d3.extent(stockPrices))
            .range([0, width]);
        
        const y = d3.scaleLinear()
            .domain(d3.extent(timeValues))
            .range([height, 0]);
        
        const colorScale = d3.scaleSequential(d3.interpolateViridis)
            .domain(d3.extent(data, d => d.price));
        
        const cellWidth = width / stockPrices.length;
        const cellHeight = height / timeValues.length;
        
        // ç»˜åˆ¶çƒ­åŠ›å›¾
        g.selectAll('.cell')
            .data(data)
            .enter().append('rect')
            .attr('class', 'cell')
            .attr('x', d => x(d.S) - cellWidth/2)
            .attr('y', d => y(d.T) - cellHeight/2)
            .attr('width', cellWidth)
            .attr('height', cellHeight)
            .attr('fill', d => colorScale(d.price));
        
        // æ·»åŠ åæ ‡è½´
        g.append('g')
            .attr('transform', `translate(0,${height})`)
            .call(d3.axisBottom(x))
            .append('text')
            .attr('x', width / 2)
            .attr('y', 35)
            .attr('fill', 'black')
            .style('text-anchor', 'middle')
            .text('æ ‡çš„ä»·æ ¼');
            
        g.append('g')
            .call(d3.axisLeft(y))
            .append('text')
            .attr('transform', 'rotate(-90)')
            .attr('y', -35)
            .attr('x', -height / 2)
            .attr('fill', 'black')
            .style('text-anchor', 'middle')
            .text('åˆ°æœŸæ—¶é—´');
        
        // æ·»åŠ é¢œè‰²æ¡
        const colorBarWidth = 20;
        const colorBarHeight = height;
        const colorBar = svg.append('g')
            .attr('transform', `translate(${width + margin.left + 20}, ${margin.top})`);
        
        const colorBarScale = d3.scaleLinear()
            .domain(colorScale.domain())
            .range([colorBarHeight, 0]);
        
        const colorBarAxis = d3.axisRight(colorBarScale);
        
        colorBar.append('g')
            .call(colorBarAxis);
        
        // ç»˜åˆ¶é¢œè‰²æ¡æ¸å˜
        const gradient = svg.append('defs')
            .append('linearGradient')
            .attr('id', 'colorGradient')
            .attr('gradientUnits', 'userSpaceOnUse')
            .attr('x1', 0).attr('y1', colorBarHeight)
            .attr('x2', 0).attr('y2', 0);
        
        const steps = 20;
        for (let i = 0; i <= steps; i++) {
            const value = colorScale.domain()[0] + (colorScale.domain()[1] - colorScale.domain()[0]) * i / steps;
            gradient.append('stop')
                .attr('offset', `${i / steps * 100}%`)
                .attr('stop-color', colorScale(value));
        }
        
        colorBar.append('rect')
            .attr('x', -colorBarWidth)
            .attr('y', 0)
            .attr('width', colorBarWidth)
            .attr('height', colorBarHeight)
            .attr('fill', 'url(#colorGradient)');
    }
    
    // ç»˜åˆ¶å¸Œè…Šå­—æ¯å›¾è¡¨
    function drawGreeksChart() {
        const container = d3.select('#optionChart');
        const margin = {top: 20, right: 30, bottom: 40, left: 50};
        const width = 800 - margin.left - margin.right;
        const height = 400 - margin.bottom - margin.top;
        
        const svg = container.append('svg')
            .attr('width', width + margin.left + margin.right)
            .attr('height', height + margin.bottom + margin.top);
            
        const g = svg.append('g')
            .attr('transform', `translate(${margin.left},${margin.top})`);
        
        // ç”Ÿæˆè‚¡ä»·èŒƒå›´
        const stockPrices = d3.range(optionParams.K * 0.7, optionParams.K * 1.3, 1);
        
        // è®¡ç®—å¸Œè…Šå­—æ¯
        const greeksData = stockPrices.map(S => {
            const greeks = calculateGreeks(S, optionParams.K, optionParams.T, optionParams.r, optionParams.sigma, optionParams.type);
            return { S, ...greeks };
        });
        
        const x = d3.scaleLinear()
            .domain(d3.extent(stockPrices))
            .range([0, width]);
        
        // ä¸ºDeltaåˆ›å»ºyè½´
        const yDelta = d3.scaleLinear()
            .domain(d3.extent(greeksData, d => d.delta))
            .range([height, 0]);
        
        // ä¸ºGammaåˆ›å»ºyè½´ï¼ˆå³ä¾§ï¼‰
        const yGamma = d3.scaleLinear()
            .domain(d3.extent(greeksData, d => d.gamma))
            .range([height, 0]);
        
        const deltaLine = d3.line()
            .x(d => x(d.S))
            .y(d => yDelta(d.delta));
            
        const gammaLine = d3.line()
            .x(d => x(d.S))
            .y(d => yGamma(d.gamma));
        
        // ç»˜åˆ¶Deltaçº¿
        g.append('path')
            .datum(greeksData)
            .attr('fill', 'none')
            .attr('stroke', '#3498db')
            .attr('stroke-width', 3)
            .attr('d', deltaLine);
        
        // ç»˜åˆ¶Gammaçº¿
        g.append('path')
            .datum(greeksData)
            .attr('fill', 'none')
            .attr('stroke', '#e74c3c')
            .attr('stroke-width', 2)
            .attr('d', gammaLine);
        
        // æ ‡è®°å½“å‰è‚¡ä»·
        g.append('line')
            .attr('x1', x(optionParams.S))
            .attr('x2', x(optionParams.S))
            .attr('y1', 0)
            .attr('y2', height)
            .attr('stroke', '#f39c12')
            .attr('stroke-width', 2)
            .attr('stroke-dasharray', '3,3');
        
        // æ·»åŠ åæ ‡è½´
        g.append('g')
            .attr('transform', `translate(0,${height})`)
            .call(d3.axisBottom(x))
            .append('text')
            .attr('x', width / 2)
            .attr('y', 35)
            .attr('fill', 'black')
            .style('text-anchor', 'middle')
            .text('æ ‡çš„ä»·æ ¼');
            
        g.append('g')
            .call(d3.axisLeft(yDelta))
            .append('text')
            .attr('transform', 'rotate(-90)')
            .attr('y', -35)
            .attr('x', -height / 2)
            .attr('fill', '#3498db')
            .style('text-anchor', 'middle')
            .text('Delta');
            
        g.append('g')
            .attr('transform', `translate(${width}, 0)`)
            .call(d3.axisRight(yGamma))
            .append('text')
            .attr('transform', 'rotate(-90)')
            .attr('y', 35)
            .attr('x', -height / 2)
            .attr('fill', '#e74c3c')
            .style('text-anchor', 'middle')
            .text('Gamma');
        
        // æ·»åŠ å›¾ä¾‹
        const legend = g.append('g')
            .attr('transform', `translate(${width - 150}, 20)`);
            
        legend.append('line')
            .attr('x1', 0).attr('x2', 20)
            .attr('y1', 0).attr('y2', 0)
            .attr('stroke', '#3498db')
            .attr('stroke-width', 3);
            
        legend.append('text')
            .attr('x', 25).attr('y', 5)
            .text('Delta');
            
        legend.append('line')
            .attr('x1', 0).attr('x2', 20)
            .attr('y1', 20).attr('y2', 20)
            .attr('stroke', '#e74c3c')
            .attr('stroke-width', 2);
            
        legend.append('text')
            .attr('x', 25).attr('y', 25)
            .text('Gamma');
    }
    
    // ç»˜åˆ¶æ•æ„Ÿæ€§åˆ†æ
    function drawSensitivityAnalysis() {
        const container = d3.select('#optionChart');
        const margin = {top: 20, right: 30, bottom: 40, left: 50};
        const width = 800 - margin.left - margin.right;
        const height = 400 - margin.bottom - margin.top;
        
        const svg = container.append('svg')
            .attr('width', width + margin.left + margin.right)
            .attr('height', height + margin.bottom + margin.top);
            
        const g = svg.append('g')
            .attr('transform', `translate(${margin.left},${margin.top})`);
        
        // æ³¢åŠ¨ç‡æ•æ„Ÿæ€§åˆ†æ
        const volatilities = d3.range(0.1, 0.5, 0.01);
        
        const sensitivityData = volatilities.map(sigma => {
            const price = blackScholesPrice(optionParams.S, optionParams.K, optionParams.T, optionParams.r, sigma, optionParams.type);
            return { sigma: sigma * 100, price };
        });
        
        const x = d3.scaleLinear()
            .domain(d3.extent(sensitivityData, d => d.sigma))
            .range([0, width]);
        
        const y = d3.scaleLinear()
            .domain(d3.extent(sensitivityData, d => d.price))
            .range([height, 0]);
        
        const line = d3.line()
            .x(d => x(d.sigma))
            .y(d => y(d.price));
        
        // ç»˜åˆ¶æ•æ„Ÿæ€§æ›²çº¿
        g.append('path')
            .datum(sensitivityData)
            .attr('fill', 'none')
            .attr('stroke', '#9b59b6')
            .attr('stroke-width', 3)
            .attr('d', line);
        
        // æ ‡è®°å½“å‰æ³¢åŠ¨ç‡
        g.append('line')
            .attr('x1', x(optionParams.sigma * 100))
            .attr('x2', x(optionParams.sigma * 100))
            .attr('y1', 0)
            .attr('y2', height)
            .attr('stroke', '#f39c12')
            .attr('stroke-width', 2)
            .attr('stroke-dasharray', '3,3');
        
        // æ·»åŠ åæ ‡è½´
        g.append('g')
            .attr('transform', `translate(0,${height})`)
            .call(d3.axisBottom(x))
            .append('text')
            .attr('x', width / 2)
            .attr('y', 35)
            .attr('fill', 'black')
            .style('text-anchor', 'middle')
            .text('æ³¢åŠ¨ç‡ (%)');
            
        g.append('g')
            .call(d3.axisLeft(y))
            .append('text')
            .attr('transform', 'rotate(-90)')
            .attr('y', -35)
            .attr('x', -height / 2)
            .attr('fill', 'black')
            .style('text-anchor', 'middle')
            .text('æœŸæƒä»·æ ¼');
    }
    
    // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
    function setupEventListeners() {
        // æ»‘å—äº‹ä»¶
        ['stockPrice', 'strikePrice', 'timeToExpiry', 'riskFreeRate', 'volatility'].forEach(id => {
            document.getElementById(id).addEventListener('input', function() {
                document.getElementById(id + 'Num').value = this.value;
                updateOptionPricing();
            });
        });
        
        // æ•°å­—è¾“å…¥æ¡†äº‹ä»¶
        ['stockPriceNum', 'strikePriceNum', 'timeToExpiryNum', 'riskFreeRateNum', 'volatilityNum'].forEach(id => {
            document.getElementById(id).addEventListener('input', function() {
                const baseId = id.replace('Num', '');
                document.getElementById(baseId).value = this.value;
                updateOptionPricing();
            });
        });
        
        // æœŸæƒç±»å‹é€‰æ‹©
        document.getElementById('optionType').addEventListener('change', updateOptionPricing);
    }
    
    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
        setupEventListeners();
        updateOptionPricing();
    });
    </script>
    
    <!-- æœŸæƒå®šä»·äº¤äº’å¼æ¼”ç¤º -->
    <div class="interactive-demo">
        <h3>æœŸæƒå®šä»·äº¤äº’å¼æ¼”ç¤º</h3>
        
        <!-- å‚æ•°æ§åˆ¶é¢æ¿ -->
        <div class="demo-controls">
            <div class="control-group">
                <h4>æœŸæƒå‚æ•°</h4>
                <div class="control-row">
                    <label>æ ‡çš„ä»·æ ¼ (S): <span id="stockPriceValue">100</span></label>
                    <input type="range" id="stockPrice" min="50" max="150" value="100" step="1">
                    <input type="number" id="stockPriceNum" min="50" max="150" value="100" step="1">
                </div>
                <div class="control-row">
                    <label>æ‰§è¡Œä»·æ ¼ (K): <span id="strikePriceValue">100</span></label>
                    <input type="range" id="strikePrice" min="80" max="120" value="100" step="1">
                    <input type="number" id="strikePriceNum" min="80" max="120" value="100" step="1">
                </div>
                <div class="control-row">
                    <label>åˆ°æœŸæ—¶é—´ (T): <span id="timeToExpiryValue">0.25</span> å¹´</label>
                    <input type="range" id="timeToExpiry" min="0.01" max="1" value="0.25" step="0.01">
                    <input type="number" id="timeToExpiryNum" min="0.01" max="1" value="0.25" step="0.01">
                </div>
                <div class="control-row">
                    <label>æ— é£é™©åˆ©ç‡ (r): <span id="riskFreeRateValue">5</span>%</label>
                    <input type="range" id="riskFreeRate" min="0" max="10" value="5" step="0.1">
                    <input type="number" id="riskFreeRateNum" min="0" max="10" value="5" step="0.1">
                </div>
                <div class="control-row">
                    <label>æ³¢åŠ¨ç‡ (Ïƒ): <span id="volatilityValue">20</span>%</label>
                    <input type="range" id="volatility" min="5" max="50" value="20" step="1">
                    <input type="number" id="volatilityNum" min="5" max="50" value="20" step="1">
                </div>
                <div class="control-row">
                    <label>æœŸæƒç±»å‹:</label>
                    <select id="optionType">
                        <option value="call">çœ‹æ¶¨æœŸæƒ (Call)</option>
                        <option value="put">çœ‹è·ŒæœŸæƒ (Put)</option>
                    </select>
                </div>
            </div>
            
            <div class="control-group">
                <h4>åˆ†æé€‰é¡¹</h4>
                <div class="control-row">
                    <button onclick="updateOptionPricing()" class="btn-primary">æ›´æ–°è®¡ç®—</button>
                    <button onclick="resetParameters()" class="btn-secondary">é‡ç½®å‚æ•°</button>
                </div>
                <div class="control-row">
                    <label>å›¾è¡¨ç±»å‹:</label>
                    <select id="chartType" onchange="switchChart()">
                        <option value="payoff">æŸç›Šå›¾</option>
                        <option value="price_surface">ä»·æ ¼æ›²é¢</option>
                        <option value="greeks">å¸Œè…Šå­—æ¯</option>
                        <option value="sensitivity">æ•æ„Ÿæ€§åˆ†æ</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- æœŸæƒä»·æ ¼æ˜¾ç¤º -->
        <div class="option-pricing-display">
            <div class="pricing-card">
                <h4>æœŸæƒä»·æ ¼</h4>
                <div class="price-value" id="optionPrice">--</div>
                <div class="price-label">Black-Scholesä»·æ ¼</div>
            </div>
            <div class="pricing-card">
                <h4>å†…åœ¨ä»·å€¼</h4>
                <div class="price-value" id="intrinsicValue">--</div>
                <div class="price-label">ç«‹å³æ‰§è¡Œä»·å€¼</div>
            </div>
            <div class="pricing-card">
                <h4>æ—¶é—´ä»·å€¼</h4>
                <div class="price-value" id="timeValue">--</div>
                <div class="price-label">æœŸæƒæº¢ä»·</div>
            </div>
        </div>
        
        <!-- å¸Œè…Šå­—æ¯æ˜¾ç¤º -->
        <div class="greeks-display">
            <div class="greek-card">
                <div class="greek-name">Delta (Î”)</div>
                <div class="greek-value" id="deltaValue">--</div>
                <div class="greek-desc">ä»·æ ¼æ•æ„Ÿæ€§</div>
            </div>
            <div class="greek-card">
                <div class="greek-name">Gamma (Î“)</div>
                <div class="greek-value" id="gammaValue">--</div>
                <div class="greek-desc">Deltaå˜åŒ–ç‡</div>
            </div>
            <div class="greek-card">
                <div class="greek-name">Theta (Î˜)</div>
                <div class="greek-value" id="thetaValue">--</div>
                <div class="greek-desc">æ—¶é—´è¡°å‡</div>
            </div>
            <div class="greek-card">
                <div class="greek-name">Vega (Î½)</div>
                <div class="greek-value" id="vegaValue">--</div>
                <div class="greek-desc">æ³¢åŠ¨ç‡æ•æ„Ÿæ€§</div>
            </div>
            <div class="greek-card">
                <div class="greek-name">Rho (Ï)</div>
                <div class="greek-value" id="rhoValue">--</div>
                <div class="greek-desc">åˆ©ç‡æ•æ„Ÿæ€§</div>
            </div>
        </div>
        
        <!-- å›¾è¡¨æ˜¾ç¤ºåŒºåŸŸ -->
        <div class="chart-container">
            <div id="optionChart"></div>
        </div>
    </div>
    
    <style>
    .interactive-demo {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
    }
    
    .demo-controls {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
    }
    
    .control-group {
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .control-group h4 {
        margin: 0 0 15px 0;
        color: #2c3e50;
        border-bottom: 2px solid #3498db;
        padding-bottom: 5px;
    }
    
    .control-row {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        gap: 10px;
    }
    
    .control-row label {
        min-width: 150px;
        font-weight: 500;
    }
    
    .control-row input[type="range"] {
        flex: 1;
        margin: 0 10px;
    }
    
    .control-row input[type="number"] {
        width: 80px;
        padding: 5px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    
    .control-row select {
        flex: 1;
        padding: 5px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    
    .btn-primary, .btn-secondary {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 500;
        margin-right: 10px;
    }
    
    .btn-primary {
        background: #3498db;
        color: white;
    }
    
    .btn-primary:hover {
        background: #2980b9;
    }
    
    .btn-secondary {
        background: #95a5a6;
        color: white;
    }
    
    .btn-secondary:hover {
        background: #7f8c8d;
    }
    
    .option-pricing-display {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        margin-bottom: 20px;
    }
    
    .pricing-card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        border-left: 4px solid #3498db;
    }
    
    .pricing-card h4 {
        margin: 0 0 10px 0;
        color: #2c3e50;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .price-value {
        font-size: 24px;
        font-weight: bold;
        color: #27ae60;
        margin-bottom: 5px;
    }
    
    .price-label {
        font-size: 12px;
        color: #7f8c8d;
    }
    
    .greeks-display {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 15px;
        margin-bottom: 20px;
    }
    
    .greek-card {
        background: white;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        border-top: 3px solid #e74c3c;
    }
    
    .greek-name {
        font-size: 14px;
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 8px;
    }
    
    .greek-value {
        font-size: 18px;
        font-weight: bold;
        color: #e74c3c;
        margin-bottom: 5px;
    }
    
    .greek-desc {
        font-size: 11px;
        color: #7f8c8d;
    }
    
    .chart-container {
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    #optionChart {
        width: 100%;
        height: 500px;
    }
    
    @media (max-width: 768px) {
        .demo-controls {
            grid-template-columns: 1fr;
        }
        
        .option-pricing-display {
            grid-template-columns: 1fr;
        }
        
        .greeks-display {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .control-row {
            flex-direction: column;
            align-items: stretch;
        }
        
        .control-row label {
            min-width: auto;
            margin-bottom: 5px;
        }
    }
    </style>
</body>
</html>
    <style>
    /* ç¡®ä¿ä»£ç å—å·¦å¯¹é½ */
    .lesson-content pre {
        text-align: left !important;
        font-family: 'Courier New', Courier, monospace;
        background-color: #f5f7fa;
        padding: 15px;
        border-radius: 8px;
        overflow-x: auto;
        margin: 20px 0;
        border-left: 4px solid #4299e1;
    }
    
    .lesson-content code {
        text-align: left !important;
        font-family: 'Courier New', Courier, monospace;
        background-color: #f5f7fa;
        padding: 2px 5px;
        border-radius: 3px;
    }
    
    /* ç¡®ä¿preæ ‡ç­¾å†…çš„å†…å®¹å·¦å¯¹é½ */
    pre * {
        text-align: left !important;
    }
    
    /* ç¡®ä¿æ‰€æœ‰ä»£ç ç›¸å…³å…ƒç´ éƒ½å·¦å¯¹é½ */
    pre, code, .hljs {
        text-align: left !important;
    }
    </style>
    
</head>
<body>
<div id="navigation-container"></div>


        </section>
        <div class="lesson-navigation">
            <a href="../../index.html" class="btn">Â« è¿”å›æ¨¡å—é¦–é¡µ</a>
            <a href="lesson2.html" class="btn">ä¸‹ä¸€è¯¾: å›ºå®šæ”¶ç›Šè¯åˆ¸åˆ†æ Â»</a>
        </div>
    </main>
    <footer>
        <div class="container">
            <p>Â© 2023 Pythoné‡‘èç¼–ç¨‹è¯¾ç¨‹. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
        </div>
    </footer>
</body>
</html>