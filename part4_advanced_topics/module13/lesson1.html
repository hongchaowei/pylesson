<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第1课: 期权定价与希腊字母 - Python金融编程课程</title>
    <link rel="stylesheet" href="../../css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
<div id="navigation-container"></div>
<script>
// 动态加载导航条
function loadNavigation() {
    fetch('../../nav.html')
        .then(response => response.text())
        .then(html => {
            // 更新导航中的链接路径
            let updatedHtml = html;
            
            // 处理根目录文件链接（index.html, syllabus.html等）
            updatedHtml = updatedHtml.replace(/href="index\.html"/g, 'href="../../index.html"');
            updatedHtml = updatedHtml.replace(/href="\.\/([^/]*\.html)"/g, 'href="../../$1"');
            
            // 处理模块路径链接（已经是完整相对路径，只需要添加根路径前缀）
            updatedHtml = updatedHtml.replace(/href="\.\/part([^"]*)"/g, 'href="../../part$1"');
            
            document.getElementById('navigation-container').innerHTML = updatedHtml;
            
            // 添加移动端菜单切换功能
            const menuToggle = document.getElementById('menuToggle');
            const navMenu = document.querySelector('.nav-menu');
            if (menuToggle && navMenu) {
                menuToggle.addEventListener('click', function() {
                    navMenu.classList.toggle('active');
                });
            }
        })
        .catch(error => console.error('导航加载失败:', error));
}

// 页面加载完成后加载导航
document.addEventListener('DOMContentLoaded', loadNavigation);
</script>

<main class="container">
    
        <section class="theory-section">
            <h2>📚 数学理论基础</h2>
            <div class="theory-content">
                <h3>1. Black-Scholes偏微分方程</h3>
                <div class="math-formula">
                    <p><strong>Black-Scholes PDE：</strong></p>
                    <p>\[ \frac{\partial V}{\partial t} + \frac{1}{2}\sigma^2 S^2 \frac{\partial^2 V}{\partial S^2} + rS\frac{\partial V}{\partial S} - rV = 0 \]</p>
                    <p>其中 \(V(S,t)\) 是期权价值，\(S\) 是标的资产价格，\(t\) 是时间，\(\sigma\) 是波动率，\(r\) 是无风险利率。</p>
                </div>
                <h3>2. Black-Scholes偏微分方程推导</h3>
                <div class="concept-explanation">
                    <h4>💡 Black-Scholes方程的经济直觉</h4>
                    <p><strong>核心思想：</strong>在无套利的市场中，期权价格的变化必须与其对冲组合的价值变化相匹配。</p>
                    <p><strong>物理类比：</strong>就像热传导方程描述温度在空间和时间中的扩散，BS方程描述期权价值在价格和时间维度的演化。</p>
                    <p><strong>数学本质：</strong>这是一个抛物型偏微分方程，体现了期权价值对标的价格、时间和波动率的敏感性。</p>
                </div>
                <div class="calculation-example">
                    <h4>📊 Black-Scholes方程推导</h4>
                    <p><strong>推导思路：</strong>构建无风险对冲组合，利用无套利原理</p>
                    
                    <p><strong>步骤1：构建对冲组合</strong></p>
                    <p>组合 \(\Pi = V - \Delta S\)，其中 \(\Delta = \frac{\partial V}{\partial S}\)</p>
                    
                    <p><strong>步骤2：计算组合价值变化</strong></p>
                    <p>\(d\Pi = dV - \Delta dS\)</p>
                    <p>利用Ito引理：\(dV = \frac{\partial V}{\partial t}dt + \frac{\partial V}{\partial S}dS + \frac{1}{2}\frac{\partial^2 V}{\partial S^2}(dS)^2\)</p>
                    <p>其中 \(dS = rSdt + \sigma S dW\)，\((dS)^2 = \sigma^2 S^2 dt\)</p>
                    
                    <p><strong>步骤3：消除随机项</strong></p>
                    <p>选择 \(\Delta = \frac{\partial V}{\partial S}\) 使随机项相消：</p>
                    <p>\(d\Pi = [\frac{\partial V}{\partial t} + \frac{1}{2}\sigma^2 S^2 \frac{\partial^2 V}{\partial S^2} - r\Delta S]dt\)</p>
                    
                    <p><strong>步骤4：无套利条件</strong></p>
                    <p>无风险组合必须获得无风险收益：\(d\Pi = r\Pi dt = r(V - \Delta S)dt\)</p>
                    <p>整理得到Black-Scholes方程。</p>
                </div>
                <h3>3. 几何布朗运动</h3>
                <div class="math-formula">
                    <p><strong>股价动态过程：</strong></p>
                    <p>\[ dS = \mu S dt + \sigma S dW \]</p>
                    <p>其中 \(\mu\) 是漂移率，\(dW\) 是维纳过程的增量。</p>
                    <p><strong>解析解：</strong></p>
                    <p>\[ S_T = S_0 \exp\left[(\mu - \frac{\sigma^2}{2})T + \sigma W_T\right] \]</p>
                </div>
                <h3>4. Black-Scholes公式</h3>
                <div class="concept-explanation">
                    <h4>💡 Black-Scholes公式的经济直觉</h4>
                    <p><strong>看涨期权公式解读：</strong>\(C = S_0 N(d_1) - Ke^{-rT} N(d_2)\)</p>
                    <ul>
                        <li>\(S_0 N(d_1)\)：持有标的资产的期望价值（考虑行权概率）</li>
                        <li>\(Ke^{-rT} N(d_2)\)：支付行权价的期望现值</li>
                        <li>\(N(d_1)\)：风险中性测度下的行权概率（Delta）</li>
                        <li>\(N(d_2)\)：实际测度下的行权概率</li>
                    </ul>
                    <p><strong>数学美感：</strong>这个公式优雅地将概率、时间价值和风险调整融为一体。</p>
                </div>
                <div class="math-formula">
                    <p><strong>欧式看涨期权：</strong></p>
                    <p>\[ C = S_0 N(d_1) - Ke^{-rT} N(d_2) \]</p>
                    <p><strong>欧式看跌期权：</strong></p>
                    <p>\[ P = Ke^{-rT} N(-d_2) - S_0 N(-d_1) \]</p>
                    <p>其中：</p>
                    <p>\[ d_1 = \frac{\ln(S_0/K) + (r + \sigma^2/2)T}{\sigma\sqrt{T}} \]</p>
                    <p>\[ d_2 = d_1 - \sigma\sqrt{T} \]</p>
                    <p>\(N(\cdot)\) 是标准正态分布的累积分布函数。</p>
                </div>
                <div class="formula-explanation">公式含义：期权价值 = 持有资产的期望收益 - 支付行权价的期望成本</div>
                
                <div class="calculation-example">
                    <h4>📊 Black-Scholes公式推导与计算示例</h4>
                    
                    <p><strong>推导关键步骤：</strong></p>
                    <p>1. 假设股价遵循几何布朗运动：\(dS = rSdt + \sigma SdW\)</p>
                    <p>2. 期权到期收益：\(C_T = \max(S_T - K, 0)\)</p>
                    <p>3. 风险中性定价：\(C_0 = e^{-rT}E^Q[C_T]\)</p>
                    <p>4. 计算期望：\(E^Q[\max(S_T - K, 0)]\)</p>
                    <p>5. 利用\(S_T\)的对数正态分布性质求解积分</p>
                    
                    <p><strong>实际计算示例：</strong></p>
                    <p>计算一个欧式看涨期权的价格，参数如下：</p>
                    <ul>
                        <li>当前股价 \(S_0 = 100\)</li>
                        <li>行权价 \(K = 105\)</li>
                        <li>到期时间 \(T = 0.25\) 年（3个月）</li>
                        <li>无风险利率 \(r = 5\% = 0.05\)</li>
                        <li>波动率 \(\sigma = 20\% = 0.20\)</li>
                    </ul>
                    
                    <p><strong>计算过程：</strong></p>
                    <p>\(d_1 = \frac{\ln(100/105) + (0.05 + 0.20^2/2) \times 0.25}{0.20\sqrt{0.25}}\)</p>
                    <p>\(d_1 = \frac{-0.0488 + (0.05 + 0.02) \times 0.25}{0.20 \times 0.5}\)</p>
                    <p>\(d_1 = \frac{-0.0488 + 0.0175}{0.1} = \frac{-0.0313}{0.1} = -0.313\)</p>
                    
                    <p>\(d_2 = d_1 - \sigma\sqrt{T} = -0.313 - 0.20 \times 0.5 = -0.413\)</p>
                    
                    <p>查标准正态分布表：</p>
                    <p>\(N(d_1) = N(-0.313) = 0.3773\)</p>
                    <p>\(N(d_2) = N(-0.413) = 0.3398\)</p>
                    
                    <p>期权价格：</p>
                    <p>\(C = 100 \times 0.3773 - 105 \times e^{-0.05 \times 0.25} \times 0.3398\)</p>
                    <p>\(C = 37.73 - 105 \times 0.9876 \times 0.3398\)</p>
                    <p>\(C = 37.73 - 35.24 = 2.49\)</p>
                    
                    <p><strong>结论：</strong>该看涨期权的理论价格为2.49元。</p>
                    
                    <p><strong>敏感性分析：</strong></p>
                    <p>• 如果波动率增加到30%，期权价格会上升到约4.1元</p>
                    <p>• 如果股价上涨到110元，期权价格会上升到约8.8元</p>
                    <p>• 如果距离到期时间延长到6个月，期权价格会上升到约5.2元</p>
                </div>
                <h3>5. 希腊字母的数学定义</h3>
                <div class="math-formula">
                    <p><strong>Delta (Δ)：</strong></p>
                    <p>\[ \Delta = \frac{\partial V}{\partial S} \]</p>
                    <p>对于看涨期权：\(\Delta_c = N(d_1)\)</p>
                    <p>对于看跌期权：\(\Delta_p = N(d_1) - 1\)</p>
                </div>
                <div class="math-formula">
                    <p><strong>Gamma (Γ)：</strong></p>
                    <p>\[ \Gamma = \frac{\partial^2 V}{\partial S^2} = \frac{\phi(d_1)}{S_0\sigma\sqrt{T}} \]</p>
                    <p>其中 \(\phi(\cdot)\) 是标准正态分布的概率密度函数。</p>
                </div>
                <div class="math-formula">
                    <p><strong>Theta (Θ)：</strong></p>
                    <p>\[ \Theta = -\frac{\partial V}{\partial t} \]</p>
                    <p>对于看涨期权：</p>
                    <p>\[ \Theta_c = -\frac{S_0\phi(d_1)\sigma}{2\sqrt{T}} - rKe^{-rT}N(d_2) \]</p>
                </div>
                <div class="math-formula">
                    <p><strong>Vega (ν)：</strong></p>
                    <p>\[ \nu = \frac{\partial V}{\partial \sigma} = S_0\phi(d_1)\sqrt{T} \]</p>
                </div>
                <div class="math-formula">
                    <p><strong>Rho (ρ)：</strong></p>
                    <p>\[ \rho = \frac{\partial V}{\partial r} \]</p>
                    <p>对于看涨期权：\(\rho_c = KTe^{-rT}N(d_2)\)</p>
                    <p>对于看跌期权：\(\rho_p = -KTe^{-rT}N(-d_2)\)</p>
                </div>
            </div>
        </section>
        <section class="lesson-content">
            <h2>期权基础知识</h2>
            <p>期权是一种金融衍生品，它赋予持有者在特定日期或之前以特定价格买入或卖出标的资产的权利。</p>
            <h3>1. 期权基本类型</h3>
            <pre><code class="language-python">option_types = {
    '看涨期权': '赋予持有者以执行价买入标的资产的权利',
    '看跌期权': '赋予持有者以执行价卖出标的资产的权利',
    '欧式期权': '只能在到期日行权',
    '美式期权': '可以在到期日或之前任何时间行权'
}</code></pre>
            <h3>2. 期权定价影响因素</h3>
            <pre><code class="language-python">option_pricing_factors = [
    '标的资产价格(S)',
    '执行价格(K)',
    '到期时间(T)',
    '无风险利率(r)',
    '波动率(σ)',
    '股息率(q)'
]</code></pre>
        </section>
        <section class="lesson-content">
            <h2>Black-Scholes模型</h2>
            <p>Black-Scholes模型是期权定价的经典方法，为欧式期权提供了理论价格。</p>
            <h3>1. 模型公式</h3>
            <pre><code class="language-python">import math
from scipy.stats import norm
def black_scholes(S, K, T, r, sigma, option_type='call'):
    """
    Black-Scholes期权定价模型
    :param S: 标的资产价格
    :param K: 执行价格
    :param T: 到期时间(年)
    :param r: 无风险利率
    :param sigma: 波动率
    :param option_type: 期权类型('call'或'put')
    :return: 期权价格
    """
    d1 = (math.log(S / K) + (r + 0.5 * sigma ** 2) * T) / (sigma * math.sqrt(T))
    d2 = d1 - sigma * math.sqrt(T)
    if option_type == 'call':
        price = S * norm.cdf(d1) - K * math.exp(-r * T) * norm.cdf(d2)
    else:
        price = K * math.exp(-r * T) * norm.cdf(-d2) - S * norm.cdf(-d1)
    return price
# 示例计算
call_price = black_scholes(100, 105, 0.5, 0.05, 0.2, 'call')
put_price = black_scholes(100, 105, 0.5, 0.05, 0.2, 'put')</code></pre>
            <h3>2. 隐含波动率计算</h3>
            <pre><code class="language-python">from scipy.optimize import brentq
def implied_volatility(S, K, T, r, option_price, option_type='call'):
    """
    计算隐含波动率
    :param option_price: 观察到的期权市场价格
    :return: 隐含波动率
    """
    def price_difference(sigma):
        return black_scholes(S, K, T, r, sigma, option_type) - option_price
    try:
        iv = brentq(price_difference, 0.001, 5.0)
        return iv
    except ValueError:
        return None
# 示例计算
iv = implied_volatility(100, 105, 0.5, 0.05, 8.0, 'call')</code></pre>
        </section>
        <section class="lesson-content">
            <h2>蒙特卡洛模拟</h2>
            <p>蒙特卡洛方法通过模拟标的资产价格的随机路径来估计期权价格。</p>
            <h3>1. 欧式期权定价</h3>
            <pre><code class="language-python">import numpy as np
def monte_carlo_option_price(S, K, T, r, sigma, option_type='call', n_simulations=100000):
    """
    蒙特卡洛模拟期权定价
    :param n_simulations: 模拟次数
    :return: 期权价格
    """
    # 生成随机路径
    z = np.random.normal(0, 1, n_simulations)
    ST = S * np.exp((r - 0.5 * sigma**2) * T + sigma * np.sqrt(T) * z)
    # 计算收益
    if option_type == 'call':
        payoff = np.maximum(ST - K, 0)
    else:
        payoff = np.maximum(K - ST, 0)
    # 贴现求平均值
    option_price = np.exp(-r * T) * np.mean(payoff)
    return option_price
# 示例计算
mc_price = monte_carlo_option_price(100, 105, 0.5, 0.05, 0.2, 'call')</code></pre>
            <h3>2. 美式期权定价</h3>
            <pre><code class="language-python">def monte_carlo_american_option(S, K, T, r, sigma, option_type='call', n_simulations=10000, n_steps=100):
    """
    蒙特卡洛模拟美式期权定价(最小二乘蒙特卡洛方法)
    :return: 期权价格
    """
    dt = T / n_steps
    discount = np.exp(-r * dt)
    # 生成价格路径
    paths = np.zeros((n_simulations, n_steps + 1))
    paths[:, 0] = S
    for t in range(1, n_steps + 1):
        z = np.random.normal(0, 1, n_simulations)
        paths[:, t] = paths[:, t-1] * np.exp((r - 0.5 * sigma**2) * dt + sigma * np.sqrt(dt) * z)
    # 逆向计算
    payoff = np.zeros_like(paths)
    if option_type == 'call':
        payoff = np.maximum(paths - K, 0)
    else:
        payoff = np.maximum(K - paths, 0)
    value = payoff[:, -1]
    for t in range(n_steps - 1, 0, -1):
        # 回归分析
        regression = np.polyfit(paths[:, t], value * discount, 5)
        continuation_value = np.polyval(regression, paths[:, t])
        # 比较立即行权价值与继续持有价值
        value = np.where(
            payoff[:, t] > continuation_value,
            payoff[:, t],
            value * discount
        )
    option_price = np.mean(value) * discount
    return option_price
# 示例计算
american_price = monte_carlo_american_option(100, 105, 0.5, 0.05, 0.2, 'put')</code></pre>
        </section>
        <section class="lesson-content">
            <h2>期权希腊字母</h2>
            <p>希腊字母衡量期权价格对各种因素的敏感度，是风险管理的重要工具。</p>
            <h3>1. 主要希腊字母计算</h3>
            <pre><code class="language-python">def black_scholes_greeks(S, K, T, r, sigma, option_type='call'):
    """
    计算Black-Scholes希腊字母
    :return: delta, gamma, theta, vega, rho
    """
    d1 = (math.log(S / K) + (r + 0.5 * sigma ** 2) * T) / (sigma * math.sqrt(T))
    d2 = d1 - sigma * math.sqrt(T)
    # Delta
    if option_type == 'call':
        delta = norm.cdf(d1)
    else:
        delta = norm.cdf(d1) - 1
    # Gamma
    gamma = norm.pdf(d1) / (S * sigma * math.sqrt(T))
    # Theta
    if option_type == 'call':
        theta = - (S * norm.pdf(d1) * sigma) / (2 * math.sqrt(T)) - r * K * math.exp(-r * T) * norm.cdf(d2)
    else:
        theta = - (S * norm.pdf(d1) * sigma) / (2 * math.sqrt(T)) + r * K * math.exp(-r * T) * norm.cdf(-d2)
    theta = theta / 365  # 转换为每日theta
    # Vega
    vega = S * math.sqrt(T) * norm.pdf(d1)
    vega = vega / 100  # 表示波动率变化1%的影响
    # Rho
    if option_type == 'call':
        rho = K * T * math.exp(-r * T) * norm.cdf(d2)
    else:
        rho = -K * T * math.exp(-r * T) * norm.cdf(-d2)
    rho = rho / 100  # 表示利率变化1%的影响
    return delta, gamma, theta, vega, rho
# 示例计算
greeks = black_scholes_greeks(100, 105, 0.5, 0.05, 0.2, 'call')</code></pre>
            <h3>2. 希腊字母可视化</h3>
            <pre><code class="language-python">import matplotlib.pyplot as plt
def plot_option_greeks(S_range, K, T, r, sigma, option_type='call'):
    """绘制希腊字母随标的资产价格变化的曲线"""
    deltas, gammas, thetas, vegas, rhos = [], [], [], [], []
    for S in S_range:
        greek = black_scholes_greeks(S, K, T, r, sigma, option_type)
        deltas.append(greek[0])
        gammas.append(greek[1])
        thetas.append(greek[2])
        vegas.append(greek[3])
        rhos.append(greek[4])
    plt.figure(figsize=(12, 8))
    plt.subplot(2, 3, 1)
    plt.plot(S_range, deltas)
    plt.title('Delta')
    plt.subplot(2, 3, 2)
    plt.plot(S_range, gammas)
    plt.title('Gamma')
    plt.subplot(2, 3, 3)
    plt.plot(S_range, thetas)
    plt.title('Theta')
    plt.subplot(2, 3, 4)
    plt.plot(S_range, vegas)
    plt.title('Vega')
    plt.subplot(2, 3, 5)
    plt.plot(S_range, rhos)
    plt.title('Rho')
    plt.tight_layout()
    plt.show()
# 示例可视化
S_range = np.linspace(50, 150, 100)
plot_option_greeks(S_range, 105, 0.5, 0.05, 0.2, 'call')</code></pre>

    <script>
    // 期权定价演示相关变量
    let currentChartType = 'payoff';
    let optionParams = {
        S: 100,    // 标的价格
        K: 100,    // 执行价格
        T: 0.25,   // 到期时间
        r: 0.05,   // 无风险利率
        sigma: 0.2, // 波动率
        type: 'call' // 期权类型
    };
    
    // 标准正态分布累积分布函数
    function normalCDF(x) {
        return 0.5 * (1 + erf(x / Math.sqrt(2)));
    }
    
    // 误差函数近似
    function erf(x) {
        const a1 =  0.254829592;
        const a2 = -0.284496736;
        const a3 =  1.421413741;
        const a4 = -1.453152027;
        const a5 =  1.061405429;
        const p  =  0.3275911;
        
        const sign = x < 0 ? -1 : 1;
        x = Math.abs(x);
        
        const t = 1.0 / (1.0 + p * x);
        const y = 1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);
        
        return sign * y;
    }
    
    // 标准正态分布概率密度函数
    function normalPDF(x) {
        return Math.exp(-0.5 * x * x) / Math.sqrt(2 * Math.PI);
    }
    
    // Black-Scholes期权定价公式
    function blackScholesPrice(S, K, T, r, sigma, type) {
        if (T <= 0) {
            // 到期时的内在价值
            if (type === 'call') {
                return Math.max(S - K, 0);
            } else {
                return Math.max(K - S, 0);
            }
        }
        
        const d1 = (Math.log(S / K) + (r + 0.5 * sigma * sigma) * T) / (sigma * Math.sqrt(T));
        const d2 = d1 - sigma * Math.sqrt(T);
        
        if (type === 'call') {
            return S * normalCDF(d1) - K * Math.exp(-r * T) * normalCDF(d2);
        } else {
            return K * Math.exp(-r * T) * normalCDF(-d2) - S * normalCDF(-d1);
        }
    }
    
    // 计算希腊字母
    function calculateGreeks(S, K, T, r, sigma, type) {
        if (T <= 0) {
            return { delta: 0, gamma: 0, theta: 0, vega: 0, rho: 0 };
        }
        
        const d1 = (Math.log(S / K) + (r + 0.5 * sigma * sigma) * T) / (sigma * Math.sqrt(T));
        const d2 = d1 - sigma * Math.sqrt(T);
        
        let delta, gamma, theta, vega, rho;
        
        if (type === 'call') {
            delta = normalCDF(d1);
            theta = -(S * normalPDF(d1) * sigma) / (2 * Math.sqrt(T)) - r * K * Math.exp(-r * T) * normalCDF(d2);
            rho = K * T * Math.exp(-r * T) * normalCDF(d2);
        } else {
            delta = normalCDF(d1) - 1;
            theta = -(S * normalPDF(d1) * sigma) / (2 * Math.sqrt(T)) + r * K * Math.exp(-r * T) * normalCDF(-d2);
            rho = -K * T * Math.exp(-r * T) * normalCDF(-d2);
        }
        
        gamma = normalPDF(d1) / (S * sigma * Math.sqrt(T));
        vega = S * normalPDF(d1) * Math.sqrt(T);
        
        // 转换单位
        theta = theta / 365; // 每日时间衰减
        vega = vega / 100;   // 波动率变化1%的影响
        rho = rho / 100;     // 利率变化1%的影响
        
        return { delta, gamma, theta, vega, rho };
    }
    
    // 计算内在价值
    function calculateIntrinsicValue(S, K, type) {
        if (type === 'call') {
            return Math.max(S - K, 0);
        } else {
            return Math.max(K - S, 0);
        }
    }
    
    // 更新参数显示
    function updateParameterDisplay() {
        document.getElementById('stockPriceValue').textContent = optionParams.S;
        document.getElementById('strikePriceValue').textContent = optionParams.K;
        document.getElementById('timeToExpiryValue').textContent = optionParams.T;
        document.getElementById('riskFreeRateValue').textContent = optionParams.r * 100;
        document.getElementById('volatilityValue').textContent = optionParams.sigma * 100;
        
        // 同步滑块和数字输入框
        document.getElementById('stockPrice').value = optionParams.S;
        document.getElementById('stockPriceNum').value = optionParams.S;
        document.getElementById('strikePrice').value = optionParams.K;
        document.getElementById('strikePriceNum').value = optionParams.K;
        document.getElementById('timeToExpiry').value = optionParams.T;
        document.getElementById('timeToExpiryNum').value = optionParams.T;
        document.getElementById('riskFreeRate').value = optionParams.r * 100;
        document.getElementById('riskFreeRateNum').value = optionParams.r * 100;
        document.getElementById('volatility').value = optionParams.sigma * 100;
        document.getElementById('volatilityNum').value = optionParams.sigma * 100;
        document.getElementById('optionType').value = optionParams.type;
    }
    
    // 更新期权定价计算
    function updateOptionPricing() {
        // 获取参数
        optionParams.S = +document.getElementById('stockPrice').value;
        optionParams.K = +document.getElementById('strikePrice').value;
        optionParams.T = +document.getElementById('timeToExpiry').value;
        optionParams.r = +document.getElementById('riskFreeRate').value / 100;
        optionParams.sigma = +document.getElementById('volatility').value / 100;
        optionParams.type = document.getElementById('optionType').value;
        
        // 更新显示
        updateParameterDisplay();
        
        // 计算期权价格
        const optionPrice = blackScholesPrice(optionParams.S, optionParams.K, optionParams.T, optionParams.r, optionParams.sigma, optionParams.type);
        const intrinsicValue = calculateIntrinsicValue(optionParams.S, optionParams.K, optionParams.type);
        const timeValue = optionPrice - intrinsicValue;
        
        // 计算希腊字母
        const greeks = calculateGreeks(optionParams.S, optionParams.K, optionParams.T, optionParams.r, optionParams.sigma, optionParams.type);
        
        // 更新显示
        document.getElementById('optionPrice').textContent = optionPrice.toFixed(4);
        document.getElementById('intrinsicValue').textContent = intrinsicValue.toFixed(4);
        document.getElementById('timeValue').textContent = timeValue.toFixed(4);
        
        document.getElementById('deltaValue').textContent = greeks.delta.toFixed(4);
        document.getElementById('gammaValue').textContent = greeks.gamma.toFixed(6);
        document.getElementById('thetaValue').textContent = greeks.theta.toFixed(4);
        document.getElementById('vegaValue').textContent = greeks.vega.toFixed(4);
        document.getElementById('rhoValue').textContent = greeks.rho.toFixed(4);
        
        // 更新图表
        drawChart();
    }
    
    // 重置参数
    function resetParameters() {
        optionParams = {
            S: 100,
            K: 100,
            T: 0.25,
            r: 0.05,
            sigma: 0.2,
            type: 'call'
        };
        updateParameterDisplay();
        updateOptionPricing();
    }
    
    // 切换图表类型
    function switchChart() {
        currentChartType = document.getElementById('chartType').value;
        drawChart();
    }
    
    // 绘制图表
    function drawChart() {
        const container = d3.select('#optionChart');
        container.selectAll('*').remove();
        
        switch(currentChartType) {
            case 'payoff':
                drawPayoffDiagram();
                break;
            case 'price_surface':
                drawPriceSurface();
                break;
            case 'greeks':
                drawGreeksChart();
                break;
            case 'sensitivity':
                drawSensitivityAnalysis();
                break;
        }
    }
    
    // 绘制损益图
    function drawPayoffDiagram() {
        const container = d3.select('#optionChart');
        const margin = {top: 20, right: 30, bottom: 40, left: 50};
        const width = 800 - margin.left - margin.right;
        const height = 400 - margin.bottom - margin.top;
        
        const svg = container.append('svg')
            .attr('width', width + margin.left + margin.right)
            .attr('height', height + margin.bottom + margin.top);
            
        const g = svg.append('g')
            .attr('transform', `translate(${margin.left},${margin.top})`);
        
        // 生成股价范围
        const stockPrices = d3.range(optionParams.K * 0.5, optionParams.K * 1.5, 1);
        
        // 计算期权价格和损益
        const optionPrices = stockPrices.map(S => {
            const price = blackScholesPrice(S, optionParams.K, optionParams.T, optionParams.r, optionParams.sigma, optionParams.type);
            const intrinsic = calculateIntrinsicValue(S, optionParams.K, optionParams.type);
            return { S, price, intrinsic };
        });
        
        const x = d3.scaleLinear()
            .domain(d3.extent(stockPrices))
            .range([0, width]);
        
        const y = d3.scaleLinear()
            .domain([0, d3.max(optionPrices, d => Math.max(d.price, d.intrinsic))])
            .range([height, 0]);
        
        const line = d3.line()
            .x(d => x(d.S))
            .y(d => y(d.price));
            
        const intrinsicLine = d3.line()
            .x(d => x(d.S))
            .y(d => y(d.intrinsic));
        
        // 绘制期权价格线
        g.append('path')
            .datum(optionPrices)
            .attr('fill', 'none')
            .attr('stroke', '#3498db')
            .attr('stroke-width', 3)
            .attr('d', line);
        
        // 绘制内在价值线
        g.append('path')
            .datum(optionPrices)
            .attr('fill', 'none')
            .attr('stroke', '#e74c3c')
            .attr('stroke-width', 2)
            .attr('stroke-dasharray', '5,5')
            .attr('d', intrinsicLine);
        
        // 标记当前股价
        g.append('line')
            .attr('x1', x(optionParams.S))
            .attr('x2', x(optionParams.S))
            .attr('y1', 0)
            .attr('y2', height)
            .attr('stroke', '#f39c12')
            .attr('stroke-width', 2)
            .attr('stroke-dasharray', '3,3');
        
        // 添加坐标轴
        g.append('g')
            .attr('transform', `translate(0,${height})`)
            .call(d3.axisBottom(x))
            .append('text')
            .attr('x', width / 2)
            .attr('y', 35)
            .attr('fill', 'black')
            .style('text-anchor', 'middle')
            .text('标的价格');
            
        g.append('g')
            .call(d3.axisLeft(y))
            .append('text')
            .attr('transform', 'rotate(-90)')
            .attr('y', -35)
            .attr('x', -height / 2)
            .attr('fill', 'black')
            .style('text-anchor', 'middle')
            .text('期权价格');
        
        // 添加图例
        const legend = g.append('g')
            .attr('transform', `translate(${width - 150}, 20)`);
            
        legend.append('line')
            .attr('x1', 0).attr('x2', 20)
            .attr('y1', 0).attr('y2', 0)
            .attr('stroke', '#3498db')
            .attr('stroke-width', 3);
            
        legend.append('text')
            .attr('x', 25).attr('y', 5)
            .text('期权价格');
            
        legend.append('line')
            .attr('x1', 0).attr('x2', 20)
            .attr('y1', 20).attr('y2', 20)
            .attr('stroke', '#e74c3c')
            .attr('stroke-width', 2)
            .attr('stroke-dasharray', '5,5');
            
        legend.append('text')
            .attr('x', 25).attr('y', 25)
            .text('内在价值');
    }
    
    // 绘制价格曲面（简化为2D热力图）
    function drawPriceSurface() {
        const container = d3.select('#optionChart');
        const margin = {top: 20, right: 100, bottom: 40, left: 50};
        const width = 800 - margin.left - margin.right;
        const height = 400 - margin.bottom - margin.top;
        
        const svg = container.append('svg')
            .attr('width', width + margin.left + margin.right)
            .attr('height', height + margin.bottom + margin.top);
            
        const g = svg.append('g')
            .attr('transform', `translate(${margin.left},${margin.top})`);
        
        // 生成数据网格
        const stockPrices = d3.range(optionParams.K * 0.7, optionParams.K * 1.3, 2);
        const timeValues = d3.range(0.01, 1, 0.02);
        
        const data = [];
        stockPrices.forEach(S => {
            timeValues.forEach(T => {
                const price = blackScholesPrice(S, optionParams.K, T, optionParams.r, optionParams.sigma, optionParams.type);
                data.push({ S, T, price });
            });
        });
        
        const x = d3.scaleLinear()
            .domain(d3.extent(stockPrices))
            .range([0, width]);
        
        const y = d3.scaleLinear()
            .domain(d3.extent(timeValues))
            .range([height, 0]);
        
        const colorScale = d3.scaleSequential(d3.interpolateViridis)
            .domain(d3.extent(data, d => d.price));
        
        const cellWidth = width / stockPrices.length;
        const cellHeight = height / timeValues.length;
        
        // 绘制热力图
        g.selectAll('.cell')
            .data(data)
            .enter().append('rect')
            .attr('class', 'cell')
            .attr('x', d => x(d.S) - cellWidth/2)
            .attr('y', d => y(d.T) - cellHeight/2)
            .attr('width', cellWidth)
            .attr('height', cellHeight)
            .attr('fill', d => colorScale(d.price));
        
        // 添加坐标轴
        g.append('g')
            .attr('transform', `translate(0,${height})`)
            .call(d3.axisBottom(x))
            .append('text')
            .attr('x', width / 2)
            .attr('y', 35)
            .attr('fill', 'black')
            .style('text-anchor', 'middle')
            .text('标的价格');
            
        g.append('g')
            .call(d3.axisLeft(y))
            .append('text')
            .attr('transform', 'rotate(-90)')
            .attr('y', -35)
            .attr('x', -height / 2)
            .attr('fill', 'black')
            .style('text-anchor', 'middle')
            .text('到期时间');
        
        // 添加颜色条
        const colorBarWidth = 20;
        const colorBarHeight = height;
        const colorBar = svg.append('g')
            .attr('transform', `translate(${width + margin.left + 20}, ${margin.top})`);
        
        const colorBarScale = d3.scaleLinear()
            .domain(colorScale.domain())
            .range([colorBarHeight, 0]);
        
        const colorBarAxis = d3.axisRight(colorBarScale);
        
        colorBar.append('g')
            .call(colorBarAxis);
        
        // 绘制颜色条渐变
        const gradient = svg.append('defs')
            .append('linearGradient')
            .attr('id', 'colorGradient')
            .attr('gradientUnits', 'userSpaceOnUse')
            .attr('x1', 0).attr('y1', colorBarHeight)
            .attr('x2', 0).attr('y2', 0);
        
        const steps = 20;
        for (let i = 0; i <= steps; i++) {
            const value = colorScale.domain()[0] + (colorScale.domain()[1] - colorScale.domain()[0]) * i / steps;
            gradient.append('stop')
                .attr('offset', `${i / steps * 100}%`)
                .attr('stop-color', colorScale(value));
        }
        
        colorBar.append('rect')
            .attr('x', -colorBarWidth)
            .attr('y', 0)
            .attr('width', colorBarWidth)
            .attr('height', colorBarHeight)
            .attr('fill', 'url(#colorGradient)');
    }
    
    // 绘制希腊字母图表
    function drawGreeksChart() {
        const container = d3.select('#optionChart');
        const margin = {top: 20, right: 30, bottom: 40, left: 50};
        const width = 800 - margin.left - margin.right;
        const height = 400 - margin.bottom - margin.top;
        
        const svg = container.append('svg')
            .attr('width', width + margin.left + margin.right)
            .attr('height', height + margin.bottom + margin.top);
            
        const g = svg.append('g')
            .attr('transform', `translate(${margin.left},${margin.top})`);
        
        // 生成股价范围
        const stockPrices = d3.range(optionParams.K * 0.7, optionParams.K * 1.3, 1);
        
        // 计算希腊字母
        const greeksData = stockPrices.map(S => {
            const greeks = calculateGreeks(S, optionParams.K, optionParams.T, optionParams.r, optionParams.sigma, optionParams.type);
            return { S, ...greeks };
        });
        
        const x = d3.scaleLinear()
            .domain(d3.extent(stockPrices))
            .range([0, width]);
        
        // 为Delta创建y轴
        const yDelta = d3.scaleLinear()
            .domain(d3.extent(greeksData, d => d.delta))
            .range([height, 0]);
        
        // 为Gamma创建y轴（右侧）
        const yGamma = d3.scaleLinear()
            .domain(d3.extent(greeksData, d => d.gamma))
            .range([height, 0]);
        
        const deltaLine = d3.line()
            .x(d => x(d.S))
            .y(d => yDelta(d.delta));
            
        const gammaLine = d3.line()
            .x(d => x(d.S))
            .y(d => yGamma(d.gamma));
        
        // 绘制Delta线
        g.append('path')
            .datum(greeksData)
            .attr('fill', 'none')
            .attr('stroke', '#3498db')
            .attr('stroke-width', 3)
            .attr('d', deltaLine);
        
        // 绘制Gamma线
        g.append('path')
            .datum(greeksData)
            .attr('fill', 'none')
            .attr('stroke', '#e74c3c')
            .attr('stroke-width', 2)
            .attr('d', gammaLine);
        
        // 标记当前股价
        g.append('line')
            .attr('x1', x(optionParams.S))
            .attr('x2', x(optionParams.S))
            .attr('y1', 0)
            .attr('y2', height)
            .attr('stroke', '#f39c12')
            .attr('stroke-width', 2)
            .attr('stroke-dasharray', '3,3');
        
        // 添加坐标轴
        g.append('g')
            .attr('transform', `translate(0,${height})`)
            .call(d3.axisBottom(x))
            .append('text')
            .attr('x', width / 2)
            .attr('y', 35)
            .attr('fill', 'black')
            .style('text-anchor', 'middle')
            .text('标的价格');
            
        g.append('g')
            .call(d3.axisLeft(yDelta))
            .append('text')
            .attr('transform', 'rotate(-90)')
            .attr('y', -35)
            .attr('x', -height / 2)
            .attr('fill', '#3498db')
            .style('text-anchor', 'middle')
            .text('Delta');
            
        g.append('g')
            .attr('transform', `translate(${width}, 0)`)
            .call(d3.axisRight(yGamma))
            .append('text')
            .attr('transform', 'rotate(-90)')
            .attr('y', 35)
            .attr('x', -height / 2)
            .attr('fill', '#e74c3c')
            .style('text-anchor', 'middle')
            .text('Gamma');
        
        // 添加图例
        const legend = g.append('g')
            .attr('transform', `translate(${width - 150}, 20)`);
            
        legend.append('line')
            .attr('x1', 0).attr('x2', 20)
            .attr('y1', 0).attr('y2', 0)
            .attr('stroke', '#3498db')
            .attr('stroke-width', 3);
            
        legend.append('text')
            .attr('x', 25).attr('y', 5)
            .text('Delta');
            
        legend.append('line')
            .attr('x1', 0).attr('x2', 20)
            .attr('y1', 20).attr('y2', 20)
            .attr('stroke', '#e74c3c')
            .attr('stroke-width', 2);
            
        legend.append('text')
            .attr('x', 25).attr('y', 25)
            .text('Gamma');
    }
    
    // 绘制敏感性分析
    function drawSensitivityAnalysis() {
        const container = d3.select('#optionChart');
        const margin = {top: 20, right: 30, bottom: 40, left: 50};
        const width = 800 - margin.left - margin.right;
        const height = 400 - margin.bottom - margin.top;
        
        const svg = container.append('svg')
            .attr('width', width + margin.left + margin.right)
            .attr('height', height + margin.bottom + margin.top);
            
        const g = svg.append('g')
            .attr('transform', `translate(${margin.left},${margin.top})`);
        
        // 波动率敏感性分析
        const volatilities = d3.range(0.1, 0.5, 0.01);
        
        const sensitivityData = volatilities.map(sigma => {
            const price = blackScholesPrice(optionParams.S, optionParams.K, optionParams.T, optionParams.r, sigma, optionParams.type);
            return { sigma: sigma * 100, price };
        });
        
        const x = d3.scaleLinear()
            .domain(d3.extent(sensitivityData, d => d.sigma))
            .range([0, width]);
        
        const y = d3.scaleLinear()
            .domain(d3.extent(sensitivityData, d => d.price))
            .range([height, 0]);
        
        const line = d3.line()
            .x(d => x(d.sigma))
            .y(d => y(d.price));
        
        // 绘制敏感性曲线
        g.append('path')
            .datum(sensitivityData)
            .attr('fill', 'none')
            .attr('stroke', '#9b59b6')
            .attr('stroke-width', 3)
            .attr('d', line);
        
        // 标记当前波动率
        g.append('line')
            .attr('x1', x(optionParams.sigma * 100))
            .attr('x2', x(optionParams.sigma * 100))
            .attr('y1', 0)
            .attr('y2', height)
            .attr('stroke', '#f39c12')
            .attr('stroke-width', 2)
            .attr('stroke-dasharray', '3,3');
        
        // 添加坐标轴
        g.append('g')
            .attr('transform', `translate(0,${height})`)
            .call(d3.axisBottom(x))
            .append('text')
            .attr('x', width / 2)
            .attr('y', 35)
            .attr('fill', 'black')
            .style('text-anchor', 'middle')
            .text('波动率 (%)');
            
        g.append('g')
            .call(d3.axisLeft(y))
            .append('text')
            .attr('transform', 'rotate(-90)')
            .attr('y', -35)
            .attr('x', -height / 2)
            .attr('fill', 'black')
            .style('text-anchor', 'middle')
            .text('期权价格');
    }
    
    // 设置事件监听器
    function setupEventListeners() {
        // 滑块事件
        ['stockPrice', 'strikePrice', 'timeToExpiry', 'riskFreeRate', 'volatility'].forEach(id => {
            document.getElementById(id).addEventListener('input', function() {
                document.getElementById(id + 'Num').value = this.value;
                updateOptionPricing();
            });
        });
        
        // 数字输入框事件
        ['stockPriceNum', 'strikePriceNum', 'timeToExpiryNum', 'riskFreeRateNum', 'volatilityNum'].forEach(id => {
            document.getElementById(id).addEventListener('input', function() {
                const baseId = id.replace('Num', '');
                document.getElementById(baseId).value = this.value;
                updateOptionPricing();
            });
        });
        
        // 期权类型选择
        document.getElementById('optionType').addEventListener('change', updateOptionPricing);
    }
    
    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', function() {
        setupEventListeners();
        updateOptionPricing();
    });
    </script>
    
    <!-- 期权定价交互式演示 -->
    <div class="interactive-demo">
        <h3>期权定价交互式演示</h3>
        
        <!-- 参数控制面板 -->
        <div class="demo-controls">
            <div class="control-group">
                <h4>期权参数</h4>
                <div class="control-row">
                    <label>标的价格 (S): <span id="stockPriceValue">100</span></label>
                    <input type="range" id="stockPrice" min="50" max="150" value="100" step="1">
                    <input type="number" id="stockPriceNum" min="50" max="150" value="100" step="1">
                </div>
                <div class="control-row">
                    <label>执行价格 (K): <span id="strikePriceValue">100</span></label>
                    <input type="range" id="strikePrice" min="80" max="120" value="100" step="1">
                    <input type="number" id="strikePriceNum" min="80" max="120" value="100" step="1">
                </div>
                <div class="control-row">
                    <label>到期时间 (T): <span id="timeToExpiryValue">0.25</span> 年</label>
                    <input type="range" id="timeToExpiry" min="0.01" max="1" value="0.25" step="0.01">
                    <input type="number" id="timeToExpiryNum" min="0.01" max="1" value="0.25" step="0.01">
                </div>
                <div class="control-row">
                    <label>无风险利率 (r): <span id="riskFreeRateValue">5</span>%</label>
                    <input type="range" id="riskFreeRate" min="0" max="10" value="5" step="0.1">
                    <input type="number" id="riskFreeRateNum" min="0" max="10" value="5" step="0.1">
                </div>
                <div class="control-row">
                    <label>波动率 (σ): <span id="volatilityValue">20</span>%</label>
                    <input type="range" id="volatility" min="5" max="50" value="20" step="1">
                    <input type="number" id="volatilityNum" min="5" max="50" value="20" step="1">
                </div>
                <div class="control-row">
                    <label>期权类型:</label>
                    <select id="optionType">
                        <option value="call">看涨期权 (Call)</option>
                        <option value="put">看跌期权 (Put)</option>
                    </select>
                </div>
            </div>
            
            <div class="control-group">
                <h4>分析选项</h4>
                <div class="control-row">
                    <button onclick="updateOptionPricing()" class="btn-primary">更新计算</button>
                    <button onclick="resetParameters()" class="btn-secondary">重置参数</button>
                </div>
                <div class="control-row">
                    <label>图表类型:</label>
                    <select id="chartType" onchange="switchChart()">
                        <option value="payoff">损益图</option>
                        <option value="price_surface">价格曲面</option>
                        <option value="greeks">希腊字母</option>
                        <option value="sensitivity">敏感性分析</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- 期权价格显示 -->
        <div class="option-pricing-display">
            <div class="pricing-card">
                <h4>期权价格</h4>
                <div class="price-value" id="optionPrice">--</div>
                <div class="price-label">Black-Scholes价格</div>
            </div>
            <div class="pricing-card">
                <h4>内在价值</h4>
                <div class="price-value" id="intrinsicValue">--</div>
                <div class="price-label">立即执行价值</div>
            </div>
            <div class="pricing-card">
                <h4>时间价值</h4>
                <div class="price-value" id="timeValue">--</div>
                <div class="price-label">期权溢价</div>
            </div>
        </div>
        
        <!-- 希腊字母显示 -->
        <div class="greeks-display">
            <div class="greek-card">
                <div class="greek-name">Delta (Δ)</div>
                <div class="greek-value" id="deltaValue">--</div>
                <div class="greek-desc">价格敏感性</div>
            </div>
            <div class="greek-card">
                <div class="greek-name">Gamma (Γ)</div>
                <div class="greek-value" id="gammaValue">--</div>
                <div class="greek-desc">Delta变化率</div>
            </div>
            <div class="greek-card">
                <div class="greek-name">Theta (Θ)</div>
                <div class="greek-value" id="thetaValue">--</div>
                <div class="greek-desc">时间衰减</div>
            </div>
            <div class="greek-card">
                <div class="greek-name">Vega (ν)</div>
                <div class="greek-value" id="vegaValue">--</div>
                <div class="greek-desc">波动率敏感性</div>
            </div>
            <div class="greek-card">
                <div class="greek-name">Rho (ρ)</div>
                <div class="greek-value" id="rhoValue">--</div>
                <div class="greek-desc">利率敏感性</div>
            </div>
        </div>
        
        <!-- 图表显示区域 -->
        <div class="chart-container">
            <div id="optionChart"></div>
        </div>
    </div>
    
    <style>
    .interactive-demo {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
    }
    
    .demo-controls {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
    }
    
    .control-group {
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .control-group h4 {
        margin: 0 0 15px 0;
        color: #2c3e50;
        border-bottom: 2px solid #3498db;
        padding-bottom: 5px;
    }
    
    .control-row {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        gap: 10px;
    }
    
    .control-row label {
        min-width: 150px;
        font-weight: 500;
    }
    
    .control-row input[type="range"] {
        flex: 1;
        margin: 0 10px;
    }
    
    .control-row input[type="number"] {
        width: 80px;
        padding: 5px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    
    .control-row select {
        flex: 1;
        padding: 5px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    
    .btn-primary, .btn-secondary {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 500;
        margin-right: 10px;
    }
    
    .btn-primary {
        background: #3498db;
        color: white;
    }
    
    .btn-primary:hover {
        background: #2980b9;
    }
    
    .btn-secondary {
        background: #95a5a6;
        color: white;
    }
    
    .btn-secondary:hover {
        background: #7f8c8d;
    }
    
    .option-pricing-display {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        margin-bottom: 20px;
    }
    
    .pricing-card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        border-left: 4px solid #3498db;
    }
    
    .pricing-card h4 {
        margin: 0 0 10px 0;
        color: #2c3e50;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .price-value {
        font-size: 24px;
        font-weight: bold;
        color: #27ae60;
        margin-bottom: 5px;
    }
    
    .price-label {
        font-size: 12px;
        color: #7f8c8d;
    }
    
    .greeks-display {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 15px;
        margin-bottom: 20px;
    }
    
    .greek-card {
        background: white;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        border-top: 3px solid #e74c3c;
    }
    
    .greek-name {
        font-size: 14px;
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 8px;
    }
    
    .greek-value {
        font-size: 18px;
        font-weight: bold;
        color: #e74c3c;
        margin-bottom: 5px;
    }
    
    .greek-desc {
        font-size: 11px;
        color: #7f8c8d;
    }
    
    .chart-container {
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    #optionChart {
        width: 100%;
        height: 500px;
    }
    
    @media (max-width: 768px) {
        .demo-controls {
            grid-template-columns: 1fr;
        }
        
        .option-pricing-display {
            grid-template-columns: 1fr;
        }
        
        .greeks-display {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .control-row {
            flex-direction: column;
            align-items: stretch;
        }
        
        .control-row label {
            min-width: auto;
            margin-bottom: 5px;
        }
    }
    </style>
</body>
</html>
    <style>
    /* 确保代码块左对齐 */
    .lesson-content pre {
        text-align: left !important;
        font-family: 'Courier New', Courier, monospace;
        background-color: #f5f7fa;
        padding: 15px;
        border-radius: 8px;
        overflow-x: auto;
        margin: 20px 0;
        border-left: 4px solid #4299e1;
    }
    
    .lesson-content code {
        text-align: left !important;
        font-family: 'Courier New', Courier, monospace;
        background-color: #f5f7fa;
        padding: 2px 5px;
        border-radius: 3px;
    }
    
    /* 确保pre标签内的内容左对齐 */
    pre * {
        text-align: left !important;
    }
    
    /* 确保所有代码相关元素都左对齐 */
    pre, code, .hljs {
        text-align: left !important;
    }
    </style>
    
</head>
<body>
<div id="navigation-container"></div>


        </section>
        <div class="lesson-navigation">
            <a href="../../index.html" class="btn">« 返回模块首页</a>
            <a href="lesson2.html" class="btn">下一课: 固定收益证券分析 »</a>
        </div>
    </main>
    <footer>
        <div class="container">
            <p>© 2023 Python金融编程课程. 保留所有权利.</p>
        </div>
    </footer>
</body>
</html>